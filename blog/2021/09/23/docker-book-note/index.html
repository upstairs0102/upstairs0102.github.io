<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">「Docker這樣學才有趣」讀書筆記 | Dev Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://upstairs0102.github.io/blog/2021/09/23/docker-book-note"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="「Docker這樣學才有趣」讀書筆記 | Dev Notes"><meta data-rh="true" name="description" content="前言"><meta data-rh="true" property="og:description" content="前言"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-09-23T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/upstairs0102"><meta data-rh="true" property="article:tag" content="docker,gitlab-ci"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://upstairs0102.github.io/blog/2021/09/23/docker-book-note"><link data-rh="true" rel="alternate" href="https://upstairs0102.github.io/blog/2021/09/23/docker-book-note" hreflang="en"><link data-rh="true" rel="alternate" href="https://upstairs0102.github.io/blog/2021/09/23/docker-book-note" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Dev Notes RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Dev Notes Atom Feed"><link rel="stylesheet" href="/assets/css/styles.f2b0fb58.css">
<link rel="preload" href="/assets/js/runtime~main.24867ba9.js" as="script">
<link rel="preload" href="/assets/js/main.bc2d944c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Adam You" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Adam You" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Adam You</b></a><a class="navbar__item navbar__link" href="/docs/">筆記</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/upstairs0102" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/11/10/using-vite-to-build-node-packages">用vite打包要發布npm的程式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/09/12/confusing-terms-in-rxjs">RxJS中一些容易混淆的名詞</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/09/12/combinelatest-duplicate-events">[RxJS] 去除掉 combineLatest 中同時間的重覆事件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/07/09/experience-frontend-and-backend">工作心得 - 關於前後端</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/02/new-docusaurus-website">2023部落格搬家到 Docusaurus</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">「Docker這樣學才有趣」讀書筆記</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-09-23T00:00:00.000Z" itemprop="datePublished">September 23, 2021</time> · <!-- -->20 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/upstairs0102" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="/img/avatar.jpeg" alt="Adam You"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/upstairs0102" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Adam You</span></a></div><small class="avatar__subtitle" itemprop="description">Engineer @ Blueplanet Inc.</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>這是我讀了「Docker這樣學才有趣」這本書其中第1章~第5章的筆記，這幾章包含了 Docker基本知識與指令、Dockerfiler以及 Docker Compose指令等，已經足以建置一般的 Docker Container以及自動化管理。不過docker-compose.yml文件指令的部份實在是太多了… 一時間筆記做不完，所以尚未寫好…</p><p>後面的章節內容還有架設 Docker Registry，以及多個範例實作（也就是標題上說有趣的部份），就被我跳過了…</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch1-docker的能與不能">CH1 Docker的能與不能<a class="hash-link" href="#ch1-docker的能與不能" title="Direct link to heading">​</a></h2><p>Container（容器）的完整名稱應該是「Linux Containers」，指的是一組利用 Linux核心提供的技術來達到把程式或軟體「包裏」在一個可隔離且獨立運行的環境工具。</p><p>Docker就是用來管理這些 Containers的工具</p><p>Docker是一個完全免費（採用 Apache 2.0授權）的開發原始碼專案</p><p><a href="https://github.com/moby/moby" target="_blank" rel="noopener noreferrer">https://github.com/moby/moby</a></p><p>↑ moby是容器框架，原本 github上的 docker專案已改名為 moby，而 Docker是使用 moby架構實作出來的產品</p><p><a href="https://kknews.cc/zh-tw/tech/gv63368.html" target="_blank" rel="noopener noreferrer">https://kknews.cc/zh-tw/tech/gv63368.html</a></p><p>版本及差異：</p><ul><li><p>Docker EE（Docker Enterprise Edition，企業版）：付費版</p></li><li><p>Docker CE（Docker Community Edition，社群版）：免費版</p></li><li><p>Docker Desktop：由於 Docker是基於 Linux的 Container工具，所以 Linux以外的作業系統 - Mac和 Windows必須安裝 Docker Desktop。其原理是在透過 Linux虛擬機器來運行 Container的。目前 Docker Desktop僅提供250以下小型公司免費版本，大型公司必須使用付費方案。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch2-必學的-docker功能與指令">CH2 必學的 Docker功能與指令<a class="hash-link" href="#ch2-必學的-docker功能與指令" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="下載及啟用-image映象檔">下載及啟用 Image（映象檔）<a class="hash-link" href="#下載及啟用-image映象檔" title="Direct link to heading">​</a></h3><p>映像檔相關名詞：</p><ul><li>Docker Image：透過 Docker把要使用的軟體打包起來，打包的檔案稱為 Docker Image</li><li>Docker Registry：用來存放 Docker Image供 Docker下載使用，可以是公開的也可以是內部私用的</li><li>Docker Hub：Docker 官方提供的 Docker Registry</li></ul><p>常用指令：</p><p><code>docker search &lt;Docker Image&gt;</code> 搜尋 Docker Image</p><p><code>docker pull &lt;Docker Image&gt;</code> 下載 Docker Image</p><p><code>docker images</code> 查看已下載過的 Docker Image</p><p>啟動指令：</p><p><code>docker run -p &lt;對外port&gt;:&lt;預設port&gt; -d</code></p><p>例</p><p><code>docker run -p 8080:80 -d nginx</code></p><p>用 nginx的 docker image以 <code>Detach</code>的方式在主機 8080 port上提供服務</p><p><strong>有 <code>-d</code>指令執行後會回傳 Container ID，會將程式執行在「背景」，如果沒有加 <code>-d</code>會將程式執行在「前景」</strong></p><p><strong>* 解決 Container啟動後就結束的問題：</strong></p><p>Container被啟動後，會和一般的程式一樣，在作業系統中被視為一支執行中的程序 (Process)，所以這個 Container就會像跑一支程式一樣跑完之後就會被結束掉。如果要順利可以使用的話，就需要在 Container裡啟用一個伺服器的程式（持續執行中的程式）讓 Container保持運行</p><p><code>docker rmi &lt;Image名稱或 ID&gt;</code> 刪除 Docker Image</p><p>Docker Image是一層一層疊出來的，不同的 Docker Image可能有共用到同一層的部份，所以移除掉某個 Docker Image後所拿回來的硬碟空間不一定會和看到或所想的一樣</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看啟動過的-container">查看啟動過的 Container<a class="hash-link" href="#查看啟動過的-container" title="Direct link to heading">​</a></h3><p><code>docker ps</code>指令查看狀態</p><p>例：</p><p><code>docker run -p 8080:80 -d nginx</code></p><p><code>docker run -p 8080:80 nginx</code></p><p>分別啟動一個前景執行和一個背景執行的 nginx，前景執行的 nginx會在 terminal中顯示 nginx的訊息。這時候另開 terminal使用 <code>docker ps</code>指令會看到兩個已啟動的 Container資訊</p><p>按下 <code>Ctrl + C</code>會把前景執行的 nginx給中斷，這時候使用 <code>docker ps</code>指令查看會只看到一個已啟動的 Container資訊</p><p><code>docker ps -a</code>中的 <code>-a</code>選項會把所有已經啟動過的 Container都列出來（不論是不是在運行）。所以以上面的例子即會看兩筆 Container資訊，其中一個是正在運行另一個是中斷運行（看 <code>status</code>欄位）</p><p><code>docker ps -l</code>中的 <code>-l</code>選項會顯示最後一組建立的 Container資訊</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="停用和啟用-container">停用和啟用 Container<a class="hash-link" href="#停用和啟用-container" title="Direct link to heading">​</a></h3><p><code>docker start &lt;Container ID&gt;</code></p><p><code>docker stop &lt;Container ID&gt;</code></p><p><code>docker restart &lt;Container ID&gt;</code> restart會先停止再啟動</p><p> <code>docker rm</code>移除 Container。如果確定狀態是 <code>Exited</code>的 Container已經沒有再使用的話，要使用 <code>docker rm</code>指令來移除（如 Container不是在停止狀態下移除會出現錯誤訊息）</p><p>Container不會在被停用之後就移除掉，所以使用 <code>docker run</code>來新增 Container幾次後，用 <code>docker ps -a</code>指令就可以看到有許多已經沒有在運行的 Container。</p><p><code>docker ps -s</code>查詢 Container佔用多少硬碟空間</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="詳細-container資訊">詳細 Container資訊<a class="hash-link" href="#詳細-container資訊" title="Direct link to heading">​</a></h3><p><code>docker inspect &lt;Container ID&gt;</code> 詳細配置資訊</p><p>可以進設定輸出格式及範圍，例 <code>docker inspect --format=&#x27;{{json .State.Status}}&#x27; node-red-couchdb</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一次作多個-container">一次作多個 Container<a class="hash-link" href="#一次作多個-container" title="Direct link to heading">​</a></h3><p>只要是可以用 Container ID進行操作的指令，都可以一次輸入多個 Container，包含 <code>docker start</code>, <code>docker stop</code>, <code>docker rm</code>…等</p><p>例 <code>docker start &lt;Container ID&gt; &lt;Container ID&gt; &lt;Container ID&gt;</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="搬移檔案">搬移檔案<a class="hash-link" href="#搬移檔案" title="Direct link to heading">​</a></h3><p>把檔案複製到 Container裡</p><p><code>docker cp &lt;檔案來源路徑&gt; &lt;目的Container ID&gt;:&lt;目的路徑&gt;</code></p><p>把檔案從 Container複製出來</p><p><code>docker cp &lt;來源Container ID&gt;:&lt;檔案來源路徑&gt; &lt;目的路徑&gt;</code></p><p>無論是運行中或停止中的 Container都可以進行操作</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看-container使用資源cpu記憶體">查看 Container使用資源（CPU、記憶體）<a class="hash-link" href="#查看-container使用資源cpu記憶體" title="Direct link to heading">​</a></h3><p><code>docker stats</code> 查看全部 Container</p><p><code>docker stats &lt;Container ID&gt;</code> 查看指定 Container</p><p>會以「即時」的方式呈現目前狀況資訊</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看-container的即時-log">查看 Container的即時 Log<a class="hash-link" href="#查看-container的即時-log" title="Direct link to heading">​</a></h3><p>當 Container是以 Detach模式（背景）執行時，沒有辦法在命令列上直接看到 Log資訊，這時就需要使用 <code>docker logs</code>指令才能看到 Log資訊</p><p><code>docker logs &lt;Container ID&gt;</code> 可以看到指定的 Container Log資訊</p><p>選項 <code>--tail</code>可以只顯示數幾行的資訊，例：</p><p><code>docker logs &lt;Container ID&gt; --tail 2 76d1</code> </p><p>選項 <code>--since</code>可以只顯示倒數分鐘以前的資訊，例：</p><p><code>docker logs &lt;Container ID&gt; --since 2m 76d1</code> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch3-docker-container的進階操作">CH3 Docker Container的進階操作<a class="hash-link" href="#ch3-docker-container的進階操作" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="container-命名">Container 命名<a class="hash-link" href="#container-命名" title="Direct link to heading">​</a></h3><p><code>--name</code> 用來指定 Container名稱（沒有指定名稱時 Docker會自動隨機取名）</p><p>搭配 docker run  <code>docker run --name &lt;Container名稱&gt;</code></p><p>例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name nginx-hello -p 8080:80 -d nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker start nginx-hello</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因為 Container的名稱必須是唯一的，因此每次用 docker run 指令啟動 Container都必須指定不同的名稱</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="環境變數">環境變數<a class="hash-link" href="#環境變數" title="Direct link to heading">​</a></h3><p><code>-e</code> 用來設定變數值</p><p>例 <code>dockr run -e &lt;變數名稱&gt;=&lt;變數值&gt; -p &lt;對外port&gt;:&lt;預設port&gt; -d &lt;Docker Image名稱&gt;</code></p><p>mysql範例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$docker run --name mysql -e MYSQL_ROOT_PASSWORD=123456789 -d mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$docker exec -it mysql mysql -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">略</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-run-與-docker-create">docker run 與 docker create<a class="hash-link" href="#docker-run-與-docker-create" title="Direct link to heading">​</a></h3><p><code>docker create</code>需搭配 <code>docker start</code>指令才會啟動</p><p><code>docker run</code>執行之後就會立即的運行</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-kill-與-docker-stop">docker kill 與 docker stop<a class="hash-link" href="#docker-kill-與-docker-stop" title="Direct link to heading">​</a></h3><p><code>docker stop</code>：讓 Docker進入標準的關機程序；所有的程式會進入到各自的關機處理程序，等所有程式完成關機程序之後 Docker也進入自己的關機程序</p><p><code>docker kill</code>：強迫進行 Docker的關機動作</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="執行-container內的程式或指令">執行 Container內的程式或指令<a class="hash-link" href="#執行-container內的程式或指令" title="Direct link to heading">​</a></h3><p>適用情況：有一種 Container的用途是被拿來當作軟體的工具包</p><p>指令寫法：直接在 <code>docker run</code>的指令最後面加上想要執行的指令</p><p>例，把本機資料夾 C:\downloads檔案清單列出來</p><p><code>dockr run -v C:\downloads:/home ubuntu /bin/ls -l /home</code></p><p>（先使用 <code>-v</code>指令在本機外掛資料夾，並使用 ls工具用 <code>-l</code>指令檢視）</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="自動移除自動重新啟動">自動移除、自動重新啟動<a class="hash-link" href="#自動移除自動重新啟動" title="Direct link to heading">​</a></h3><p><code>--rm</code>：Container停止後就會自動移除</p><p>例 <code>docker run --rm -v C:\downloads:/home ubuntu /bin/ls -l /home</code></p><p><code>--restart</code>：讓 Container在不預期情況被停止時，依照 <code>--restart</code>的設定方式決定要不要自動重新啟動 Container（預設是 <code>no</code>）</p><p>設定值：</p><ul><li><code>no</code></li><li><code>always</code></li><li><code>unless-stopped</code>：和 <code>always</code>一樣有服務中斷自動重啟的功能，但是重開機後就不重啟</li><li><code>on-failure</code>：只在 Container的退出狀態代碼 (Exit Code)不是零 (Non-Zero)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="進入-container操作命令列">進入 Container操作命令列<a class="hash-link" href="#進入-container操作命令列" title="Direct link to heading">​</a></h3><p>想要透過指令來操作 Container的話，只要能啟動 Container裡的 Shell程式就可以了，一般 Linux作業系統常用的 Shell程式是 bash這一支程式</p><p>錯誤指令：</p><p><code>docker run --rm --name nginx-cmd nginx /bin/bash</code></p><p>要使用 <code>-it</code>（<code>-i</code>和<code>-t</code>的合併寫法）指令來進入能夠輸入指令（及能把執行結果送出來）的狀態</p><p>正確指令：</p><p><code>docker run -it --rm --name nginx-cmd nginx /bin/bash</code></p><p><code>docker exec</code>：可以對已經在運行中的 Container要求執行指令</p><p>範例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name nginx-cmd -d nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it nginx-cmd /bin/bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="container綁定-ip">Container綁定 IP<a class="hash-link" href="#container綁定-ip" title="Direct link to heading">​</a></h3><p><code>-p</code>指定 Container所要綁定的 IP位址</p><p>Docker預設會把 Container綁定到主機的 0.0.0.0</p><p>對外服務的建議指令：</p><p><code>docker run -p &lt;主機IP&gt;:&lt;主機port&gt;:&lt;Container port&gt; -d &lt;Docker Image&gt;</code></p><p>例</p><p><code>docker run -p 192.168.1.1:80:80 -d nginx</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-network">docker network<a class="hash-link" href="#docker-network" title="Direct link to heading">​</a></h3><p>傳統上會把伺服器和資料庫裝在同一個虛擬機器裡，在 Container上建議的做法是用 <code>docker network</code>建立一個 Docker網路，再把這兩套軟體分別啟動各自獨立的 Container到同一個 Docker網路之中</p><p>例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker network create &lt;網路名稱&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name --net=&lt;網路名稱&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除了使用<code>--net</code>方式來連接多個 Container，也可以利用 Docker Compose工具來達到</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-volume---docker-run直接指定本機路徑">Data Volume - docker run直接指定本機路徑<a class="hash-link" href="#data-volume---docker-run直接指定本機路徑" title="Direct link to heading">​</a></h3><p>Container運行產生的資料是會隨著 Container的消滅而消失，並且 Docker Container是採用一種層疊的方式來新增資料，所以每次有新增資料時就會產生一層新資料層疊加上去，而頻繁的寫入資料會產生大量的資料層而快速的吃掉硬碟空間。</p><p><code>-v</code>：掛上外部的硬碟空間</p><p>指令如下：</p><p><code>docker run -v &lt;外部資料夾或檔案路徑&gt;:&lt;Container內部資料夾或檔案路徑&gt; -p &lt;對外port&gt;:&lt;預設port&gt; -d &lt;Docker Image&gt;</code></p><p>例 - 資料夾</p><p><code>docker run -v /var/www:/usr/share/nginx/html --name nginx-store -p 8080:80 -d nginx</code></p><p>例 - 設定檔</p><p><code>docker run -v /home/ayubiz/nginx.conf:/etc/nginx/nginx.conf -v /var/www:/usr/share/ginx/html --name nginx-store -p 8080:80 -d nginx</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-volume---data-volumn-create">Data Volume - data volumn create<a class="hash-link" href="#data-volume---data-volumn-create" title="Direct link to heading">​</a></h3><p>使用 <code>dota volumn create</code>建立 Data Volumn可以更方便的操作和管理 Data Volumn</p><p>例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$docker volumn create nginx-html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$docker volumn ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$docker run -v nginx-html:/usr/share/nginx/html --name nginx-vol -p 8080:80 -d nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果要讓另一個 Container也使用相同的 Data Volumn的話，只要使用相同的 Data Volumn名稱掛載即可</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$docker run -v nginx-html:/usr/share/nginx/html --name nginx-vol3 -p 8081:80 -d nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不過多個 Container共用同一個 Data Volumn時要注意避免共同更新同一個檔案，以免造成資料的混亂或錯誤。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch4-各種自製-docker-image的方法">CH4 各種自製 Docker Image的方法<a class="hash-link" href="#ch4-各種自製-docker-image的方法" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="從運行中的-container產生映像檔">從運行中的 Container產生映像檔<a class="hash-link" href="#從運行中的-container產生映像檔" title="Direct link to heading">​</a></h3><p><code>docker commit &lt;Container ID&gt; &lt;產出的 Docker Image名稱&gt;</code></p><p>例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name nginx-hello -p 8080:80 -d nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker cp index.html nginx-hello:/usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker commit nginx-hello nginx-commit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在此例中即使先執行了 <code>docker stop</code>中止後仍然是可以執行 <code>docker commit</code>指令的，不過掛載在 Container上的儲空間是不會被存進到新產生的 Image</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dockerfile的-build指令">Dockerfile的 Build指令<a class="hash-link" href="#dockerfile的-build指令" title="Direct link to heading">​</a></h3><p>Dockerfile可以把他看成是一個腳本檔來看，他被用來明確的告訴 docker build指令在產生新 Image的時候所需要用到的資訊和步驟</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="from">FROM<a class="hash-link" href="#from" title="Direct link to heading">​</a></h4><p>指定要下載的 Image檔名稱</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:14-alpine</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="env">ENV<a class="hash-link" href="#env" title="Direct link to heading">​</a></h4><p>設定環境變數</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ENV NODE_ENV=$deploy_env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="run">RUN<a class="hash-link" href="#run" title="Direct link to heading">​</a></h4><p>執行指令</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="expose">EXPOSE<a class="hash-link" href="#expose" title="Direct link to heading">​</a></h4><p>指定 Container啟用的 port</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 80 443</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cmd">CMD<a class="hash-link" href="#cmd" title="Direct link to heading">​</a></h4><p>Container啟動完成後要執行的指令。當同一個 Dockerfile裡有多個 <code>CMD</code>指令時，只有最後一個 <code>CMD</code>指令會有作用</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;damon off;&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="entrypoint">ENTRYPOINT<a class="hash-link" href="#entrypoint" title="Direct link to heading">​</a></h4><p>Container啟動完成後要執行的指令，功能和 <code>CMD</code>類似，差異在於其不能在 <code>docker run</code>後面加入的指令來蓋掉 <code>ENTRYPOINT	</code>指令所要求的啟動方式。也就是說他一定會被執行，且可以在 <code>docker run</code>後攜帶參數使用。</p><p>當同一個 Dockerfile裡有多個 <code>ENTRYPOINT</code>指令時，只有最後一個 <code>ENTRYPOINT</code>指令會有作用。他可以和 <code>CMD</code>搭配使用</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workdir">WORKDIR<a class="hash-link" href="#workdir" title="Direct link to heading">​</a></h4><p>指定執行指令的資料夾位置</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="copy">COPY<a class="hash-link" href="#copy" title="Direct link to heading">​</a></h4><p>複製檔案到 Container當中。指令：<code>COPY &lt;來源檔路徑和檔名&gt; &lt;Container裡的完整路徑和檔名&gt;</code></p><p>另外還有一個指令 <code>ADD</code>與 <code>COPY</code>相似，不過 <code>ADD</code>是將檔案放到 Image裡，主要的差異是在 <code>ADD</code>多了可以用網址指定來源檔和可以自動解開 tar壓縮檔的功能；官方比較建議使用 <code>COPY</code>指令。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="label">LABEL<a class="hash-link" href="#label" title="Direct link to heading">​</a></h4><p>將 Image檔的作者、版本、描述及其他自訂資料儲存到新產生的 Image檔，而存入的資訊可透過 <code>docker image inspect</code>指令查看 <code>Labels</code>欄位</p><p>指令：<code>LABEL &lt;欄位名稱&gt;:&quot;&lt;欄位值&gt;&quot; &lt;欄位名稱&gt;:&quot;&lt;欄位值&gt;&quot; &lt;欄位名稱&gt;:&quot;&lt;欄位值&gt;&quot; ...</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="user">USER<a class="hash-link" href="#user" title="Direct link to heading">​</a></h4><p>大部份的 Image檔都會使用最高權限的 root做為預設的使用者帳號，如果不想用 root作預設的使用者的話，可以用 <code>USER</code>指令指定帳號</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="volume">VOLUME<a class="hash-link" href="#volume" title="Direct link to heading">​</a></h4><p>提供 Data Volume的掛載</p><p>指令 <code>VOLUME [&quot;&lt;掛載點的資料夾路徑&gt;&quot;, &quot;&lt;掛載點的資料夾路徑&gt;&quot; ...]</code> 或 <code>VOLUME &lt;掛載點的資料夾路徑&gt; &lt;掛載點的資料夾路徑&gt; ...</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="arg">ARG<a class="hash-link" href="#arg" title="Direct link to heading">​</a></h4><p>可以讓 <code>docker build</code>指令利用 <code>--build-arg</code>選項傳入參數到 Dockerfile裡</p><p>指令 <code>ARG &lt;參數名稱&gt;</code> 或  <code>ARG &lt;參數名稱&gt;=&lt;預設值&gt;</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="匯入匯出-image檔">匯入/匯出 Image檔<a class="hash-link" href="#匯入匯出-image檔" title="Direct link to heading">​</a></h3><p>匯出指令： <code>docker save -o &lt;匯出的檔案名稱.tar&gt; &lt;要匯出的 Image名稱&gt;:&lt;版本&gt;</code></p><p><code>docker save</code>匯出的檔案格式為 tar壓縮檔，名稱可加上 <code>.tar</code>也可不加</p><p>匯入指令：<code>docker load -i &lt;之前匯出的Image.tar&gt;</code> 或<code>docker load &lt; &lt;之前匯出的Image.tar&gt;</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="用-container匯出-image">用 Container匯出 Image<a class="hash-link" href="#用-container匯出-image" title="Direct link to heading">​</a></h3><p>這種方式不是將運行中的 Container整個匯出，只是將 Container內部使用中的檔案系統匯出</p><p>匯出指令 <code>docker export -o &lt;匯出的檔案名稱.tar&gt; &lt;Container ID&gt;</code>或 <code>docker export &lt;Container ID&gt; &gt; &lt;匯出的檔案名稱.tar&gt;</code></p><p>匯入指令 <code>docker import &lt;匯入的檔案名稱與路徑&gt; &lt;映像檔名稱:版本標籤&gt;</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch5-利用-docker-compose管理多個-container">CH5 利用 Docker Compose管理多個 Container<a class="hash-link" href="#ch5-利用-docker-compose管理多個-container" title="Direct link to heading">​</a></h2><p>Docker和 Docker Compose是兩個各自獨立的程式，Docker Compose需要額外安裝</p><p>主要功能和使用情境：</p><ul><li>管理多個 Container</li><li>自動化（透過將 docker run的設定放進 docker-compose.yml的方式達到更彈性與自動化的部署）</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-composeyml文件指令">docker-compose.yml文件指令<a class="hash-link" href="#docker-composeyml文件指令" title="Direct link to heading">​</a></h3><p>（指令太多了一時間筆記不完，沒實際操作也吸收不了，所以就先跳過）</p><p>頂層指令：</p><p>version</p><p>services</p><p>volumes</p><p>networks</p><p>configs</p><p>scerets</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="常用指令">常用指令<a class="hash-link" href="#常用指令" title="Direct link to heading">​</a></h3><p><code>docker-compose</code>的指令幾乎是和 <code>docker</code>的指令相同，不過 <code>docker-compose</code>指令的操作都是基於 <code>docker-compose.yml</code>的內容，所以也就可以更容易的進行批次操作。另外，<code>docker-compose</code>指令多是以  <code>docker-compose.yml</code>檔案裡的 service名稱來做為參數使用，不直接給 Container的名稱</p><p><code>-f</code> 選項指定 docker-compose.yml檔案路徑和名稱，例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f ~/node-red/docker-compose.yml config -q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>docker-compose config</code>：檢視檔案內容</p><p><code>docker-compose build</code>：使用 Dockerfile產生 Docker Image</p><p><code>docker-compose pull &lt;Image&gt;</code> 或 <code>docker-compose pull</code>：指定取得一個或多個 Image（ 如未指定則下載所有 docker-compose.yml檔所有指定的 Image檔），例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose pull node-red db</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>start</code>, <code>stop</code>, <code>restart</code>, <code>pause</code>, <code>unpause</code>, <code>kill</code>：對指定或者全部 Container進行操作</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 停止指定 Container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose stop node-red db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 停止全部 Container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose stop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>docker-compose rm</code>：和 <code>docker rm</code>指令相同，可以用來移除已經停止運行的 Container</p><p><code>docker-compose run</code>：和 <code>docker run</code>指令相同，可以用來啟動 Container</p><p><code>docker-compose up</code>：最常使用的指令，用來啟動所有的服務</p><p><code>docker-compose up</code>的常用選項：</p><ul><li><code>-d</code>： 在背景模式下執行</li><li><code>--no-recreate</code>： 不需要重建每個服務所使用的 Container</li><li><code>--force-recreate</code>：無論 docker-compose.yml或 Image檔案有無調整或改變，都強迫執行重新建立服務所使用的 Container的動作</li></ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/docker">docker</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/gitlab-ci">gitlab-ci</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2021/2021-09-23-「Docker這樣學才有趣」讀書筆記.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2021/12/14/scrum-and-waterfall"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">瀑布或敏捷開發的選擇？三眼怪Podcast筆記</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2021/06/24/vue-recursive-component"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Vue Recursive Component</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前言" class="table-of-contents__link toc-highlight">前言</a></li><li><a href="#ch1-docker的能與不能" class="table-of-contents__link toc-highlight">CH1 Docker的能與不能</a></li><li><a href="#ch2-必學的-docker功能與指令" class="table-of-contents__link toc-highlight">CH2 必學的 Docker功能與指令</a><ul><li><a href="#下載及啟用-image映象檔" class="table-of-contents__link toc-highlight">下載及啟用 Image（映象檔）</a></li><li><a href="#查看啟動過的-container" class="table-of-contents__link toc-highlight">查看啟動過的 Container</a></li><li><a href="#停用和啟用-container" class="table-of-contents__link toc-highlight">停用和啟用 Container</a></li><li><a href="#詳細-container資訊" class="table-of-contents__link toc-highlight">詳細 Container資訊</a></li><li><a href="#一次作多個-container" class="table-of-contents__link toc-highlight">一次作多個 Container</a></li><li><a href="#搬移檔案" class="table-of-contents__link toc-highlight">搬移檔案</a></li><li><a href="#查看-container使用資源cpu記憶體" class="table-of-contents__link toc-highlight">查看 Container使用資源（CPU、記憶體）</a></li><li><a href="#查看-container的即時-log" class="table-of-contents__link toc-highlight">查看 Container的即時 Log</a></li></ul></li><li><a href="#ch3-docker-container的進階操作" class="table-of-contents__link toc-highlight">CH3 Docker Container的進階操作</a><ul><li><a href="#container-命名" class="table-of-contents__link toc-highlight">Container 命名</a></li><li><a href="#環境變數" class="table-of-contents__link toc-highlight">環境變數</a></li><li><a href="#docker-run-與-docker-create" class="table-of-contents__link toc-highlight">docker run 與 docker create</a></li><li><a href="#docker-kill-與-docker-stop" class="table-of-contents__link toc-highlight">docker kill 與 docker stop</a></li><li><a href="#執行-container內的程式或指令" class="table-of-contents__link toc-highlight">執行 Container內的程式或指令</a></li><li><a href="#自動移除自動重新啟動" class="table-of-contents__link toc-highlight">自動移除、自動重新啟動</a></li><li><a href="#進入-container操作命令列" class="table-of-contents__link toc-highlight">進入 Container操作命令列</a></li><li><a href="#container綁定-ip" class="table-of-contents__link toc-highlight">Container綁定 IP</a></li><li><a href="#docker-network" class="table-of-contents__link toc-highlight">docker network</a></li><li><a href="#data-volume---docker-run直接指定本機路徑" class="table-of-contents__link toc-highlight">Data Volume - docker run直接指定本機路徑</a></li><li><a href="#data-volume---data-volumn-create" class="table-of-contents__link toc-highlight">Data Volume - data volumn create</a></li></ul></li><li><a href="#ch4-各種自製-docker-image的方法" class="table-of-contents__link toc-highlight">CH4 各種自製 Docker Image的方法</a><ul><li><a href="#從運行中的-container產生映像檔" class="table-of-contents__link toc-highlight">從運行中的 Container產生映像檔</a></li><li><a href="#dockerfile的-build指令" class="table-of-contents__link toc-highlight">Dockerfile的 Build指令</a></li><li><a href="#匯入匯出-image檔" class="table-of-contents__link toc-highlight">匯入/匯出 Image檔</a></li><li><a href="#用-container匯出-image" class="table-of-contents__link toc-highlight">用 Container匯出 Image</a></li></ul></li><li><a href="#ch5-利用-docker-compose管理多個-container" class="table-of-contents__link toc-highlight">CH5 利用 Docker Compose管理多個 Container</a><ul><li><a href="#docker-composeyml文件指令" class="table-of-contents__link toc-highlight">docker-compose.yml文件指令</a></li><li><a href="#常用指令" class="table-of-contents__link toc-highlight">常用指令</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">筆記</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/upstairs0102" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/@upstairs0102" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/shangdeyou/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Adam You. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.24867ba9.js"></script>
<script src="/assets/js/main.bc2d944c.js"></script>
</body>
</html>