<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Dev Notes Blog</title>
        <link>https://upstairs0102.github.io/blog</link>
        <description>Dev Notes Blog</description>
        <lastBuildDate>Tue, 12 Sep 2023 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[RxJS中一些容易混淆的名詞]]></title>
            <link>https://upstairs0102.github.io/blog/2023/09/12/confusing-terms-in-rxjs</link>
            <guid>2023/09/12/confusing-terms-in-rxjs</guid>
            <pubDate>Tue, 12 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>在我學習 RxJS的時候我發現我遇到的第一個學習障礙就是一些很相似的名詞，雖然說書裡寫的感覺好像都說了，可是還是有點模糊。</p><p>比如說：在討論 Design Pattern的時候，Observer Pattern 的「被觀察者」是 <strong>Subject</strong>，而 RxJS的世界裡是講 <strong>Observable</strong>，但 Observable裡又有多種不同特性的類別包含 Observable類別以及 Subject類別等，所以你只說「Observable」有可能指的是「被觀察者」，如果是的話它也會包含 Subject類別，而如果說的是「Observable類別」那就是針對那個類別的物件在做討論…</p><p>我花了一點時間做筆記以及整理才把這些名詞弄清楚，但真的要到熟悉也還是到實際有寫了一些摳之後了…</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一通稱">一、通稱<a class="hash-link" href="#一通稱" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stream串流資料流">Stream（串流/資料流）<a class="hash-link" href="#stream串流資料流" title="Direct link to heading">​</a></h3><p>ReactiveX中所有可操作的東西都稱之為串流(Stream)，使用中文時有時候會直接用「資料流」</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subject">Subject<a class="hash-link" href="#subject" title="Direct link to heading">​</a></h3><p>「觀察者模式 (Observer Pattern)」中的被觀察的目標（但在rxjs語境當中會使用 Observable）</p><blockquote><p>Observer Pattern:</p><p>  <img loading="lazy" alt="image-20230912102647192" src="/assets/images/image-20230912102647192-e9a572926dbbb4d1e4c6cad915aba9ce.png" width="740" height="320" class="img_ev3q"></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="observer">Observer<a class="hash-link" href="#observer" title="Direct link to heading">​</a></h3><p>「觀察者模式 (Observer Pattern)」中的觀察者，當資料流發生時 Subject會推播給 Observer。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="observable">Observable<a class="hash-link" href="#observable" title="Direct link to heading">​</a></h3><p>ReactiveX中所有的資料流都是「可被觀察的」(Observable)，這些物件可被通稱為「Observable物件」。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subscriber">Subscriber<a class="hash-link" href="#subscriber" title="Direct link to heading">​</a></h3><p>訂閱者，感覺上和 Observer很像，但是使用場景不太一樣。我的理解是他是被用在 <code>Observable</code>物件的資料流中的訂閱者物件（如下範例），而<code>Observable</code>物件具有 「Cold Observable」特性，資料流是發生在訂閱之後才會發生，所以資料流就是發生在「訂閱者」而不是「被觀察者」身上了。</p><blockquote><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> source$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">subscriber</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">data</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Observable 第一次訂閱: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-variable function" style="color:#d73a49">complete</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'第一次訂閱完成'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">observer</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>進一步了解可參考網路上的討論 <a href="https://stackoverflow.com/questions/66939462/rxjs-is-observer-and-subscriber-the-same-thing" target="_blank" rel="noopener noreferrer">RxJS Is Observer and Subscriber the same thing?</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二類別物件">二、類別（物件）<a class="hash-link" href="#二類別物件" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="observable類別">Observable類別<a class="hash-link" href="#observable類別" title="Direct link to heading">​</a></h3><p>指實作「Hot Observable」的類別，為了和通稱的「被觀察者」做區別，我會講「Observable類別」而不會只講「Observable」，這樣會比較明確一點。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subject-1">Subject<a class="hash-link" href="#subject-1" title="Direct link to heading">​</a></h3><p>指實作「Cold Observable」的類別，雖然他也是一種 Observable（通稱），但是在明確的講是使用哪種類別的時候他和 「Observable類別」就是不同的類別，其它的類別還有 <code>BehaviorSubject</code>、<code>ReplaySubject</code>、<code>AsyncSubject</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subscription">Subscription<a class="hash-link" href="#subscription" title="Direct link to heading">​</a></h3><p>Observable使用 <code>subscribe()</code>方法回傳的物件稱為 Subscription，可以使用 <code>unsubscribe</code>方法來取消訂閱。</p><blockquote><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> subscription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 取消訂閱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subscription</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote>]]></content:encoded>
            <category>rxjs</category>
        </item>
        <item>
            <title><![CDATA[[RxJS] 去除掉 combineLatest 中同時間的重覆事件]]></title>
            <link>https://upstairs0102.github.io/blog/2023/09/12/combinelatest-duplicate-events</link>
            <guid>2023/09/12/combinelatest-duplicate-events</guid>
            <pubDate>Tue, 12 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[由於combineLatest 是用來組合多個 Observable 的事件值的，所以每一個 Observable 的事件都會被訂閱到。]]></description>
            <content:encoded><![CDATA[<p>由於<code>combineLatest</code> 是用來組合多個 Observable 的事件值的，所以<strong>每一個 Observable 的事件都會被訂閱到</strong>。</p><p>如果每一個 Observable 都是「不同時」發生的，則會取得「當下」每一個 Observable 最後一次的事件值。</p><p>但現在要處理的狀況是 - 如果有多個 Observable 是「同時」發生事件的，也仍然會產生多個訂閱事件，這個就不一定符合<strong>「只取最後一次事件資料」</strong>的目的。</p><blockquote><p>我在這邊所說的「同時」從程式的角度來看其實不是很精確，畢竟程式是一行一行執行的，多個 Observable 的訂閱事件也一定就會有先後順序，那就不會是同時的。但我想表達的比較像是 RxJS常用的彈珠圖上（或者也可以說是時間軸）同一時間所發生的事件。</p></blockquote><p>以下的範例如果畫成彈珠圖的話，在第0秒和第1秒各別有三個 Observable（在這邊用的是 <code>Subject</code>類別）的訂閱事件，第0秒的時候由於三個 Observable在事前都沒有任何資料，所以只會在三個都取得第一個資料後產生一個訂閱事件，而第1秒鐘的時候由於三個 Observable會分別跟其它 Observable的最後一次事件資料組合，所以共會產生三個訂閱事件。程式碼如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> b$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> c$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> stream$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">combineLatest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a$</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b$</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c$</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'A1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'B1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'C1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  a$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'A2'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  b$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'B2'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  c$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'C2'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ['A1', 'B1', 'C1']</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ['A2', 'B1', 'C1']</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ['A2', 'B2', 'C1']</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ['A2', 'B2', 'C2']</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>畫成彈珠圖的話就會是</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">['A1', 'B1', 'C1']----(['A2', 'B1', 'C1']['A2', 'B2', 'C1']['A2', 'B2', 'C2']|)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果我們只想要在第0秒以及第1秒各發生一次訂閱事件的話，要解決這個問題只要加上 <code>switchMap</code>，轉換出來的 Observable，同時間的訂閱事件只會有一次，而且可以取到同時間每個 Observable 最後一次的事件值：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> b$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> c$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> stream$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">combineLatest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a$</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b$</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c$</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">switchMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'A1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'B1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'C1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  a$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'A2'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  b$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'B2'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  c$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'C2'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ['A1', 'B1', 'C1']</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ['A2', 'B2', 'C2']</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>畫成彈珠圖的話就會是</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">['A1', 'B1', 'C1']----(['A2', 'B2', 'C2']|)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這個原理是<strong><code>switchMap</code> 每次轉換時會把前一次還沒結束掉的 Observable給結束訂閱</strong>。</p><p>而這個例子來看，<code>a$</code>、<code>b$</code>、<code>c$</code> 三者雖然是同時間呼叫 <code>next()</code>，但是這三者在被執行完訂閱事件 <code>subscribe()</code>結束之前訂閱都不算完成，所以在前面說的規則（每次轉換時會把前一次還沒結束掉的 Observable給結束訂閱）之下，<code>a$</code> 會被 <code>b$</code> 的訂閱事件結束掉、<code>b$</code> 會被 <code>c$</code> 的訂閱事件結束掉，最後只剩下 <code>c$</code> 的訂閱事件。</p><p>*<!-- --> 注意：<code>switchMap</code>的參數要在 function 前面加上 <code>async</code>標籤才能夠正確執行。</p>]]></content:encoded>
            <category>rxjs</category>
        </item>
        <item>
            <title><![CDATA[工作心得 - 關於前後端]]></title>
            <link>https://upstairs0102.github.io/blog/2023/07/09/experience-frontend-and-backend</link>
            <guid>2023/07/09/experience-frontend-and-backend</guid>
            <pubDate>Sun, 09 Jul 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[長文]]></description>
            <content:encoded><![CDATA[<p>#關於前後端 #長文</p><p>在我們公司內技術的交流和分享算是蠻頻繁的，前一段時間有一些關於前後端差異的討論；畢竟這邊前後端分工的很明確，大家有一些先入為主的想法我也早已習以為常，只是偶爾還是會覺得黑人問號這樣。</p><p>我自己本身工作經歷和我同年紀的開發者有些不太一樣，從我出社會第一份工作開始就是寫前後端分離的架構（MVC之類的單體式架構我反而沒寫過）。由於需要同時寫前端框架和後端框架，所以不太會覺得是兩件事情，雖然有些問題比較適合只在後端或只在前端解決，但也有些問題是在哪邊寫都可以。再外加後來我也有一點的接案經驗，和朋友分工的時候也是輪流這次我寫前端他寫後端，下次我寫後端他寫前端，當然大家擅長的工具或技術不太一樣，但好像也從來沒有用前端或者後端去做角色分類的（比如誰是前端誰是後端之類的）。</p><p>當然上述時期的技術深度很有限，隨著時代進步專業分工也是一種趨勢，現在軟體開發最粗略的分工很多就是先一分為二再說，但這種奇怪的刻板印象和貼標籤方式也就出現。</p><p>以往被同事問到說前端和後端差別在哪裡，通常我的回答就是說一個程式的執行環境在瀏覽器上，另一個執行環境在server上，都一樣是寫程式這樣。會這樣回答是我真心這樣覺得 XD 至於會寫什麼也是要看你解決的問題是什麼也會不同啊，形象網頁、電商、或各種的SI，做的事情和需要的技術也都完全不同。就比如我寫前端也寫過需要一次處理幾百mb資料、然後還寫一大端演算法和數學去計算，你以為只有後端會做這種事嗎 XD</p><p>我講一下我的版本的前端和後端：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1商業上">1.商業上<a class="hash-link" href="#1商業上" title="Direct link to heading">​</a></h3><p>就商業上後端通常會更接近 Domain Know How，不管是哪一個領域的 Know How都會不太一樣，而且都會反映到資料結構和流程上面。再來就是不同 Scale的使用量在 infrastructure上又是完全不同的世界。很多東西也只能在業界中特定的level裡才能夠接觸的到。由於世界就是這麼大，在中型以上公司中後端這個詞會顯得很模糊，可能就會出現SRE、DevOps、DBA、MIS 叭啦叭啦。</p><p>從這個角度看前端就單純得多，通常前端已經透過 api 來取得資料，離 Domain Know How就比較遠了，但是會直接面對 End User，也就是說重點其實是在 UI 和 UX。UI/UX是一個比較新一點的名詞，古早時期講的是「切版」和「接API」，用最簡單的語言（省略掉一千字）來講現代和古代的差異就是差在「複雜度」而已，當複雜度到一定程度就可以把網頁當作是一種 app了，差別只在於應用程式使用 OS 的 API 而網頁使用 Web API，而且根據統計現在前端工程師的平均薪資也比手機app工程師還要來得高，可見其複雜度不可同日而語（我自己也寫過一點 app也上架過 app所以也不完全是鍵盤俠 XD）。再回到 UI/UX，當公司有重視到使用者體驗或一些門面問題，前端角色必然就會變得更重要，隨著重視程度增加，就會開始獨立出 Designer、UX Designer、UX Researcher等。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2技術上">2.技術上<a class="hash-link" href="#2技術上" title="Direct link to heading">​</a></h3><p>從技術上來看，後端的重點在「資料結構」和「系統設計」，這些知識對於本科系出身的人來說確實更有優勢，但實際上來說多靠工作經驗中學習，本科系優勢隨著出社會幾年後很快就會不見了。由於後端範圍廣泛，每個人走的路都會不太一樣，以我有限經驗沒辦法提出什麼精闢的見解 XD，但就我的觀察通常來說在小公司會比較著重整體系統架構和維運的知識，對技術的要求也沒那麼深入，在大公司很多也不見得能負責到什麼很重要的工作；所以通常來說很多人會選擇2~3年換一次工作來累積自己在不同面向的工作技能和實力。但我的意思也不是說前端不需要2~3年換一次工作，比較像是後端的職涯發展上多元一些會需要更多不同的角色變換來累積經驗，以及走出自己的道路。</p><p>從技術上來看前端的話，前端比較像是大家看的到的那個冰山，後端像是水面下看不到的冰塊。雖然水面上的冰山體積沒有水面下來得大，但是拋頭露面的代價是要能應付這個變化愈來愈快的世界，每一年都有新的設計趨勢，每一年都有新的商業應用，要怎麼討好使用者前端都首當其衝，也就因此前端會更著重在於「工具使用」的技能，在幾年前前端框架的戰國時期有人就戲稱每一天起床都會有新的前端框架誕生，畢竟什麼都要自己來造輪胎就太慢了，積極使用最新技術才跟得上時代進步速度。再來還有一個比較少人注意到的就是軟實力的部份，前端工程師不是要寫 code而已，前端是和後端、和設計師之間的橋樑，除了溝通能力外、還會需要一些設計思維，才能夠和設計師緊密合作。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3比較">3.比較<a class="hash-link" href="#3比較" title="Direct link to heading">​</a></h3><p>很多人對於前端工程師的印象會停留在前端很多轉職、非本科系等等，就覺得技術門檻沒那麼高，但真的是這樣嗎？就我前面提到的前端更著重在「工具使用」上，為跟上時代快速變化加上社群的發達，多數人思想上都比較開放多元一些，會更鼓勵和包容不同背景一人一起加入學習。但你如果想要進一步提升自己的時候就會遇到見山不是山的問題，要更進步還是需要去學習底層的知識。寫程式的本質是一樣的，軟體工程中常見的名詞前端所要學的和後端可能不太一樣，卻不會少，我第一份工作學 Angular.js 從第一天開始就被主管要求學什麼是 MVVM，什麼是依賴注入，因為這兩個都是 Angular.js 的核心邏輯；Vue有用到 Observer Pattern；React 主打 Functional Programing，Angular 喜歡寫 OOP（OOP和FP的戰爭就是這樣開始）；為提高邏輯的 reuse 最新的 Vue3和 React 也用各自的方式實作 Composition Pattern；再來前端使用狀態機幾乎都是標配，你後端有用到狀態機嗎（怒 XD）。這樣你要說軟工的東西是後端工程師在學的我是黑人問號。</p><p>因為分工上已經把互動的部份切到前端來做，所以前端有一大堆狀態管理上衍生出來的 issue，但後端 API 基本上主流的寫法通常都是 stateless的，一個input就會有同樣的output，API Service程式邏輯上反而沒那麼複雜，通常會比較著重在「資料結構」的設計上。但 API service只佔後端的一小塊，背後冰山下infrastructure的那一大塊才是後端奧妙之處，整個抽象化來看也就是所謂「系統設計」。就我有限的後端經驗來看，後端通常比較不喜歡處理變動性的問題，尤其是 Table Schema最好能不動就不要動，資料庫爛掉的話辦公室行李大概可以直接打包回家了，我記得我第一份工作常常待到半夜很多都是為了後端問題，辦公室裡剩下自己一個人拯救資料的的心情還記憶猶新。當然新的開發者也比較不會像以前的老工程師一樣抱著那種能不改就不要改的想法，有很多人開始投入 DevOps，其中 DevOps大多是由後端轉過去或者兼著做的，因為 DevOps裡面很重要的一塊CI/CD需要從整個系統架構來做設計。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4總結">4.總結<a class="hash-link" href="#4總結" title="Direct link to heading">​</a></h3><p>就整體來說，傳統的後端工程師會顯得較保守一點，相較來說前端因為發展的比較近期一點所以保守派也較少。但每間公司和每個人個體差異其實很大 - 寫前端也很多人只套框架但不學背後知識，很快就停止學習了；寫後端也很多新潮的框架、技術和社群、擁抱變動。如果要說哪個門檻比較低，那也只是因為只看到最低門檻而已，而且這種事情就是互為因果的問題，當你覺得某件事情不重要 → 那他就會變得不重要 → 最後他就真的不重要了。</p>]]></content:encoded>
            <category>job</category>
        </item>
        <item>
            <title><![CDATA[2023部落格搬家到 Docusaurus]]></title>
            <link>https://upstairs0102.github.io/blog/2023/01/02/new-docusaurus-website</link>
            <guid>2023/01/02/new-docusaurus-website</guid>
            <pubDate>Mon, 02 Jan 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[利用元旦的三天連假（雖然大概有一半時間是在耍廢），把我原本用 Hugo架的部落格文章全部搬到 Docusaurus上。]]></description>
            <content:encoded><![CDATA[<p>利用元旦的三天連假（雖然大概有一半時間是在耍廢），把我原本用 Hugo架的部落格文章全部搬到 Docusaurus上。</p><p>之前一直找不到我理想的部落，我最主要的困擾是很多部落格都沒有一個好的編目功能，舊的文章很容易就埋沒到分頁器中很難被檢視到。然後我又希望這個部落格是使用 Markdown格式的，所以能有的選擇就變得很侷限… （Wordpress就不符合我的需求了）。當時找了很久後是採用 Hugo，但其實不是很滿意，雖然它有 tag功能，但是還是卻少了文章分類的功能。</p><p>一直到我看到 Docusaurus才發現原來這個才是我需要的部落格。</p><p>雖然說 Docusaurus本身是設計來為建置文件內容的網站，但他也有部落格的功能。</p><p>具體來說，它將內容分為兩大類，分別為「文件」(<code>docs</code>)以及「部落格」(<code>blog</code>)。所謂「文件」，其實就長得和 gitbook差不多。雖然「部落格」功能並沒有我原本想要的編目功能，但我發現它的「文件」的編目方式其實反而才是我所需要的。同時有這兩種形式，兩者可以互相截長補短。</p><p>新年新氣象，有了新的部落格之後要來認真寫文章了（？）。</p>]]></content:encoded>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[node.js環境各種神秘問題解決]]></title>
            <link>https://upstairs0102.github.io/blog/2022/12/21/node-env-problems-of-frontend-project-solved</link>
            <guid>2022/12/21/node-env-problems-of-frontend-project-solved</guid>
            <pubDate>Wed, 21 Dec 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>開發 Vue專案過程當中遇過各種node環境的神秘問題。最奇怪的是本機端的 node版本和 server端完全相同，但是本機端的 npm install和 npm build是正常時，確不能保證 server端也同樣沒有問題。</p><p>我自己將常遇到的問題整理成筆記順便分享給大家。但每個人的開發環境及可能遇到的問題皆不相同，所以就僅供參考了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-切換node版本造成sass打包噴錯">1. 切換node版本造成sass打包噴錯：<a class="hash-link" href="#1-切換node版本造成sass打包噴錯" title="Direct link to heading">​</a></h2><p>首先確認 node跟 node-scss <a href="https://www.npmjs.com/package/node-sass" target="_blank" rel="noopener noreferrer">版本對照表</a>，初步排除裝錯版本的問題。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-npm神秘的-cache問題">2. npm神秘的 cache問題：<a class="hash-link" href="#2-npm神秘的-cache問題" title="Direct link to heading">​</a></h2><p>排除 cache的問題</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rm -r node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm cache clean --force</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再來重新 <code>npm install</code>、重新打包試試</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解決方式">解決方式<a class="hash-link" href="#解決方式" title="Direct link to heading">​</a></h3><p>如果上述問題都已排除，並且同樣的 package.json在不同環境下有的可以 build成功有的不成功（比如本機可以但server上失敗），這種情形通常是發生在有更換環境node版本的情形下。</p><p>解決方式：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm rebuild sass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然後再重新 <code>npm install</code>就可以了</p><p>我的理解是某些 package的依賴是存放在 npm的環境當中，而不是專案的 node_mobules當中，所以更換版本後要再重新編譯 (rebuild)。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-root權限問題">3. root權限問題：<a class="hash-link" href="#3-root權限問題" title="Direct link to heading">​</a></h2><p>錯誤訊息 <code>gyp ERR! stack Error: EACCES: permission denied</code></p><p>造成錯誤的原因是<code>npm</code>不適用 <code>root</code>帳戶權限，加上參數<code>--unsafe-perm=true --allow-root</code>可解決問題</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo npm i --unsafe-perm=true --allow-root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="參考資料">參考資料<a class="hash-link" href="#參考資料" title="Direct link to heading">​</a></h2><p><a href="https://stackoverflow.com/questions/48473984/what-is-difference-between-npm-install-and-npm-rebuild" target="_blank" rel="noopener noreferrer">What is difference between 'npm install' and 'npm rebuild'?</a></p><p><a href="https://segmentfault.com/q/1010000022868067" target="_blank" rel="noopener noreferrer">npm rebuild node-sass 是什么意思，为什么要使用</a></p><p><a href="https://blog.csdn.net/biao0309/article/details/90977752" target="_blank" rel="noopener noreferrer">npm install 报错，提示gyp ERR! stack Error: EACCES: permission denied 解决方法</a></p>]]></content:encoded>
            <category>javascript</category>
            <category>npm</category>
            <category>node.js</category>
            <category>webpack</category>
        </item>
        <item>
            <title><![CDATA[第一次發布 npm前端套件就上手]]></title>
            <link>https://upstairs0102.github.io/blog/2022/12/15/publish-js-library-to-npm</link>
            <guid>2022/12/15/publish-js-library-to-npm</guid>
            <pubDate>Thu, 15 Dec 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[一、前情提要]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一前情提要">一、前情提要<a class="hash-link" href="#一前情提要" title="Direct link to heading">​</a></h2><p>本篇文章以我自己開發的一個 library - <a href="https://github.com/upstairs0102/vue-component-sandbox" target="_blank" rel="noopener noreferrer">vue-component-sandbox</a>作為範例，說明發佈 javascript程式到 npm上面所需的相關步驟及設定。</p><p>以這個範例來說，vue-component-sandbox的主程式是一個 Vue.js 的 Component，我希望除了將主程式發布到 npm上以外，還希望能建立一個簡單的展示頁面，所以我選擇用vue-cli建立專案，把主程式和展示網頁放在相同專案裡。整個專案我推上Github並使用Github Pages布署靜態的展示頁面，並將Component檔案所在的資料夾發布至npm。</p><p>依照上述需求，本文重點有二：</p><ol><li>發布至npm的相關設定及方式</li><li>推上Github及布署範例網頁（Github Pages）</li></ol><p>註：本文的範例雖然是出自 vue-cli建置的專案，但要發布上 npm主要要做的是 package.json的設定，只有在布署範例網頁時需要做的路由及相關設定跟 Vue.js的框架有關外，其餘內容跟 Vue.js都沒什麼直接關係。所以基本上無論你使用何種前端框架、或沒有使用框架（而且概念是相同的），都不會影響到本文的閱讀。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二檔案及資料夾結構">二、檔案及資料夾結構<a class="hash-link" href="#二檔案及資料夾結構" title="Direct link to heading">​</a></h2><p>資料夾結構及檔案命名沒有標準的寫法，建議可參考 github上跟自己所要開發最相近的專案是怎麼設計。</p><p>以本文中雖然並不是重點但會跟後續內容息息相關，將會以 vue-component-sandbox作為範例，將本文相關的檔案及資料夾結構列出來，方便往後的章節可以對照著看：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ├──css</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ├──js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   └──index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ├──main.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   └──styles.css</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ├──components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ├──router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   └──main.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中幾個較重要的部份列出來說明：</p><ul><li><code>/demo</code> 展示頁面的資料夾。換句話說就是用 webpack打包出來的資料夾，vue-cli預設為 <code>dist</code>這裡只是修改了名稱而已。</li><li><code>/lib</code> 要發布至 npm的主檔的資料夾位置。</li><li><code>/src</code> 展示頁面原始檔案的資料夾（vue-cli 預設的檔案位置）。</li><li><code>package.json</code> node package 設定檔。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三發布至npm的相關設定及方式">三、發布至npm的相關設定及方式<a class="hash-link" href="#三發布至npm的相關設定及方式" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="必填的-packagejson欄位設定">必填的 package.json欄位設定<a class="hash-link" href="#必填的-packagejson欄位設定" title="Direct link to heading">​</a></h3><p>首先 webpack主要需要設定的是 package.json檔必填欄位：</p><ul><li><code>name</code>：node package 的名稱（發布至 npm上所使用的名稱）。</li><li><code>version</code>：版本號。每次發布都要大於過去的版本，否則就會發布失敗。</li><li><code>main</code>：node package 的主檔。</li></ul><p>其它輔助資訊欄位（非必填）有 <code>license</code>、<code>author</code>、<code>homepage</code>、<code>repository</code>等，相關的詳細說明可參考官方文件 <a href="https://docs.npmjs.com/creating-a-package-json-file" target="_blank" rel="noopener noreferrer">npm docs</a>。</p><p>以我 vue-component-sandbox作為範例如下。</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// package.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vue-component-sandbox"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.3.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"A vue component sandbox that is quick and easy to use."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"author"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Adam You &lt;upstairs0102@gmail.com&gt;"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"license"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"MIT"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"keywords"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"vue"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"component"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"sandbox"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"vue-component"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"main"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lib/main.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"files"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"lib/*"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"src/components/ComponentSandbox/*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="設定發布至npm的檔案">設定發布至npm的檔案<a class="hash-link" href="#設定發布至npm的檔案" title="Direct link to heading">​</a></h3><p>package.json中跟打包檔案相關的欄位有<code>main</code>和<code>files</code>。說明如下：</p><ul><li><p><code>main</code>：node package 的主檔。</p></li><li><p><code>files</code>：欄位是設定 node package的檔案範圍，同時也是會發布至 npm的檔案；如果此欄位沒有設定預設會發布所有的檔案。</p></li></ul><p>以上述的範例來作說明：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token string-property property" style="color:#36acaa">"main"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lib/main.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string-property property" style="color:#36acaa">"files"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"lib/*"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"src/components/ComponentSandbox/*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以此例來說，假設某人已將此套件透過 npm安裝 （指令<code>npm install vue-component-sandbox --save</code>） 至他的專案當中。在他的<code>node_modules</code>資料夾中可以找到 <code>vue-component-sandbox</code>資料夾，該資料夾內除了會有 package.json等基本的檔案外還會有 <code>lib</code>, <code>src</code>資料夾及檔案。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="在main主檔export-js-module">在main主檔export js module<a class="hash-link" href="#在main主檔export-js-module" title="Direct link to heading">​</a></h3><p>由於我不需要將專案中所有的檔案發布到 npm上（比如展示頁面），所以我只將需要的資料夾寫入前一章節所說的 <code>files</code>欄位中，然後在主檔（<code>main</code>欄位中設定的）中把需要的檔案給 <code>export</code>出來。</p><p>此例的主檔（<code>main</code>欄位的設定）是<code>lib/main.js</code>，此檔案內容是這樣寫的：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// lib/main.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token exports punctuation" style="color:#393A34">{</span><span class="token exports"> </span><span class="token exports keyword module" style="color:#00009f">default</span><span class="token exports"> </span><span class="token exports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'../src/components/ComponentSandbox/ComponentSandbox.vue'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由於此例中 export的寫法是 <code>export default</code>，假設某人使用 npm安裝了此套件（安裝至 node_modules），在他的程式當中要 import此套件的語法為：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ComponentSandbox</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vue-component-sandbox'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 <code>vue-component-sandbox</code>對應的是 <code>name</code>欄位所設定的名稱，import進來的程式也就是主檔所 export 的 <code>default</code>。</p><p>安裝此套件的人如果需要 import除了主檔所提供的以外的程式，也可以使用相對路徑的方式，比如：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vue-component-sandbox/lib/styles.css'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以此例的寫法，<code>vue-component-sandbox</code>就不是代表主檔，而是套件專案根目錄的路徑（也等同於被安裝的專案中<code>node_modules</code>為起始的相對路徑）。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dependency-和-devdependency的差異">dependency 和 devDependency的差異<a class="hash-link" href="#dependency-和-devdependency的差異" title="Direct link to heading">​</a></h3><p>每個前端的開發者應該都會知道 <code>dependency</code>是生產環境的依賴、<code>devDependency</code>是開發環境的依賴，但真正知道差異的人可能就沒那麼多了。因為我們通常都會按照文件上所提供的指令來安裝，而且無論放哪邊通常也不會出錯，所以大多數人也不太清楚差異。</p><p>但是要發布到 npm上就會有一些要注意的事。</p><p>最直觀的差異就在於其他專案依賴了你的 node package之後（透過 npm安裝），你的 package.json 中 <code>dependency</code>的依賴會被「鏈式」的安裝到 node_modules資料夾中。</p><p>了解了這個差異，我們就可以進一步理解所謂<strong>「 <code>dependency</code>是生產環境的依賴」更具體的意思是說，當這個 node package被布署到 npm之後（生產環境）的依賴，而「<code>devDependency</code>是開發環境的依賴」指的是未發布到 npm時的依賴（即使這個 node專案被打包並布署成為一個 web service）</strong>。</p><p>…講起來有些饒口，這裡用 vue-component-sandbox 作為例子。其 package.json 中的依賴的設定：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token string-property property" style="color:#36acaa">"dependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string-property property" style="color:#36acaa">"devDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"@vue/cli-plugin-babel"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"~4.5.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"@vue/cli-plugin-router"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"~4.5.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"@vue/cli-service"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"~4.5.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"@vue/compiler-sfc"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^3.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"core-js"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^3.6.5"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"github-fork-ribbon-css"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^0.2.3"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"vue"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^3.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"vue-json-pretty"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^2.0.0-rc.3"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"vue-router"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^4.0.0-0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>vue-component-sandbox是一個通時支援 Vue v2.x 及 v3.x版本的套件，開發者可以依照他本身的開發環境來安裝對應的依賴。README文件中的安裝指引有這樣的說明：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">支援Vue v2.x及v3.x。依賴vue-json-pretty套件，並且必須安裝對應版本：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vue v2.x =&gt; vue-json-pretty v1.7.1 以上，指令 npm install vue-json-pretty@1.7.1 --save</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vue v3.x，=&gt; vue-json-pretty v2.0.0-rc3 以上，指令 npm install vue-json-pretty@2.0.0-rc.3 --save</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再回頭來看上面的 package.json中我們可以看到所有的依賴都被安裝到 <code>devDependencies</code>了，所以開發者透過 npm安裝了這個 node package (vue-component-sandbox)之後，必須自己手動安裝他的 Vue版本所對應的 <code>vue-json-pretty</code>版本。</p><p>反之，如果 package.json將所有的依賴都放到了 <code>dependencies</code>而不是本例中的 <code>devDependencies</code>，開發者安裝這個 node package (vue-component-sandbox)後就不需要再自己手動安裝 <code>vue-json-pretty</code>，但就沒有辦法讓開發者選擇自己所需要的版本來安裝了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publish">Publish!<a class="hash-link" href="#publish" title="Direct link to heading">​</a></h3><p>完成上述所有事情之後，剩下的工作就非常簡單了：</p><p>1.至 npm官網上註冊 npm帳號</p><p>2.在專案中下指令 <code>npm publish</code>即成功發布！（鍵入指令後 console會指引你相關事項，比如此台電腦未登入npm帳號的話需要先輸入指令登入帳號）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四推上github及布署範例網頁">四、推上Github及布署範例網頁<a class="hash-link" href="#四推上github及布署範例網頁" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="readmemd">README.md<a class="hash-link" href="#readmemd" title="Direct link to heading">​</a></h3><p>github頁面上預設會把 repo中根目錄中的 README.md檔案內容呈現出來，因此學習 <a href="https://markdown.tw/" target="_blank" rel="noopener noreferrer">markdown</a>文件撰寫是非常必要的（也很簡單），務必將 README.md文件盡可能的撰寫完整。</p><p>以 vue-component-sandbox為例，由以下章節內容組成：</p><ul><li>Features: 用簡單的幾句話清楚的介紹此 repo的特色及用途。</li><li>Links: 相關連結，包含 npm頁面及展示頁連結。</li><li>Environment: 安裝此套件的環境需求。</li><li>Install: 安裝方式。</li><li>Usage: 使用方式說明；建議可以的話要提供一個 Quick Start（最簡易讓程式可以執行的方式），另外API文件也是必要的。</li></ul><p>同樣的，文件沒有標準的寫法，建議可參考 github上跟自己所要開發最相近的專案是怎麼撰寫的。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="製作範例網頁">製作範例網頁<a class="hash-link" href="#製作範例網頁" title="Direct link to heading">​</a></h3><p>製作範例頁的好處，除了開發者在瀏覽網頁時就可以快速看到成果，並且在 pull程式碼到本機後就有了可以執行的範例程式。</p><p>我們要把範例頁透過 Github Pages來布署，因此範例頁必須是 static的網頁，每一個頁面必須要有一個實體的 html檔案。如果我們想透過前端路由開發 SPA網頁，一個可行的方式是透過 URL上 <code>#</code>符號來跟前端路由溝通。這種模式在 Vue框架中稱為 <strong>Hash Mode</strong>，在其它的前端框架比如 React, Angular也都有相同的路由設定。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="github-pages啟用設定">Github Pages啟用設定<a class="hash-link" href="#github-pages啟用設定" title="Direct link to heading">​</a></h3><p>透過 Github Pages架設的網址依據 repo的名稱會有所不同，規則有兩種：</p><ul><li>repo名稱為 <code>{account-name}.github.io</code>：網址為 <code>https://{account-name}.github.io</code></li><li>其它任何的 repo名稱：網址為 <code>https://{account-name}.github.io/{repo-name}</code></li></ul><p>由於本文主題是要發布到 npm上的套件，我們不太可能把一個 open source libaray的名稱命名為 <code>upstairs0102.github.io</code>，這樣的話也太奇怪了！因此在這裡我們只會使用後者的規則。</p><p>Github Pages的設定預設是關閉的，我們必須在設定頁將之開啟，如下：</p><p><img loading="lazy" alt="image-20221214211444854" src="/assets/images/image-20221214211444854-003cb113757b101475716cdaffee6605.png" width="873" height="467" class="img_ev3q"></p><p>你可以選擇設定特定 Branch，不過以本文範例來說並不是以 Branch區分檔案用途，而是直接將範例頁的檔案以及 source code放在一起並用資料夾區分，因為直接用預設的 <code>main</code> branch即可。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vue相關設定">Vue相關設定<a class="hash-link" href="#vue相關設定" title="Direct link to heading">​</a></h3><p>本文範例使用 Vue框架（使用 vue-cli建置的），不過如果你使用其它框架、或無使用框架其實原理和設定都是差不多的，不會影響到本章節的閱讀。</p><p>有以下幾個相關設定：</p><ol><li>前端路由設定</li><li>打包資料夾路徑</li></ol><p>前端路由的部份，在前面我們有提過本範例為了要做 SPA型式的展示頁，前端路由要設置為 Hash Mode。以 Vue框架來說我們只要到 Vue-Router 中將 <code>history mode</code>屬性設為 <code>false</code>即可。</p><p>再來要注意的是 Vue-Cli（其它框架亦同）預設會把 domain name當作根路徑，所以我們也要做一些相應的調整；具體的來說我們要把前端路由的基本 URL設定為 <code>/{repo-name}/{file-path}</code>。這裡我們直接用範例來說明會更清楚，<code>vue.config.js</code>會有以下的設定：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">publicPath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/vue-component-sandbox/demo/'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">outputDir</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'demo'</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 本例中我們把打包過的檔案放到 demo資料夾中，如無設定 vue-cli預設會放到 dist資料夾</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>關於 publicPath詳細說明可參考<a href="https://cli.vuejs.org/zh/config/#publicpath" target="_blank" rel="noopener noreferrer">官方文件</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五結語">五、結語<a class="hash-link" href="#五結語" title="Direct link to heading">​</a></h2><p>本文以 vue-component-sandbox做為範例來做說明，除了發布 npm、還包含了 Github Pages布署範例網頁的說明，應該是包含了大多數發布 open source的 javascript library所需要的事項，大家可以依照自己的需求選讀自己有幫助的章節。</p>]]></content:encoded>
            <category>javascript</category>
            <category>npm</category>
            <category>github</category>
        </item>
        <item>
            <title><![CDATA[xlsx-js-style 前端匯出自訂樣式Excel檔]]></title>
            <link>https://upstairs0102.github.io/blog/2022/12/07/xlsx-js-style</link>
            <guid>2022/12/07/xlsx-js-style</guid>
            <pubDate>Wed, 07 Dec 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>基於某些原因最近有在前端匯出excel檔、並且有自訂欄位樣式的需求。雖然以前就有開發過前端匯出Excel的功能，而且套件選擇也還算多實作也不難（當時是使用Export2Excel），但要自訂樣式的話我就沒做過了。</p><p>花了一段時間google發現事情似乎並沒那麼簡單。雖然說肯定是找一個套件並依api文件來實作就結束了，不會難到哪裡去；但麻煩的是網路上的資訊有些混亂，有一些教學文章又太過複雜，似乎沒看到哪個套件是比較被多數人使用並且有清晰的文件的。</p><p>花了一些時間研究，剛好找到了一個合適的套件叫 <code>xlsx-js-style</code>，它是使用另一個套件 <a href="https://sheetjs.com/" target="_blank" rel="noopener noreferrer">SheetJS</a>相同的API並且擴充了額外可自訂樣式的 API（SheetJS似乎沒提供樣式設定的API）。</p><p>主要功能的API <code>xlsx-js-style</code>文件裡並沒有寫，必須要到<code>SheetJS</code>的<a href="https://docs.sheetjs.com/docs/" target="_blank" rel="noopener noreferrer">官方文件</a>裡面查閱，而樣式相關的文件則在 <a href="https://github.com/gitbrent/xlsx-js-style" target="_blank" rel="noopener noreferrer">xlsx-js-sty le的官方文件</a>裡面查閱。</p><p>這個套件的 API非常多，有需要可自行到上述連結查閱，本篇文章只會介紹到以下幾個剛好我這次有用到的功能：</p><ul><li>欄位底色</li><li>欄位寬度</li><li>字體顏色                                                                                                                                  </li><li>合併欄位</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="快速上手xlsx-js-style">快速上手xlsx-js-style<a class="hash-link" href="#快速上手xlsx-js-style" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="開始使用">開始使用<a class="hash-link" href="#開始使用" title="Direct link to heading">​</a></h3><p>撰寫這篇文章的時候 <code>xlsx-js-style</code>的版本為 v1.2.0，目前為止文件並不是寫得非常清楚，文件裡只有寫到如何使用 <code>script</code>標籤載入：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">script src</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"dist/xlsx.bundle.js"</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">script</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>至於如何在 js module中 import進來就沒提到了。不過我就是依照經驗試試看… 果然可以：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">XLSX</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'xlsx-js-style'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接著，使用套件的起手試，就是先試著使用最簡範例；以下為文件上的範例，直接貼上就是一個可執行的程式：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// STEP 1: Create a new workbook</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> wb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">XLSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">book_new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// STEP 2: Create data rows and styles</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> row </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">v</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Courier: 24"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">t</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">font</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Courier"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">sz</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">v</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"bold &amp; color"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">t</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">font</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">bold</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">color</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">rgb</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"FF0000"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">v</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"fill: color"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">t</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">fill</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">fgColor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">rgb</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"E9E9E9"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">v</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"line\nbreak"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">t</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">alignment</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">wrapText</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// STEP 3: Create worksheet with rows; Add worksheet to workbook</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ws </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">XLSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">aoa_to_sheet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">row</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">XLSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">book_append_sheet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ws</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"readme demo"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// STEP 4: Write Excel file to browser</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">XLSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">writeFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"xlsx-js-style-demo.xlsx"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="欄位樣式">欄位樣式<a class="hash-link" href="#欄位樣式" title="Direct link to heading">​</a></h3><p><code>xlsx-js-style</code> 提供 <a href="https://github.com/gitbrent/xlsx-js-style#cell-style-properties" target="_blank" rel="noopener noreferrer">Style API</a>，在文件上有 api可查詢。如同前面的範例，使用方式是放在 data row當中的 <code>s</code>屬性當中。</p><p>比如：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">font</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">bold</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">color</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">rgb</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ffffff'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">fill</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">fgColor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">rgb</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'c00000'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> 其中 <code>font</code>, <code>fill</code>可以對應到 api文件上的 <code>Style Prop</code>欄位，其屬性值可以進一步的從文件中的表格查閱到。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其它的常用功能">其它的常用功能<a class="hash-link" href="#其它的常用功能" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sheetjs文件">SheetJS文件<a class="hash-link" href="#sheetjs文件" title="Direct link to heading">​</a></h3><p> <code>xlsx-js-style</code>主要是擴展了 <code>SheetJS</code>原有的 API，所以除了 Style API以外的 Core API就沒有放到文件當中了，必須要到 <code>SheetJS</code>的<a href="https://docs.sheetjs.com/docs/csf/" target="_blank" rel="noopener noreferrer">文件</a>來查閱。</p><p>後面我會說明我自己常用到的 API。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="欄位寬度">欄位寬度<a class="hash-link" href="#欄位寬度" title="Direct link to heading">​</a></h3><p>欄位寬度的設定要放在 WorkSheet底下的 <code>!cols</code>物件當中。範例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> wscols </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">wch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// "characters"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">wpx</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// "pixels"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">hidden</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// hide column</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ws</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'!cols'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wscols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">XLSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">book_append_sheet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ws</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"readme demo"</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>陣列當中的物件順序即對應欄位順序，其中屬性如下：</p><ul><li>wch: 字元數量</li><li>wpx: pixels</li><li>hidden: 隱藏</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="合併儲存格">合併儲存格<a class="hash-link" href="#合併儲存格" title="Direct link to heading">​</a></h3><p>合併儲存格的設定要放在 WorkSheet底下的 <code>!merge</code>物件中當。範例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> merge </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">r</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">c</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">e</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">r</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">c</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">r</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">c</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">e</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">r</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">c</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ws</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"!merges"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> merge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>屬性說明：</p><ul><li><code>s</code>: 合併起始欄位位置 (start)</li><li><code>e</code>: 合併結束欄位位置 (end)</li><li><code>r</code>: 列 index (row)</li><li><code>c</code>: 欄 index (column)</li></ul><p>以上面例子來說明，即為從【列0、欄0】合併至【列0、欄7】，以及從【列3、欄0】合併至【列3、欄7】。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="換行">換行<a class="hash-link" href="#換行" title="Direct link to heading">​</a></h3><p>換行需使用 Style API中設定換行樣式：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">alignment</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">wrapText</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接著欄位值當中就可以加入換行符號 <code>\n</code>。</p><p>以下為Cell加入換行文字的範例：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">v</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'第一行\n第二行'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">alignment</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">wrapText</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="小結">小結<a class="hash-link" href="#小結" title="Direct link to heading">​</a></h2><p>在研究匯出 excel功能當中，找尋合適的套件反而是花最多時間的部份。這個 <code>xlsx-js-style</code>是我找到都有符合我的需求的一個套件，再來就是 <code>SheetJS</code>的文件也有點多不太好查找，所以就把我自己常用到的功能整理起來給大家參考。</p><p><a href="https://github.com/gitbrent/xlsx-js-style" target="_blank" rel="noopener noreferrer">https://github.com/gitbrent/xlsx-js-style</a></p><p>SheetJS文件（可以看完整的api）</p><p><a href="https://docs.sheetjs.com/docs/csf/" target="_blank" rel="noopener noreferrer">https://docs.sheetjs.com/docs/csf/</a></p><p>合併儲存格</p><p><a href="https://stackoverflow.com/questions/53516403/sheetjs-xlsx-how-to-write-merged-cells" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/53516403/sheetjs-xlsx-how-to-write-merged-cells</a></p><p>寬度</p><p><a href="https://github.com/SheetJS/sheetjs/issues/1158" target="_blank" rel="noopener noreferrer">https://github.com/SheetJS/sheetjs/issues/1158</a></p><p>換行</p><p><code>\n</code> 換行</p><p><code>cell.s = {alignment:{ wrapText: true }}</code></p>]]></content:encoded>
            <category>javascript</category>
        </item>
        <item>
            <title><![CDATA[Vue & React差異觀察]]></title>
            <link>https://upstairs0102.github.io/blog/2021/12/14/difference-between-vue-and-react</link>
            <guid>2021/12/14/difference-between-vue-and-react</guid>
            <pubDate>Tue, 14 Dec 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[以前幫公司協助面試過新人，早期我們在職缺條件上沒有特別列出需要有什麼前端框架的經驗，所以曾經有遇過背景是 react的受試者問說，為什麼我們是選擇框架的時候是 vue而不是 react，當時我就已經能夠很清楚得回答這個問題了，不過最近我對 react的了解有更加深入了之後，我對這有了一些新的想法…]]></description>
            <content:encoded><![CDATA[<p>以前幫公司協助面試過新人，早期我們在職缺條件上沒有特別列出需要有什麼前端框架的經驗，所以曾經有遇過背景是 react的受試者問說，為什麼我們是選擇框架的時候是 vue而不是 react，當時我就已經能夠很清楚得回答這個問題了，不過最近我對 react的了解有更加深入了之後，我對這有了一些新的想法… </p><ol><li><p>最大的差異就是思考邏輯和 design pattern的不同，簡單區分 react比較多 functional programing，vue 比較多 observer pattern。很多人說 react更自由、vue更簡單，但就我的感覺自從 vue3推出以後以及 react增加 hooks功能以後，兩者其實愈來愈像了，實務上我幾乎還沒遇過什麼 react做的到但 vue做不到的事（只是做法會不一樣）（最近 react18的 streaming HTML，vue確實沒有）、react也不像以前那麼麻煩以及那麼多不同門派。</p></li><li><p>我還是覺得react的開發成本更高（缺點先講但後面我會補上優點啦 XD），要說明這件事可能需要寫成一整篇文章才講的完，不過我可以列幾個我感受最強烈的差異：(1) React的 controlled component是將狀態交給父層來管理，不像 vue可以簡單的讓 component自己在內部管理，而父層直接透過雙向綁定來同步（響應）資料即可，React的單向資料流特性對於大量表單元件的系統裡造成很大的麻煩，光這件事就足以讓我慶幸當初在公司內選擇框架的時候還好沒有選擇 react（我們公司很多系統類的外包專案） (2) vue因為原本就是 observer pattern為主要的設計模式，所以監聽狀態變更更加的容易且簡潔，而 react需要針對每一個狀態去處理 side effect會更加麻煩許多 (3) react 的設計風格會展現在每一個地方，所以相關的套件、框架，每一件事情就是會比 vue麻煩一點點，但很多的一點點累加起來就是麻煩許多，而且程式碼裡會在每一個角落裡充斥著跟業務邏輯無關的程式碼…</p></li><li><p>react的 functional programing風格也表現在樣式的編寫上，所以主流是以 css in js 的方式在編寫樣式，也就是說將 css寫成 js，包進各別的 component內。簡單來說，vue是 MVVM的設計模式，所以會很明確的將樣板和程式邏輯分開，而 react是將樣板和程式邏輯寫在一起。這件事會跟隨著團隊的分工以及流程上有所影響 - 在分工上「切版」是交由設計師來做的團隊裡，vue來開發會更適合，而 react更適合交由工程師來進行「切版」。如果要深入探究的話其實還有很多可以討論的地方，之前也有看過國外有文章在討論有人認為 css preprocessor會比 css in js來得更優，因為css in js能做到的 css preprocessor全部都做得到，沒有理由寫成 javascript；但我個人的觀點是，工程師普遍對於 scss/less這樣的工具很少能玩得神乎其技的，直接寫成 js反而更友善一些。</p></li><li><p>基於以上第2點及3點的理由，如果是以專案型式或者後台系統來說我覺得選擇 react會是個錯誤的選擇… vue或 angular會更加合適（另外，vue對於無腦暴力開發模式有種說不出的好用，也適合junior或全端工程師快速上手開發）。</p></li><li><p>前面我吐槽 react的點，如果是放在產品類型的系統上，其實多增加的成本其實也不太算真正的成本，以一個要長期維護/產品迭代的系統來說真正顯注的成本可能是在維護/測試/重構等等的… 另外，由於 react的 functional programing特性下，react更傾向把所有的東西視為 function，所以react幾乎都是在寫 js而用到較少量的 api，也就比 vue更有機會寫出符合自己需求的特殊功能或架構；而反過來說 vue更傾向把不同的功能提供不同的 Vue instance的 api，雖然開發前期簡單好用，但在製作一些進階功能的時候也必須花費更多時間在了解 vue的 api的一些原理和特性（不見得是能直接透過文件了解，有點吃開發經驗）</p></li><li><p>關於前一點所提到的 react的優點，其實一個好的 vue專案實踐我覺得也可以做到同樣的水準。但我覺得更多的是因為 react天生的「彈性」、以及早期開發者大神多，所以會有很多非常有開創性又很潮的新 idea，而 vue就得等到一兩年之後才會「致敬」（也不能說抄啦 XD）過去做出類似的功能，像是最近 react18的 streaming HTML不知道什麼時候 vue才會有… 但反過來說，react常常會有主流的寫法變來變去（以前流行 higher order component，現在寫 hooks）、主流的套件也常異主（以前用 redux，最近 facebook出的 recoil似乎也蠻強的），而 vue官方提供的解決方案就非常好用了，所以也不太會有其他潮流上的變動，比較不會有選擇障礙、或者擔心會不會現在選用的作法等到明年就退流行了…</p></li></ol>]]></content:encoded>
            <category>vue</category>
            <category>react</category>
        </item>
        <item>
            <title><![CDATA[瀑布或敏捷開發的選擇？三眼怪Podcast筆記]]></title>
            <link>https://upstairs0102.github.io/blog/2021/12/14/scrum-and-waterfall</link>
            <guid>2021/12/14/scrum-and-waterfall</guid>
            <pubDate>Tue, 14 Dec 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[最近聽了「產品三眼怪」的一集 Podcast： 【Podcast EP03】敏捷或瀑布開發哪個好？流程用哪種重要嗎？，覺得還不錯，我雖然是工程師但對於這樣的題目也是會想了解，就邊聽的時候隨手寫了一些筆記：]]></description>
            <content:encoded><![CDATA[<p>最近聽了「產品三眼怪」的一集 Podcast： <a href="https://medium.com/3pm-lab/pm-podcast-ep03-waterfall-vs-agile-82b214853112" target="_blank" rel="noopener noreferrer">【Podcast EP03】敏捷或瀑布開發哪個好？流程用哪種重要嗎？</a>，覺得還不錯，我雖然是工程師但對於這樣的題目也是會想了解，就邊聽的時候隨手寫了一些筆記：</p><ul><li><p>敏捷也不一定是全部都敏捷，在之前也還是可能會有一個瀑布，會是混合的</p></li><li><p>敏捷和瀑布對看待資源的角度會不太一樣，敏捷比較會是在已經固定好資源的情況下，依照進度調整「內容」，而瀑布比較是依照進度調整「資源」</p></li><li><p>某些情況瀑布看起來風險比較小，比如說需求明確的產品、功能需要一起上（新功能上線）、或者時程比較固定的情形下</p></li><li><p>當功能會有一些外部的互相依性（比如說更需要用戶的回饋、或要做某個實驗之後會改變方向，決策上會有一些叉路）的時候，敏捷比較彈性</p></li><li><p>敏捷的本意是要搜集市場回饋、比如產品優化（需要A/B testing之類）</p></li><li><p>用哪一個方法風險會比較小來區分要選擇使用哪一個方法</p></li><li><p>選擇RD或成員喜歡的方式更為重要</p></li><li><p>當PM更有經驗、資深了以後，因為手上有的工具更多了，所以也不見得會需要拘泥於要一定要遵照某種工具的使用方法</p></li></ul>]]></content:encoded>
            <category>scrum</category>
        </item>
        <item>
            <title><![CDATA[「Docker這樣學才有趣」讀書筆記]]></title>
            <link>https://upstairs0102.github.io/blog/2021/09/23/docker-book-note</link>
            <guid>2021/09/23/docker-book-note</guid>
            <pubDate>Thu, 23 Sep 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>這是我讀了「Docker這樣學才有趣」這本書其中第1章~第5章的筆記，這幾章包含了 Docker基本知識與指令、Dockerfiler以及 Docker Compose指令等，已經足以建置一般的 Docker Container以及自動化管理。不過docker-compose.yml文件指令的部份實在是太多了… 一時間筆記做不完，所以尚未寫好…</p><p>後面的章節內容還有架設 Docker Registry，以及多個範例實作（也就是標題上說有趣的部份），就被我跳過了…</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch1-docker的能與不能">CH1 Docker的能與不能<a class="hash-link" href="#ch1-docker的能與不能" title="Direct link to heading">​</a></h2><p>Container（容器）的完整名稱應該是「Linux Containers」，指的是一組利用 Linux核心提供的技術來達到把程式或軟體「包裏」在一個可隔離且獨立運行的環境工具。</p><p>Docker就是用來管理這些 Containers的工具</p><p>Docker是一個完全免費（採用 Apache 2.0授權）的開發原始碼專案</p><p><a href="https://github.com/moby/moby" target="_blank" rel="noopener noreferrer">https://github.com/moby/moby</a></p><p>↑ moby是容器框架，原本 github上的 docker專案已改名為 moby，而 Docker是使用 moby架構實作出來的產品</p><p><a href="https://kknews.cc/zh-tw/tech/gv63368.html" target="_blank" rel="noopener noreferrer">https://kknews.cc/zh-tw/tech/gv63368.html</a></p><p>版本及差異：</p><ul><li><p>Docker EE（Docker Enterprise Edition，企業版）：付費版</p></li><li><p>Docker CE（Docker Community Edition，社群版）：免費版</p></li><li><p>Docker Desktop：由於 Docker是基於 Linux的 Container工具，所以 Linux以外的作業系統 - Mac和 Windows必須安裝 Docker Desktop。其原理是在透過 Linux虛擬機器來運行 Container的。目前 Docker Desktop僅提供250以下小型公司免費版本，大型公司必須使用付費方案。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch2-必學的-docker功能與指令">CH2 必學的 Docker功能與指令<a class="hash-link" href="#ch2-必學的-docker功能與指令" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="下載及啟用-image映象檔">下載及啟用 Image（映象檔）<a class="hash-link" href="#下載及啟用-image映象檔" title="Direct link to heading">​</a></h3><p>映像檔相關名詞：</p><ul><li>Docker Image：透過 Docker把要使用的軟體打包起來，打包的檔案稱為 Docker Image</li><li>Docker Registry：用來存放 Docker Image供 Docker下載使用，可以是公開的也可以是內部私用的</li><li>Docker Hub：Docker 官方提供的 Docker Registry</li></ul><p>常用指令：</p><p><code>docker search &lt;Docker Image&gt;</code> 搜尋 Docker Image</p><p><code>docker pull &lt;Docker Image&gt;</code> 下載 Docker Image</p><p><code>docker images</code> 查看已下載過的 Docker Image</p><p>啟動指令：</p><p><code>docker run -p &lt;對外port&gt;:&lt;預設port&gt; -d</code></p><p>例</p><p><code>docker run -p 8080:80 -d nginx</code></p><p>用 nginx的 docker image以 <code>Detach</code>的方式在主機 8080 port上提供服務</p><p><strong>有 <code>-d</code>指令執行後會回傳 Container ID，會將程式執行在「背景」，如果沒有加 <code>-d</code>會將程式執行在「前景」</strong></p><p><strong>* 解決 Container啟動後就結束的問題：</strong></p><p>Container被啟動後，會和一般的程式一樣，在作業系統中被視為一支執行中的程序 (Process)，所以這個 Container就會像跑一支程式一樣跑完之後就會被結束掉。如果要順利可以使用的話，就需要在 Container裡啟用一個伺服器的程式（持續執行中的程式）讓 Container保持運行</p><p><code>docker rmi &lt;Image名稱或 ID&gt;</code> 刪除 Docker Image</p><p>Docker Image是一層一層疊出來的，不同的 Docker Image可能有共用到同一層的部份，所以移除掉某個 Docker Image後所拿回來的硬碟空間不一定會和看到或所想的一樣</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看啟動過的-container">查看啟動過的 Container<a class="hash-link" href="#查看啟動過的-container" title="Direct link to heading">​</a></h3><p><code>docker ps</code>指令查看狀態</p><p>例：</p><p><code>docker run -p 8080:80 -d nginx</code></p><p><code>docker run -p 8080:80 nginx</code></p><p>分別啟動一個前景執行和一個背景執行的 nginx，前景執行的 nginx會在 terminal中顯示 nginx的訊息。這時候另開 terminal使用 <code>docker ps</code>指令會看到兩個已啟動的 Container資訊</p><p>按下 <code>Ctrl + C</code>會把前景執行的 nginx給中斷，這時候使用 <code>docker ps</code>指令查看會只看到一個已啟動的 Container資訊</p><p><code>docker ps -a</code>中的 <code>-a</code>選項會把所有已經啟動過的 Container都列出來（不論是不是在運行）。所以以上面的例子即會看兩筆 Container資訊，其中一個是正在運行另一個是中斷運行（看 <code>status</code>欄位）</p><p><code>docker ps -l</code>中的 <code>-l</code>選項會顯示最後一組建立的 Container資訊</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="停用和啟用-container">停用和啟用 Container<a class="hash-link" href="#停用和啟用-container" title="Direct link to heading">​</a></h3><p><code>docker start &lt;Container ID&gt;</code></p><p><code>docker stop &lt;Container ID&gt;</code></p><p><code>docker restart &lt;Container ID&gt;</code> restart會先停止再啟動</p><p> <code>docker rm</code>移除 Container。如果確定狀態是 <code>Exited</code>的 Container已經沒有再使用的話，要使用 <code>docker rm</code>指令來移除（如 Container不是在停止狀態下移除會出現錯誤訊息）</p><p>Container不會在被停用之後就移除掉，所以使用 <code>docker run</code>來新增 Container幾次後，用 <code>docker ps -a</code>指令就可以看到有許多已經沒有在運行的 Container。</p><p><code>docker ps -s</code>查詢 Container佔用多少硬碟空間</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="詳細-container資訊">詳細 Container資訊<a class="hash-link" href="#詳細-container資訊" title="Direct link to heading">​</a></h3><p><code>docker inspect &lt;Container ID&gt;</code> 詳細配置資訊</p><p>可以進設定輸出格式及範圍，例 <code>docker inspect --format='{{json .State.Status}}' node-red-couchdb</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一次作多個-container">一次作多個 Container<a class="hash-link" href="#一次作多個-container" title="Direct link to heading">​</a></h3><p>只要是可以用 Container ID進行操作的指令，都可以一次輸入多個 Container，包含 <code>docker start</code>, <code>docker stop</code>, <code>docker rm</code>…等</p><p>例 <code>docker start &lt;Container ID&gt; &lt;Container ID&gt; &lt;Container ID&gt;</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="搬移檔案">搬移檔案<a class="hash-link" href="#搬移檔案" title="Direct link to heading">​</a></h3><p>把檔案複製到 Container裡</p><p><code>docker cp &lt;檔案來源路徑&gt; &lt;目的Container ID&gt;:&lt;目的路徑&gt;</code></p><p>把檔案從 Container複製出來</p><p><code>docker cp &lt;來源Container ID&gt;:&lt;檔案來源路徑&gt; &lt;目的路徑&gt;</code></p><p>無論是運行中或停止中的 Container都可以進行操作</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看-container使用資源cpu記憶體">查看 Container使用資源（CPU、記憶體）<a class="hash-link" href="#查看-container使用資源cpu記憶體" title="Direct link to heading">​</a></h3><p><code>docker stats</code> 查看全部 Container</p><p><code>docker stats &lt;Container ID&gt;</code> 查看指定 Container</p><p>會以「即時」的方式呈現目前狀況資訊</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看-container的即時-log">查看 Container的即時 Log<a class="hash-link" href="#查看-container的即時-log" title="Direct link to heading">​</a></h3><p>當 Container是以 Detach模式（背景）執行時，沒有辦法在命令列上直接看到 Log資訊，這時就需要使用 <code>docker logs</code>指令才能看到 Log資訊</p><p><code>docker logs &lt;Container ID&gt;</code> 可以看到指定的 Container Log資訊</p><p>選項 <code>--tail</code>可以只顯示數幾行的資訊，例：</p><p><code>docker logs &lt;Container ID&gt; --tail 2 76d1</code> </p><p>選項 <code>--since</code>可以只顯示倒數分鐘以前的資訊，例：</p><p><code>docker logs &lt;Container ID&gt; --since 2m 76d1</code> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch3-docker-container的進階操作">CH3 Docker Container的進階操作<a class="hash-link" href="#ch3-docker-container的進階操作" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="container-命名">Container 命名<a class="hash-link" href="#container-命名" title="Direct link to heading">​</a></h3><p><code>--name</code> 用來指定 Container名稱（沒有指定名稱時 Docker會自動隨機取名）</p><p>搭配 docker run  <code>docker run --name &lt;Container名稱&gt;</code></p><p>例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name nginx-hello -p 8080:80 -d nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker start nginx-hello</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因為 Container的名稱必須是唯一的，因此每次用 docker run 指令啟動 Container都必須指定不同的名稱</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="環境變數">環境變數<a class="hash-link" href="#環境變數" title="Direct link to heading">​</a></h3><p><code>-e</code> 用來設定變數值</p><p>例 <code>dockr run -e &lt;變數名稱&gt;=&lt;變數值&gt; -p &lt;對外port&gt;:&lt;預設port&gt; -d &lt;Docker Image名稱&gt;</code></p><p>mysql範例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$docker run --name mysql -e MYSQL_ROOT_PASSWORD=123456789 -d mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$docker exec -it mysql mysql -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">略</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-run-與-docker-create">docker run 與 docker create<a class="hash-link" href="#docker-run-與-docker-create" title="Direct link to heading">​</a></h3><p><code>docker create</code>需搭配 <code>docker start</code>指令才會啟動</p><p><code>docker run</code>執行之後就會立即的運行</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-kill-與-docker-stop">docker kill 與 docker stop<a class="hash-link" href="#docker-kill-與-docker-stop" title="Direct link to heading">​</a></h3><p><code>docker stop</code>：讓 Docker進入標準的關機程序；所有的程式會進入到各自的關機處理程序，等所有程式完成關機程序之後 Docker也進入自己的關機程序</p><p><code>docker kill</code>：強迫進行 Docker的關機動作</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="執行-container內的程式或指令">執行 Container內的程式或指令<a class="hash-link" href="#執行-container內的程式或指令" title="Direct link to heading">​</a></h3><p>適用情況：有一種 Container的用途是被拿來當作軟體的工具包</p><p>指令寫法：直接在 <code>docker run</code>的指令最後面加上想要執行的指令</p><p>例，把本機資料夾 C:\downloads檔案清單列出來</p><p><code>dockr run -v C:\downloads:/home ubuntu /bin/ls -l /home</code></p><p>（先使用 <code>-v</code>指令在本機外掛資料夾，並使用 ls工具用 <code>-l</code>指令檢視）</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="自動移除自動重新啟動">自動移除、自動重新啟動<a class="hash-link" href="#自動移除自動重新啟動" title="Direct link to heading">​</a></h3><p><code>--rm</code>：Container停止後就會自動移除</p><p>例 <code>docker run --rm -v C:\downloads:/home ubuntu /bin/ls -l /home</code></p><p><code>--restart</code>：讓 Container在不預期情況被停止時，依照 <code>--restart</code>的設定方式決定要不要自動重新啟動 Container（預設是 <code>no</code>）</p><p>設定值：</p><ul><li><code>no</code></li><li><code>always</code></li><li><code>unless-stopped</code>：和 <code>always</code>一樣有服務中斷自動重啟的功能，但是重開機後就不重啟</li><li><code>on-failure</code>：只在 Container的退出狀態代碼 (Exit Code)不是零 (Non-Zero)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="進入-container操作命令列">進入 Container操作命令列<a class="hash-link" href="#進入-container操作命令列" title="Direct link to heading">​</a></h3><p>想要透過指令來操作 Container的話，只要能啟動 Container裡的 Shell程式就可以了，一般 Linux作業系統常用的 Shell程式是 bash這一支程式</p><p>錯誤指令：</p><p><code>docker run --rm --name nginx-cmd nginx /bin/bash</code></p><p>要使用 <code>-it</code>（<code>-i</code>和<code>-t</code>的合併寫法）指令來進入能夠輸入指令（及能把執行結果送出來）的狀態</p><p>正確指令：</p><p><code>docker run -it --rm --name nginx-cmd nginx /bin/bash</code></p><p><code>docker exec</code>：可以對已經在運行中的 Container要求執行指令</p><p>範例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name nginx-cmd -d nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it nginx-cmd /bin/bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="container綁定-ip">Container綁定 IP<a class="hash-link" href="#container綁定-ip" title="Direct link to heading">​</a></h3><p><code>-p</code>指定 Container所要綁定的 IP位址</p><p>Docker預設會把 Container綁定到主機的 0.0.0.0</p><p>對外服務的建議指令：</p><p><code>docker run -p &lt;主機IP&gt;:&lt;主機port&gt;:&lt;Container port&gt; -d &lt;Docker Image&gt;</code></p><p>例</p><p><code>docker run -p 192.168.1.1:80:80 -d nginx</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-network">docker network<a class="hash-link" href="#docker-network" title="Direct link to heading">​</a></h3><p>傳統上會把伺服器和資料庫裝在同一個虛擬機器裡，在 Container上建議的做法是用 <code>docker network</code>建立一個 Docker網路，再把這兩套軟體分別啟動各自獨立的 Container到同一個 Docker網路之中</p><p>例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker network create &lt;網路名稱&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name --net=&lt;網路名稱&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除了使用<code>--net</code>方式來連接多個 Container，也可以利用 Docker Compose工具來達到</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-volume---docker-run直接指定本機路徑">Data Volume - docker run直接指定本機路徑<a class="hash-link" href="#data-volume---docker-run直接指定本機路徑" title="Direct link to heading">​</a></h3><p>Container運行產生的資料是會隨著 Container的消滅而消失，並且 Docker Container是採用一種層疊的方式來新增資料，所以每次有新增資料時就會產生一層新資料層疊加上去，而頻繁的寫入資料會產生大量的資料層而快速的吃掉硬碟空間。</p><p><code>-v</code>：掛上外部的硬碟空間</p><p>指令如下：</p><p><code>docker run -v &lt;外部資料夾或檔案路徑&gt;:&lt;Container內部資料夾或檔案路徑&gt; -p &lt;對外port&gt;:&lt;預設port&gt; -d &lt;Docker Image&gt;</code></p><p>例 - 資料夾</p><p><code>docker run -v /var/www:/usr/share/nginx/html --name nginx-store -p 8080:80 -d nginx</code></p><p>例 - 設定檔</p><p><code>docker run -v /home/ayubiz/nginx.conf:/etc/nginx/nginx.conf -v /var/www:/usr/share/ginx/html --name nginx-store -p 8080:80 -d nginx</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-volume---data-volumn-create">Data Volume - data volumn create<a class="hash-link" href="#data-volume---data-volumn-create" title="Direct link to heading">​</a></h3><p>使用 <code>dota volumn create</code>建立 Data Volumn可以更方便的操作和管理 Data Volumn</p><p>例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$docker volumn create nginx-html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$docker volumn ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$docker run -v nginx-html:/usr/share/nginx/html --name nginx-vol -p 8080:80 -d nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果要讓另一個 Container也使用相同的 Data Volumn的話，只要使用相同的 Data Volumn名稱掛載即可</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$docker run -v nginx-html:/usr/share/nginx/html --name nginx-vol3 -p 8081:80 -d nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不過多個 Container共用同一個 Data Volumn時要注意避免共同更新同一個檔案，以免造成資料的混亂或錯誤。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch4-各種自製-docker-image的方法">CH4 各種自製 Docker Image的方法<a class="hash-link" href="#ch4-各種自製-docker-image的方法" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="從運行中的-container產生映像檔">從運行中的 Container產生映像檔<a class="hash-link" href="#從運行中的-container產生映像檔" title="Direct link to heading">​</a></h3><p><code>docker commit &lt;Container ID&gt; &lt;產出的 Docker Image名稱&gt;</code></p><p>例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name nginx-hello -p 8080:80 -d nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker cp index.html nginx-hello:/usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker commit nginx-hello nginx-commit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在此例中即使先執行了 <code>docker stop</code>中止後仍然是可以執行 <code>docker commit</code>指令的，不過掛載在 Container上的儲空間是不會被存進到新產生的 Image</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dockerfile的-build指令">Dockerfile的 Build指令<a class="hash-link" href="#dockerfile的-build指令" title="Direct link to heading">​</a></h3><p>Dockerfile可以把他看成是一個腳本檔來看，他被用來明確的告訴 docker build指令在產生新 Image的時候所需要用到的資訊和步驟</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="from">FROM<a class="hash-link" href="#from" title="Direct link to heading">​</a></h4><p>指定要下載的 Image檔名稱</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:14-alpine</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="env">ENV<a class="hash-link" href="#env" title="Direct link to heading">​</a></h4><p>設定環境變數</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ENV NODE_ENV=$deploy_env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="run">RUN<a class="hash-link" href="#run" title="Direct link to heading">​</a></h4><p>執行指令</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="expose">EXPOSE<a class="hash-link" href="#expose" title="Direct link to heading">​</a></h4><p>指定 Container啟用的 port</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 80 443</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cmd">CMD<a class="hash-link" href="#cmd" title="Direct link to heading">​</a></h4><p>Container啟動完成後要執行的指令。當同一個 Dockerfile裡有多個 <code>CMD</code>指令時，只有最後一個 <code>CMD</code>指令會有作用</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CMD ["nginx", "-g", "damon off;"]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="entrypoint">ENTRYPOINT<a class="hash-link" href="#entrypoint" title="Direct link to heading">​</a></h4><p>Container啟動完成後要執行的指令，功能和 <code>CMD</code>類似，差異在於其不能在 <code>docker run</code>後面加入的指令來蓋掉 <code>ENTRYPOINT	</code>指令所要求的啟動方式。也就是說他一定會被執行，且可以在 <code>docker run</code>後攜帶參數使用。</p><p>當同一個 Dockerfile裡有多個 <code>ENTRYPOINT</code>指令時，只有最後一個 <code>ENTRYPOINT</code>指令會有作用。他可以和 <code>CMD</code>搭配使用</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workdir">WORKDIR<a class="hash-link" href="#workdir" title="Direct link to heading">​</a></h4><p>指定執行指令的資料夾位置</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="copy">COPY<a class="hash-link" href="#copy" title="Direct link to heading">​</a></h4><p>複製檔案到 Container當中。指令：<code>COPY &lt;來源檔路徑和檔名&gt; &lt;Container裡的完整路徑和檔名&gt;</code></p><p>另外還有一個指令 <code>ADD</code>與 <code>COPY</code>相似，不過 <code>ADD</code>是將檔案放到 Image裡，主要的差異是在 <code>ADD</code>多了可以用網址指定來源檔和可以自動解開 tar壓縮檔的功能；官方比較建議使用 <code>COPY</code>指令。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="label">LABEL<a class="hash-link" href="#label" title="Direct link to heading">​</a></h4><p>將 Image檔的作者、版本、描述及其他自訂資料儲存到新產生的 Image檔，而存入的資訊可透過 <code>docker image inspect</code>指令查看 <code>Labels</code>欄位</p><p>指令：<code>LABEL &lt;欄位名稱&gt;:"&lt;欄位值&gt;" &lt;欄位名稱&gt;:"&lt;欄位值&gt;" &lt;欄位名稱&gt;:"&lt;欄位值&gt;" ...</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="user">USER<a class="hash-link" href="#user" title="Direct link to heading">​</a></h4><p>大部份的 Image檔都會使用最高權限的 root做為預設的使用者帳號，如果不想用 root作預設的使用者的話，可以用 <code>USER</code>指令指定帳號</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="volume">VOLUME<a class="hash-link" href="#volume" title="Direct link to heading">​</a></h4><p>提供 Data Volume的掛載</p><p>指令 <code>VOLUME ["&lt;掛載點的資料夾路徑&gt;", "&lt;掛載點的資料夾路徑&gt;" ...]</code> 或 <code>VOLUME &lt;掛載點的資料夾路徑&gt; &lt;掛載點的資料夾路徑&gt; ...</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="arg">ARG<a class="hash-link" href="#arg" title="Direct link to heading">​</a></h4><p>可以讓 <code>docker build</code>指令利用 <code>--build-arg</code>選項傳入參數到 Dockerfile裡</p><p>指令 <code>ARG &lt;參數名稱&gt;</code> 或  <code>ARG &lt;參數名稱&gt;=&lt;預設值&gt;</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="匯入匯出-image檔">匯入/匯出 Image檔<a class="hash-link" href="#匯入匯出-image檔" title="Direct link to heading">​</a></h3><p>匯出指令： <code>docker save -o &lt;匯出的檔案名稱.tar&gt; &lt;要匯出的 Image名稱&gt;:&lt;版本&gt;</code></p><p><code>docker save</code>匯出的檔案格式為 tar壓縮檔，名稱可加上 <code>.tar</code>也可不加</p><p>匯入指令：<code>docker load -i &lt;之前匯出的Image.tar&gt;</code> 或<code>docker load &lt; &lt;之前匯出的Image.tar&gt;</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="用-container匯出-image">用 Container匯出 Image<a class="hash-link" href="#用-container匯出-image" title="Direct link to heading">​</a></h3><p>這種方式不是將運行中的 Container整個匯出，只是將 Container內部使用中的檔案系統匯出</p><p>匯出指令 <code>docker export -o &lt;匯出的檔案名稱.tar&gt; &lt;Container ID&gt;</code>或 <code>docker export &lt;Container ID&gt; &gt; &lt;匯出的檔案名稱.tar&gt;</code></p><p>匯入指令 <code>docker import &lt;匯入的檔案名稱與路徑&gt; &lt;映像檔名稱:版本標籤&gt;</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ch5-利用-docker-compose管理多個-container">CH5 利用 Docker Compose管理多個 Container<a class="hash-link" href="#ch5-利用-docker-compose管理多個-container" title="Direct link to heading">​</a></h2><p>Docker和 Docker Compose是兩個各自獨立的程式，Docker Compose需要額外安裝</p><p>主要功能和使用情境：</p><ul><li>管理多個 Container</li><li>自動化（透過將 docker run的設定放進 docker-compose.yml的方式達到更彈性與自動化的部署）</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-composeyml文件指令">docker-compose.yml文件指令<a class="hash-link" href="#docker-composeyml文件指令" title="Direct link to heading">​</a></h3><p>（指令太多了一時間筆記不完，沒實際操作也吸收不了，所以就先跳過）</p><p>頂層指令：</p><p>version</p><p>services</p><p>volumes</p><p>networks</p><p>configs</p><p>scerets</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="常用指令">常用指令<a class="hash-link" href="#常用指令" title="Direct link to heading">​</a></h3><p><code>docker-compose</code>的指令幾乎是和 <code>docker</code>的指令相同，不過 <code>docker-compose</code>指令的操作都是基於 <code>docker-compose.yml</code>的內容，所以也就可以更容易的進行批次操作。另外，<code>docker-compose</code>指令多是以  <code>docker-compose.yml</code>檔案裡的 service名稱來做為參數使用，不直接給 Container的名稱</p><p><code>-f</code> 選項指定 docker-compose.yml檔案路徑和名稱，例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f ~/node-red/docker-compose.yml config -q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>docker-compose config</code>：檢視檔案內容</p><p><code>docker-compose build</code>：使用 Dockerfile產生 Docker Image</p><p><code>docker-compose pull &lt;Image&gt;</code> 或 <code>docker-compose pull</code>：指定取得一個或多個 Image（ 如未指定則下載所有 docker-compose.yml檔所有指定的 Image檔），例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose pull node-red db</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>start</code>, <code>stop</code>, <code>restart</code>, <code>pause</code>, <code>unpause</code>, <code>kill</code>：對指定或者全部 Container進行操作</p><p>例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 停止指定 Container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose stop node-red db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 停止全部 Container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose stop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>docker-compose rm</code>：和 <code>docker rm</code>指令相同，可以用來移除已經停止運行的 Container</p><p><code>docker-compose run</code>：和 <code>docker run</code>指令相同，可以用來啟動 Container</p><p><code>docker-compose up</code>：最常使用的指令，用來啟動所有的服務</p><p><code>docker-compose up</code>的常用選項：</p><ul><li><code>-d</code>： 在背景模式下執行</li><li><code>--no-recreate</code>： 不需要重建每個服務所使用的 Container</li><li><code>--force-recreate</code>：無論 docker-compose.yml或 Image檔案有無調整或改變，都強迫執行重新建立服務所使用的 Container的動作</li></ul>]]></content:encoded>
            <category>docker</category>
            <category>gitlab-ci</category>
        </item>
        <item>
            <title><![CDATA[Vue Recursive Component]]></title>
            <link>https://upstairs0102.github.io/blog/2021/06/24/vue-recursive-component</link>
            <guid>2021/06/24/vue-recursive-component</guid>
            <pubDate>Thu, 24 Jun 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[當 Component遞迴呼叫自己時 - 也就是使用 slot並將同樣的 Component放進去的時候，如果沒有針對這種情形調整寫法就會報錯：]]></description>
            <content:encoded><![CDATA[<p>當 Component遞迴呼叫自己時 - 也就是使用 <code>slot</code>並將同樣的 Component放進去的時候，如果沒有針對這種情形調整寫法就會報錯：</p><p><code>did you register the component correctly? For recursive components, make sure to provide the “name” option</code></p><p>這樣寫法稱之為 Recursive Component，在我研究之後分為以下兩種形態：</p><ol><li>父子Component是同樣的Component</li><li>某Component的父子Component相同</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="case1-父子component是同樣的component">Case1 父子Component是同樣的Component<a class="hash-link" href="#case1-父子component是同樣的component" title="Direct link to heading">​</a></h2><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">App</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">MyComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">MyComponent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>父層的<code>MyComponent</code>需要有<code>name</code>欄位，<code>name</code>的 value和 Component名稱一樣即可，不需要再額外 import Component進來。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="case2-某component的父子component相同">Case2 某Component的父子Component相同<a class="hash-link" href="#case2-某component的父子component相同" title="Direct link to heading">​</a></h2><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">App</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">MyComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">ADifferentComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token maybe-class-name">MyComponent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>參考這篇文章</p><p><a href="https://stackoverflow.com/questions/49154490/did-you-register-the-component-correctly-for-recursive-components-make-sure-to" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/49154490/did-you-register-the-component-correctly-for-recursive-components-make-sure-to</a></p><p>有三個方法</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1globally-register-mycomponent">1.Globally register <code>MyComponent</code><a class="hash-link" href="#1globally-register-mycomponent" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vue.component("MyComponent", MyComponent)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2using-beforecreate">2.Using <code>beforeCreate</code><a class="hash-link" href="#2using-beforecreate" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">beforeCreate: function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  this.$options.components.MyComponent = require('./MyComponent.vue').default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3move-the-import-into-a-lambda-function-within-the-components-object">3.Move the <code>import</code> into a lambda function within the <code>components</code> object<a class="hash-link" href="#3move-the-import-into-a-lambda-function-within-the-components-object" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">components: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MyComponent: () =&gt; import('./MyComponent.vue')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中(3)我測試過會有速度變慢的效能問題（當Component數量特別多且複雜的情況），(2)沒有試過所以不確定，不過理論上他也是 run-time動態載入的寫法，猜測應該會有一樣的問題</p><p>後來我研究還有第四種方法：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4dynamic-component">4.Dynamic Component<a class="hash-link" href="#4dynamic-component" title="Direct link to heading">​</a></h3><p>用<code>:is</code> (v2.x) / <code>v-is</code> (v3.x) 方法來動態載入 Component，並且避開使用 option - <code>components</code>來註冊 component。由於 import的寫法是在 build-time中引入程式，所以相較 (2) (3)的 dynamic import的寫法來說不會有效能問題。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">template</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">div </span><span class="token operator" style="color:#393A34">:</span><span class="token plain">is</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"component"</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">div</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">template</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">script</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">MyComponent</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./MyComponent.vue'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">data</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">MyComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">script</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>vue</category>
        </item>
        <item>
            <title><![CDATA[Vue2 的 Vuex使用 Typescript寫法]]></title>
            <link>https://upstairs0102.github.io/blog/2021/06/24/vuex-with-typescript-in-vue2</link>
            <guid>2021/06/24/vuex-with-typescript-in-vue2</guid>
            <pubDate>Thu, 24 Jun 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>Vuex v4.0版本以上大幅改善了對 Typescript的支援、以及對 composition-api的整合，但是 <a href="https://github.com/vuejs/vuex/blob/4.0/package.json#L55" target="_blank" rel="noopener noreferrer">Vuex v4.x版只支援 Vue3以上版本</a>。</p><p>也就是說如果開發環境是 Vue v2.x版本的話，Vuex也就只能使用 v3.x版本。雖然說 Vuex v3.x版對於 Typescript的支援上也些限制和不順手，但只要做好註記 (annotation)的工作，基本上我覺得型別推導上還算蠻完整的，唯獨 Component中要引入 Vuex的時候就會有些限制，只有 <code>state</code>可以型別推導，其餘 <code>mutation</code>/<code>action</code>等都會是 <code>any</code>型別。不過對我個人來說有 <code>state</code>型別推導就已經是相當實用，其他的就還是我可以忍受的範圍了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vuex-使用-typescript寫法">Vuex 使用 Typescript寫法<a class="hash-link" href="#vuex-使用-typescript寫法" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="state">State<a class="hash-link" href="#state" title="Direct link to heading">​</a></h3><p>要將整個 <code>state</code>註記成一個 Type或 Interface。如果 Vuex有使用 module功能，則每個子模組的 <code>state</code>各自維護自己的 Interface/Type。</p><p>如下例子是名稱為 <code>cart</code>的模組的 <code>state</code>：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// @/store/modules/cart/state.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> type </span><span class="token maybe-class-name">CartState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">added</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">quantity</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">checkoutStatus</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'successful'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'failed'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">CartState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">added</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">checkoutStatus</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> state</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 Vuex的 <code>state</code>是一個 tree結構，根節點的 <code>state</code>稱之為 <code>rootState</code>，而modules的 <code>state</code>會是<code>rootState</code>底下的一個子節點，所以在模組化Vuex的<code>rootState</code>在註記型別的時候需要把 modules的 <code>state</code>型別放入。</p><p>如下範例：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// @/store/index.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Vue</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vue'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Vuex</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vuex'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 子模組的 state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">cart</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">CartState</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./modules/cart/state'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 最外層的 state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">appState</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">AppState</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./state'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Vuex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 根節點的 state-tree</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> type </span><span class="token maybe-class-name">RootState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">AppState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">cart</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">CartState</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Vuex</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Store</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">modules</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> appState </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="action">Action<a class="hash-link" href="#action" title="Direct link to heading">​</a></h3><p>vuex提供 <code>ActionContext&lt;State, RootState&gt;</code>提供給<code>context</code>做註記，泛型中有兩個參數分別是該模組的 <code>state</code>的型別以及 <code>rootState</code>的型別，如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">ActionContext</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vuex'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">State</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./state.ts'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">RootState</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'../state.ts'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> actions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">checkout</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">context</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">ActionContext</span><span class="token parameter operator" style="color:#393A34">&lt;</span><span class="token parameter maybe-class-name">State</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">RootState</span><span class="token parameter operator" style="color:#393A34">&gt;</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">products</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">CartProduct</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">commit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">CHECKOUT_REQUEST</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>解構的寫法</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Commit</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vuex'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">State</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./state.ts'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> actions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">checkout</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">commit</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Commit</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">state</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">State</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">products</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">CartProduct</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">commit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">CHECKOUT_REQUEST</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mutation">Mutation<a class="hash-link" href="#mutation" title="Direct link to heading">​</a></h3><p>註記 payload的型別以及在  state.ts中註記的 state型別</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">AddToCartPayload</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'../index.ts'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">State</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./state.ts'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> mutations </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">addToCart</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">state</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">State</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">payload</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">AddToCartPayload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> product </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">all</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">p</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getters">Getters<a class="hash-link" href="#getters" title="Direct link to heading">​</a></h3><p>各別的 getters函式可使用 <code>Getter&lt;State, RootState&gt;</code>， getters模組物件需使用<code>GetterTree&lt;State, RootState&gt;</code></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ./src/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">GetterTree</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Getter</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vuex'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">State</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./index'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">RootState</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/store/index'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">cartProducts</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Getter</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">state</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cart</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">added</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">shape</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">getterTree</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">GetterTree</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cartProducts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> getterTree</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>簡潔寫法：直接使用 getterTree把所有 getter函式寫在一起，就不用各別註記 getter函式的型別，這樣會更方便一些</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ./src/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">GetterTree</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vuex'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">State</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./index'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">getterTree</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">GetterTree</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">cartProducts</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// state的型別 typescript會自行推斷出來</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cart</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">added</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">shape</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> getterTree</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="component中使用-vuex">Component中使用 Vuex<a class="hash-link" href="#component中使用-vuex" title="Direct link to heading">​</a></h2><p>首先，關於在 Vue2中 Component寫 Typescript雖然不是本文重點，不過既然提到了還是稍微說一下，這裡是極度強烈建議安裝 <a href="https://github.com/vuejs/composition-api" target="_blank" rel="noopener noreferrer">composition-api</a>，關於使用方式可參考我之前寫的「<a href="https://upstairs0102.github.io/2021/02/09/vue-option-based-component-with-typescript/" target="_blank" rel="noopener noreferrer">Vue2的 Option-Based Component中使用Typescript的簡易方式</a>」。你可以不需改變原本的 Option-Api寫法，就可以完完全全的解決原本在 Vue2中 Typescript中支援不良的問題；當然後既然都安裝 composition-api了，也可以直接使用新的 composition-api來開發。</p><p>以下針對幾種常用的引入 Vuex方式來做說明：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1mapstatemapgettersmapactionsmapmutations">1.mapState/mapGetters/mapActions/mapMutations<a class="hash-link" href="#1mapstatemapgettersmapactionsmapmutations" title="Direct link to heading">​</a></h3><p>這個寫法是 Option-Api的寫法。很顯然他推導出來都會是 <code>any</code>型別，所以這種寫法可以直接放棄了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2thisstore">2.this.$store<a class="hash-link" href="#2thisstore" title="Direct link to heading">​</a></h3><p>這個寫法是 Option-Api的寫法。完成文章上述所有的型別註記之後，他雖然推導的出一些基本的 Vuex型別，但推導不出 <code>state</code>的型別，在編輯器中滑鼠移過 <code>this.$store</code>上會發現，他推導出的型別是 <code>Store&lt;any&gt;</code>。看來這個可能還需要額外的一些工作才能把型別宣告到全域的 <code>$store</code>物件上。不過我覺得有點麻煩，就放棄嘗試了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3import-store">3.import store<a class="hash-link" href="#3import-store" title="Direct link to heading">​</a></h3><p>這個是我覺得最合理的使用方式，雖然他也只推導的出 <code>state</code>，但我覺得這已經是一個很大的幫助了，寫法如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">store</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/store/index'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 可推斷出型別</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'checkout'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// function參數無法推斷型別</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>總結來說，使用 import store來引入 Vuex是最合理也簡單的方式，至於 <code>actions</code>和 <code>mutations</code>無法推導出型別這個問題，如果要解決的話應該可以嘗試寫 helper function來解決，不過這樣對我來說實在有點太過囉唆，所以我是選擇忽略這個小問題了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="參考來源">參考來源<a class="hash-link" href="#參考來源" title="Direct link to heading">​</a></h2><p>Vue2.5+ Typescript 引入全面指南 - Vuex篇</p><p><a href="https://segmentfault.com/a/1190000011864013" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000011864013</a></p>]]></content:encoded>
            <category>typescript</category>
            <category>vue</category>
            <category>vuex</category>
        </item>
        <item>
            <title><![CDATA[Next.js上使用 Redux四兄弟]]></title>
            <link>https://upstairs0102.github.io/blog/2021/05/23/lib-of-redux-on-next</link>
            <guid>2021/05/23/lib-of-redux-on-next</guid>
            <pubDate>Sun, 23 May 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>身為使用 Vue.js的開發者，最近在研究 React.js以及 Next.js，原本以為有了使用 Vuex（和 Redux 一樣取自 Flux的概念發展出來狀態管理套件）的經驗，應該可以無痛轉移使用 Redux，但沒想到使用門檻竟然比預期的高上許多。</p><p>先是研究了 Redux，沒想到如果要打 Api還需要像是 <code>React-Thunk</code>之類的套件才能做非同步的操作。接著， Redux本身是一個獨立的狀態管理的套件，要怎麼跟 React溝通他也不管，所以還需要再安裝 <code>React-Redux</code>才能將 <code>store</code>和 Component做綁定。好不容易整理到一個段落了，實際開發 Next.js的時候還會有一個需求是要在 server-side從 <code>context</code>中取得 <code>store</code>又要再安裝 <code>Next-Redux-Wrapper</code>。前前後後含 Redux本身總共裝了四個套件，才終於達到我能開始開發 Next.js程式的最低需求。</p><p>就之前學習 Vuex的經驗，花比較多時間的地方也就只是觀念上的建立、以及實作上應用的技巧面；單就使用上，也就最一開始安裝進專案（其實也就是 cli工具架站時有選擇 Vuex而已）之後，弄懂 api文件幾乎就可以開始寫程式了。</p><p>但是學習 Redux就不太一樣了（也是學 React.js很多部份和學 Vue.js的學習經驗的差異），首先 Redux的寫法很有彈性，所以必須先清楚的理解其背後的觀念之後，融合文件上的說明搭配網路上不同人寫的文章，再整理出一個適合自己的寫法；接著是如同前面所說的，學習下一個套件再下一個套件，最後要把全部整合再一起又是另一回事，再全部整理出一個適合自己的寫法。</p><p>（兩天的生命又這樣沒了可以開始寫 code了~ QQ）</p><p>總之，反正我是順便做了筆記，雖然並不是很詳細完整，但是我把每一個我認為最基本且最小可行的程式碼紀錄下來，就按照我的步驟做，應該是可以很快建立基本的 Redux程式。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概念">概念<a class="hash-link" href="#概念" title="Direct link to heading">​</a></h2><p>Redux的資料流向無論同步還是非同步都只有一種（不像 Vuex的 View可以呼叫 <code>actions</code>(使用<code>dispatch</code>)及 <code>mutations</code>(使用<code>commit</code>)兩種）</p><p>資料流向：</p><p><code>View</code> -&gt; <code>Actions</code> -&gt; <code>Reducer</code> -&gt; <code>State</code> -&gt; <code>View</code></p><p>雖然說概念上只一種資料流，但實作上 <code>Action</code>還是分為「<strong>同步</strong>」和「<strong>非同步</strong>」兩種的做法。Redux原生 <code>dispatch</code>是直接呼叫 <code>reducer</code>，所以無法執行非同步的操作（ <code>reducer</code>中非同步操作是被禁止的），要額外搭配 Redux-Thunk才能使用非同步的操作</p><p><img loading="lazy" alt="image-20210520225845800" src="/assets/images/image-20210520225845800-0d83410abb132a07bc7d01ef4b4e1c36.png" width="844" height="624" class="img_ev3q"></p><p>（圖片取自官網）</p><p>實作上所必要的套件有以下四個：</p><p>Redux：狀態管理本身</p><p>Redux-Thunk：實作 middleware處理非同步行為（Redux本身是不允許處理非同步的）</p><p>React-Redux：將 Redux跟 Component綁定（提供<code>Provider</code>將  <code>state</code>及 <code>dispatch</code>傳入 Component）</p><p>Next-Redux-Wrapper：Next.js在 server-side或者 static-site的 build-time中取得 <code>store</code></p><p>不錯的文章，但文章的 <code>React-Redux</code>部份是舊版的寫法</p><p><a href="https://chentsulin.github.io/redux/index.html" target="_blank" rel="noopener noreferrer">https://chentsulin.github.io/redux/index.html</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="state--reducer">State &amp; Reducer<a class="hash-link" href="#state--reducer" title="Direct link to heading">​</a></h2><ul><li>State：<code>state</code> 是唯讀的，改變 <code>state</code>唯一的方式是發出一個 <code>action</code></li><li>Reducer：取得先前的<code>state</code>和一個 <code>action</code>，並回傳下一個 <code>state</code></li></ul><p>最簡易範例：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> initState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">otherState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'otherState'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">todoList</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'first'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// reducer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">reducer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> initState</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ADD_TODOLIST'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> todoList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">todoList</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      todoList</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">listName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 因為要更新所有的 state，所以必須先將原本的 state解構</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        todoList</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/* 或者 return的寫法也可這樣</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">      return Object.assign({}, state, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        todoList</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">      })</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">      */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中要注意的：</p><ol><li><p><code>reducer</code> 在更新 <code>state</code>的時候並不能只更新特定欄位，必須更新整個 <code>state tree</code>，所以要注意 return的寫法</p></li><li><p><code>reducer</code> 本身不能做非同步的操作，否則會噴錯誤訊息</p></li></ol><p>處理多個 <code>action</code>的範例：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">todoApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SET_VISIBILITY_FILTER</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD_TODO</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>拆分 <code>Reducers</code>：</p><p>Redux提供一個 utility叫做 <code>combineReducers()</code>，可以簡單的將多個 <code>reducer</code>合併</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> combineReducers </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'redux'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> todoApp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">combineReducers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  visibilityFilter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  todos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> todoApp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="action">Action<a class="hash-link" href="#action" title="Direct link to heading">​</a></h2><p><code>action</code> 是一個要傳遞資料給 <code>store</code>的 payload資訊（透過<code>store.dispatch()</code>），其定義事件要做的事情，格式可自行定義，一般來說會長這樣：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD_TODO</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ADD_TODO'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD_TODO</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Reducer的type名稱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  payload </span><span class="token comment" style="color:#999988;font-style:italic">// '要傳遞的資料'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>當 Views要跟 <code>store</code>溝通，最簡易的寫法就是 <code>store.dispatch(action)</code>，例如：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ADD_TODO'</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Reducer的type名稱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  payload </span><span class="token comment" style="color:#999988;font-style:italic">// '要傳遞的資料'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="action-creator">Action Creator<a class="hash-link" href="#action-creator" title="Direct link to heading">​</a></h2><p><code>action creator</code>和 <code>action</code>很容易被混為一談，<code>action creator</code> 是產生 <code>action</code>的 function</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD_TODO</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ADD_TODO'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">addTodo</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD_TODO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由 View發出 <code>dispatch</code>時的寫法：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">addTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="async-action-creator使用redux-thunk">Async Action Creator（使用Redux-Thunk）<a class="hash-link" href="#async-action-creator使用redux-thunk" title="Direct link to heading">​</a></h2><p>Redux原生是禁止非同步操作的，搭配 <code>Redux-Thunk</code> 套件我們可以用來製作 「<strong>非同步的 Action Creator</strong>」。當一個 <code>action creator</code>回傳的不是物件（也就是 <code>action</code>）而是一個 function時，該 function就會被  <code>Redux Thunk middleware</code>所執行。</p><p>關於這個 <code>async action creator</code>所以回傳的 function：</p><ul><li><p>執行完非同步的操作後調用 <code>distach</code> </p></li><li><p>不需要是 pure function，也可以做其他的操作，這讓我們也可以用來開發更複雜的非同步控制流程</p></li></ul><p>範例：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">fetchData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">dispatch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 不需要是 pure function，也可以做其他同步的操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ANOTHER_ACTION'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'http://www.website.com/api/todolist.post'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'POST'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">response</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">response</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ADD_TODOLIST'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Views中發出 <code>dispatch</code>的寫法：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">fetchPosts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'reactjs'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="store">store<a class="hash-link" href="#store" title="Direct link to heading">​</a></h2><p><code>createStore</code> 寫法範例</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">thunkMiddleware</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'redux-thunk'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">createLogger</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'redux-logger'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> createStore</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> applyMiddleware </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'redux'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">rootReducer</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./reducers'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> loggerMiddleware </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> store </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createStore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rootReducer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">applyMiddleware</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    thunkMiddleware</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// dispatch() function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loggerMiddleware </span><span class="token comment" style="color:#999988;font-style:italic">// log action</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>常用 Methods：</p><p><code>getState()</code></p><p><code>dispatch(action)</code></p><p><code>subscribe(listener)</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="react-redux">React-Redux<a class="hash-link" href="#react-redux" title="Direct link to heading">​</a></h2><p>React-Redux 是 react跟 redux溝通用的套件，舊版主要是以<code>connect</code> 函式將 <code>state</code>和 <code>reducer</code>注入Component，v7.1.0之後的版本提供 <code>Hooks</code>語法，使用方式比以前簡單很多</p><p>官網文件</p><p><a href="https://react-redux.js.org/api/hooks" target="_blank" rel="noopener noreferrer">https://react-redux.js.org/api/hooks</a></p><p>不錯的介紹</p><p><a href="https://medium.com/enjoy-life-enjoy-coding/react-redux-%E5%B0%8F%E5%AD%A9%E5%AD%90%E6%89%8D%E5%81%9A%E9%81%B8%E6%93%87-hooks-%E5%92%8C-redux-%E6%88%91%E5%85%A8%E9%83%BD%E8%A6%81-1fdd226f5d99" target="_blank" rel="noopener noreferrer">https://medium.com/enjoy-life-enjoy-coding/react-redux-%E5%B0%8F%E5%AD%A9%E5%AD%90%E6%89%8D%E5%81%9A%E9%81%B8%E6%93%87-hooks-%E5%92%8C-redux-%E6%88%91%E5%85%A8%E9%83%BD%E8%A6%81-1fdd226f5d99</a></p><p>Provider設定</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// app.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> createStore </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'redux'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Provider</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react-redux'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">reducer</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/store/reducer.js'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> store </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createStore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reducer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">App</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Provider</span><span class="token plain"> store</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">store</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Main</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">Provider</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>React 和 Store 溝通主要是 <code>state</code>和 <code>action</code>，<code>React-Redux</code>提供了 <code>useSelector</code>以及 <code>useDispatch</code>，範例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useSelector</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useDispatch </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react-redux'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">Page</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> todoList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">todoList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useDispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-redux-wrapper">next-redux-wrapper<a class="hash-link" href="#next-redux-wrapper" title="Direct link to heading">​</a></h2><p>Redux 使用在 Next.js上時，server-side 取用網站的 config或者 state資料都需要透過 <code>context</code>來取得，但是 Redux的 <code>store</code>是沒有在 <code>context</code>內的，這時候我們就需要額外安裝 <code>next-redux-wrapper</code></p><p>依賴 <code>react-redux</code>套件，並且要注意版本在 v7.x以上</p><p>首先有個小坑要注意，使用 <code>next-redux-wrapper</code>之後，雖然仍然使用 <code>react-redux</code>的 <code>useSelector</code>及 <code>useDispatch</code>來跟 <code>Store</code>溝通，但<code>react-redux</code>的 <code>Provider</code>就不需要加上去，否則 <code>state</code>的更新上會出現 bug。</p><ul><li>store.js</li></ul><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// store.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> createStore</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">AnyAction</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Store</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'redux'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> createWrapper</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HYDRATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'next-redux-wrapper'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// create your reducer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> reducer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">tick</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'init'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HYDRATE</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Attention! This will overwrite client state! Real apps should use proper reconciliation.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'TICK'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">tick</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// create a makeStore function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">makeStore</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createStore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reducer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// export an assembled wrapper</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> wrapper </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createWrapper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">makeStore</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">debug</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>getStaticProps</code>或 <code>getServerSideProps</code> 發出 dispatch時 type為 <code>HYDRATE</code></p><ul><li>app.js</li></ul><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> wrapper </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'../components/store'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">WrappedApp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Component</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> pageProps </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">pageProps</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">WrappedApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">getInitialProps</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wrapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getInitialPageProps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">store</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Component</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> ctx </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> wrapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">withRedux</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">WrappedApp</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>關於 <code>getInitialProps</code>、<code>getStaticProps</code>、<code>getServerSideProps</code> 等的寫法參考官方文件：</p><p><a href="https://github.com/kirill-konshin/next-redux-wrapper#server-and-client-state-separation" target="_blank" rel="noopener noreferrer">https://github.com/kirill-konshin/next-redux-wrapper#server-and-client-state-separation</a></p><ul><li>reducer</li></ul><p>reducer的設定是其中比較神秘的部份，必須在 reducer 的 function裡 switch-case的「<strong>最上方</strong>」（也就是要在第一個做判斷）增加判斷 <code>action.type</code>為 <code>HYDRATE</code>，就我的理解這個是在<code>getStaticProps</code>或 <code>getServerSideProps</code>  執行時會自動被 <code>dispatch</code>，要在這邊更新 server-side（或者 static site的 build-time）中的 <code>state</code>。</p><p>此時 <code>action</code>裡會有一包 <code>payload</code>物件，裡面是更的 <code>state</code>，要用他來取代表舊的 <code>state</code>。</p><p>如果 <code>reducer</code>是最外層的話（rootReducer），寫法範例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">initState</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./state.js'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HYDRATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'next-redux-wrapper'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">reducer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> initState</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HYDRATE</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 原本的 state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">payload</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 更新的 state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 略… 其他 case</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>要注意的是，即使該 <code>reducer</code>並不是對應到 state-tree最底層（比如使用了 <code>combineReducers</code>），<strong>reducer中注入的 <code>state</code>及 <code>action.payload</code>卻仍然是最底層的 <code>state</code></strong>，所以這時候就要注意回傳 state-tree的節點位置</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// store.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> createStore </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'redux'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> combineReducers </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'redux'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> createWrapper </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'next-redux-wrapper'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">auth</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./auth/reducers.js'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">makeStore</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createStore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">combineReducers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> wrapper </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createWrapper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">makeStore</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">debug</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// reducer.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">initState</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./state.js'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HYDRATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'next-redux-wrapper'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">auth</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> initState</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HYDRATE</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">auth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 注意！要回傳正確的 state-tree的節點位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">auth</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 注意！要回傳正確的 state-tree的節點位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 略… 其他 case</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> auth</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>javascript</category>
            <category>react</category>
            <category>next.js</category>
            <category>redux</category>
        </item>
        <item>
            <title><![CDATA[Vue2的 Option-Based Component中使用Typescript的簡易方式]]></title>
            <link>https://upstairs0102.github.io/blog/2021/02/09/vue-option-based-component-with-typescript</link>
            <guid>2021/02/09/vue-option-based-component-with-typescript</guid>
            <pubDate>Tue, 09 Feb 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>之前使用 Vue2.x開發時又想使用 Typescript，當時遇到的困擾是… Component使用 Typescript時根本就吃不到 this的型別，所以基本上是無法直接使用的，唯一的方式也只能採用官方推薦的 Class Component寫法，會寫到覺得很生氣（？）， Class Component的寫法實在是頗不直觀。</p><p>一直到 Vue3.0推出之後，才終於徹底改善了對 Typescript的支援；但我的工作上基於某些理由，短時間內無法轉為使用 Vue3.0，所以我就來簡單研究了一下，在 Vue2.x環境下是否有使用 Typescript合適方式？</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用-composition-api">使用 Composition Api<a class="hash-link" href="#使用-composition-api" title="Direct link to heading">​</a></h2><p>都說要使用 Vue2.x的 Option-Based Component了，何來 Composition Api？但本篇文章要提出來的解決方式正是 Composition Api。</p><p>雖然 Composition Api是 Vue3.0的產物，但官方也提供了 <a href="https://github.com/vuejs/composition-api" target="_blank" rel="noopener noreferrer">Composition Api for Vue2.x的套件</a>，在 Vue2.x的環境中安裝之後就可以使用 Composition Api。</p><p>然後重點來了，使用 Composition Api仍然是相容 Option的寫法了，所以你可以不改變原本寫法的情況下，得到差不多於 Vue3.x對於 Typescript的支援度（應該是吧）。最簡的使用範例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> defineComponent </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@vue/composition-api'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 可維持原本 Option的寫法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">data</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 略…</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然而在我的實測中發現會有些小細節是和 Vue3.0環境中會有些差異，這個在後面會再做說明。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="props的型別">Props的型別<a class="hash-link" href="#props的型別" title="Direct link to heading">​</a></h2><p>Vue 原生就有定義 Props型別的功能（<code>type</code>欄位），但是 <code>type</code>欄位只限於 javascript的原生型別，如果想要宣告為 Typescript的型別的話有以下兩種方式：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="方法1---使用-proptype">方法1 - 使用 <code>PropType</code><a class="hash-link" href="#方法1---使用-proptype" title="Direct link to heading">​</a></h3><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defineComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PropType </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@vue/composition-api'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Value</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Object </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> PropType</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Value</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="方法2---使用-function-return-typeinterface">方法2 - 使用 function return Type/Interface：<a class="hash-link" href="#方法2---使用-function-return-typeinterface" title="Direct link to heading">​</a></h3><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defineComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PropType </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@vue/composition-api'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">MyValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Object </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> MyValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 注意！以下寫法是錯的喔！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// type: Object as Value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="option上data欄位的型別">Option上「data」欄位的型別<a class="hash-link" href="#option上data欄位的型別" title="Direct link to heading">​</a></h2><p>Component的 <code>data</code>欄位本身就是一個 function，所以在宣告型別上也是很簡單的，有以下兩種方式：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="方法1---使用註記-annotation的方式">方法1 - 使用註記 (Annotation)的方式<a class="hash-link" href="#方法1---使用註記-annotation的方式" title="Direct link to heading">​</a></h3><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defineComponent </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@vue/composition-api'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">MyValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">data</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> MyValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      label</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'default'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'default'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="方法1---使用推論-inference的方式">方法1 - 使用推論 (Inference)的方式<a class="hash-link" href="#方法1---使用推論-inference的方式" title="Direct link to heading">​</a></h3><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defineComponent </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@vue/composition-api'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">MyValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">data</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        label</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'default'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'default'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> MyValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vue2x-composition-api和-vue30的部份差異">Vue2.x Composition Api和 Vue3.0的部份差異<a class="hash-link" href="#vue2x-composition-api和-vue30的部份差異" title="Direct link to heading">​</a></h2><p>既然都使用 Composition Api了，自然也不會想死守著舊的 Option的寫法，想嘗試看看 Composition Api的威力。</p><p>不過我實際在使用的時候，還是踩了一些坑，發現由於 Vue2.x和 Vue3.0在底層上有一些基本的差異，所以寫法並不會 100%一模一樣的；以下是我目前為止遇到的問題：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-使用-set新增物件欄位">1. 使用 set新增物件欄位<a class="hash-link" href="#1-使用-set新增物件欄位" title="Direct link to heading">​</a></h3><p>從 Vue2.x開始學起的開發者應該都知道 <code>$set</code>的寫法以及原理，這個是一個蠻大的主題所以在這裡就不深入去探討了（要解釋清楚需要一整篇文章來解釋，網路上也有相當多的文章了）。</p><p>簡單講呢… Vue3.0 的底層改使用 proxy取代 Vue2.x的 definedObject來實做資料的雙向綁定，所以 Vue3.0的 Component中 <code>data</code>中宣告物件時，物件要新增欄位不需要使用 <code>$set</code>也能監聽到資料的異動。</p><p>但 Vue2.x即使是裝了 Composition Api，仍然受到底層的限制，寫法上自然和 Vue3.0有些差異。</p><p>在 Composition Api的 <code>setup</code>當中由於不能用 <code>this</code>來使用 Vue實例上的 <code>$set</code>，所以必須額外 import Composition Api提供的 <code>set</code>。範例如下：</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defineComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reactive</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> set</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SetupContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Data </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@vue/composition-api'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setup</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> context</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> SetupContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">reactive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      selectedValueArr</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">selectDropdown</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> item</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dropdowns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">indexOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 使用set加入新的欄位資料</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">selectedValueArr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 以下寫法無法雙向綁定資料</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// data.selectedValueArr[index] = item.value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      selectDropdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-某些能-import進來的東西可能不一樣">2. 某些能 import進來的東西「可能」不一樣<a class="hash-link" href="#2-某些能-import進來的東西可能不一樣" title="Direct link to heading">​</a></h3><p>以我有限的使用經驗，還不曉得所有可能的差異，就我目前所遇到的是 Vue2.x Composition Api有一個叫做<code>Data</code>的 type，在 Vue3.0中是沒有的，依照我找到的資料說明<code>Data</code>是用在<code>setup</code>中注入<code>props</code>所使用預設型別。</p><p>範例如下：</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// vue2.x composition-api</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defineComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SetupContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Data </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@vue/composition-api'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// vue3.0 以下寫法會找不到 Data 所以會出錯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// import { defineComponent, SetupContext, Data } from 'vue'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'value'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setup</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> context</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> SetupContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不過呢…</p><p><code>Data</code>這個東西我感覺他沒有什麼實用性，檢視他的型別其實是這樣子。</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Data</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">unknown</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再來，如果你有按照前一個章節所介紹的方式去註記<code>props</code>的型別，在<code>setup</code>中所注入的<code>props</code>是完全不需要再註記的，Typescript他自己就可以推論出來。</p><p>所以這裡我唯一要解釋的，只是說<code>@vue/composition-api</code>和 Vue3.0能 import可能會有所不同，這裡僅是作為範例來說明。</p><p>至於是否有其他實際影響使用的差異，因為的經驗有限所以還不曉得了（我很抱歉 XD）。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="結論">結論<a class="hash-link" href="#結論" title="Direct link to heading">​</a></h2><p>既然 Class Component在 Vue3.0之後已經被官方所棄用，所以我也覺得沒有任何理由要再採用 Class Component。</p><p>本篇文章我依照我自己在工作上的經驗所整理出來的，能夠在 Vue2.x的環境下也能方便的結合 Typescript，希望對大家有幫助。</p>]]></content:encoded>
            <category>javascript</category>
            <category>vue</category>
        </item>
        <item>
            <title><![CDATA[相容 Vue2及 Vue3環境的 Component寫法]]></title>
            <link>https://upstairs0102.github.io/blog/2021/02/09/compatible-vue2-and-vue3</link>
            <guid>2021/02/09/compatible-vue2-and-vue3</guid>
            <pubDate>Tue, 09 Feb 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>理論上 Vue3.x大多數的寫法是有向下相容 Vue2.x的寫法，所以理論上<code>.vue</code>檔Component的寫法只要同時符合 Vue3.x和 Vue2.x的寫法，是能夠將同一個檔案共用於兩者不同環境當中。</p><p>以下會針對幾種我遇過在這兩個環境中較大差異的部份以及解決方式做個說明。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="v-model">v-model<a class="hash-link" href="#v-model" title="Direct link to heading">​</a></h2><p>Vue2.x和 Vue3.x Component雙向綁定主要有兩個差異：</p><ol><li>Vue3.x移除了 <code>.sync</code>寫法，並且單一 Component中可有多個 <code>v-model</code>。</li><li><code>v-model</code>對應的 <code>prop</code>和 <code>event</code>預設名稱不同。</li></ol><p>在 Vue2.x的環境當中，<code>v-model</code>預設對應 <code>v-bind:value</code>和 <code>@input</code>，例如：</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;input :value="syncValue" @input="handleInput"/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- 等同於 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;input v-model="syncValue"/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 Vue3.x的環境當中，<code>v-model</code>預設對應 <code>v-bind:modelValue</code>和 <code>@update:modelValue</code></p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;input :modelValue="syncValue" @update:modelValue="handleInput"/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- 等同於 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;input v-model="syncValue"/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>綜合以上即可得出一個結論，只要使用 <code>model</code>欄位設定預設的<code>prop</code>和<code>event</code>為和 Vue3.x預設值相同，那麼就可以讓這個 Component的<code>v-model</code>同時相容於 Vue2.x和 Vue3.x。</p><p>也就是只要在 option當中加入這個即可：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">model</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">prop</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'modelValue'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">event</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'update:modelValue'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>範例如下：</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;input v-model="syncValue"/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 使用 model設定預設的 prop及 event名稱</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  model: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prop: 'modelValue',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event: 'update:modelValue'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  props: ['modelValue'],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  computed: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    syncValue: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      get () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.modelValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      set (v) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.$emit('update:modelValue', v)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="偵測環境">偵測環境<a class="hash-link" href="#偵測環境" title="Direct link to heading">​</a></h2><p>在某一些更複雜的情況，已經沒有辦法在同一支程式入同時相容於 Vue2.x和 Vue3.x兩個環境，必需要分成兩支程式才行，這時候我們可能就會需要用程式來判斷目前的環境是 Vue2.x還是 Vue3.x，再<strong>「動態import」</strong>進來所對應的程式<strong>（需注意，如果是採用一般的 import方式可能會在 webpack打包時就依賴所有程式造成出錯）</strong>。</p><p>Vue實例在這兩者環境底下會有不同東西，我自己採用的判斷依據是判斷 Vue實例底下是否有<code>_isVue</code>，如果有的話就是 Vue2.x、沒有的話就是 Vue3.x，例：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">_isVue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// vue2.x  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// vue3.x</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完整範例：</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    :is="dynamicComponent"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/component&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dynamicComponent: undefined</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  created () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (this._isVue) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // dynamic component (vue2.x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      this.dynamicComponent = () =&gt; import('./ComponentV2.vue')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // dynamic component (vue3.x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import('./ComponentV3.vue')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .then(d =&gt; this.dynamicComponent = d.default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="functional-component">Functional Component<a class="hash-link" href="#functional-component" title="Direct link to heading">​</a></h2><p>Function Component在 Vue2.x和 Vue3.x當中有非常大幅度的 breaking change，所以基本上如果要相容的話肯定是要分別寫成不同的程式的。</p><p>就我的經驗當中這個部份是最花時間，而且挫折感最重的地方，建議先將官網文件完整看過一遍，再開始從簡單的 Component實作中練習起：</p><p><a href="https://v3.vuejs.org/guide/migration/functional-components.html#overview" target="_blank" rel="noopener noreferrer">https://v3.vuejs.org/guide/migration/functional-components.html#overview</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="結論">結論<a class="hash-link" href="#結論" title="Direct link to heading">​</a></h2><p>應該還會有很多我沒有實作過的不同情況，以上就以我自己的經驗所遇過的情況跟大家分享囉。</p>]]></content:encoded>
            <category>javascript</category>
            <category>vue</category>
        </item>
        <item>
            <title><![CDATA[Vue父子組件資料流設計 (1) 單向傳遞]]></title>
            <link>https://upstairs0102.github.io/blog/2020/05/09/vue-component-dataflow-1</link>
            <guid>2020/05/09/vue-component-dataflow-1</guid>
            <pubDate>Sat, 09 May 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[落落長的前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="落落長的前言">落落長的前言<a class="hash-link" href="#落落長的前言" title="Direct link to heading">​</a></h2><p>雖然說Vue上手容易，就以我來說我剛開始學習的時候幾乎是網路上看了幾篇文章就開始寫了，但是後來就吃了很多悶虧，慢慢在各專案中累積實戰經驗之後才知道有更好的做法，並且每種做法的差異以及適用的情境…</p><p>關於組件(Component)的設計當中，資料傳遞的設計幾乎是整個Vue的程式開發中最重要的一件事情…（個人見解 XD），尤其是當團隊（或者專案中）開始考量組件的複用性、開始重視組件的開發，這件事情尤其重要。</p><p>以下就不廢話了。</p><p>如同標題，這一系列文章會聚焦在Vue父子組件(Component)傳遞資料的設計，而之所以會選用「資料流」這個詞的原因是在於，關於傳遞資料除了「父傳子」和「子傳父」之外，實作層面上牽扯到很多面向及細節，我想要一併來做討論。</p><p>舉例來說，當我們要製做一個Vue Component時，除了要思考prop參數該如何設計、該用單向綁定還是雙向綁定？子組件是否應該複製prop資料紀錄在子組件中？…等等。不同的Component和他的使用目的就會有不同的合適的寫法。</p><p>而本系列文章的撰寫方式會先將各種的寫法分類之後，各別舉例說明並討論什麼樣的情況適合用這個方式來寫。</p><p> 本系列文章如下：</p><ul><li>Vue父子組件資料流設計 (1) 單向傳遞</li><li>Vue父子組件資料流設計 (2) 雙向綁定–通用組件</li><li>Vue父子組件資料流設計 (3) 雙向綁定–大組件</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一props-down-events-up">一、Props down, Events up<a class="hash-link" href="#一props-down-events-up" title="Direct link to heading">​</a></h2><p>當兩個組件(Component)為父子關係(parent-child relationship)的時候，兩個組件就是透過<strong>Props down, Events up</strong>的方式在進行溝通。下圖就是Vue官方用來解釋這個溝通模式的圖，父層透過<code>Props</code>將數值傳遞給子層，而子層透過事件的方式將數值傳遞給父層。</p><p>要注意的是，這個資料傳遞是有方向性的，在這個規則底下子層並不能主動跟父層拿取新的資料（props的變更只能由父層決定），而父層也不能主動跟子層拿取資料、或者呼叫子層的函式（父層只能監聽子層事件的觸發）。</p><p><img loading="lazy" src="/assets/images/20107673f0zb0ZxRz9-1da2608f26e72286b0164ab4e4bedf15.png" width="790" height="646" class="img_ev3q"></p><p>以下用一個範例來說明這個資料傳遞的流程（避免浪費太多讀者的時間，本文後續所有範例都將用此程式碼稍作修改）。</p><p>此範例如下，首先網頁上呈現一筆字串資料<code>Text</code>，並有一個「編輯」按鈕：</p><p><img loading="lazy" alt="image-20200426205112559" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJsAAAA9CAIAAAA1RowoAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAm6ADAAQAAAABAAAAPQAAAAACAkW1AAALxElEQVR4Ae2cdawUyRaH9+Lu7m5BgrvrBgju7u6uIdjirsFdHx4cgktwd5cHPNyd/TZnqe3tuTO37+T2vGZS80dTXX3Kzq+O1KlzCfjx48dv+udHHAjlR2vRS/mLAxpRf9sHGlGNqL9xwN/W40lGJ0yYsGrVKlnx5cuX8+TJc+fOHVcGdOrUad26dVJ/5MiR//z7d//+fWOToUOHdunShZovX77wPHv2bOrUqY0ElD9+/Pi/n7+vX79SU7ly5W7duv3X8Hv79q1qde/evWjRotFK1Ujh06dP8ePHf/r0qanev18D3Pm6t2/fTpky5bZt28qUKQMLvn371rBhQwA7fPhwvHjxFFOuX7+eNm3akydPZs+enco6deocOHAgTZo0QnDixIk5c+bUqFFDXmFxsmTJhgwZUq9evShRotCKbnPnzm2aw/z585s0aSJN9u/fz0waNGhgHPTJkycjRozo1asX/TMceKdIkYLKHDly3Lx5c9KkSYkTJ65du/b79+8jR4784MGDRIkSSW+uT6Y0d+5c13pq8uXLJ4sK9KtzK+FmoD+YWKJECeMnhKB06dJw7fXr16q+ffv2VH7+/Hny5MnUw8fx48err8WKFVu5cqV6Xb58edSoURGvHTt2wBG4eezYMQqKwLVAcwj27dv3/PnzVKlS0XD37t10grhCzJ4AaSAXmkyZMlG5ZcsWXgcNGiRyDKKu3aqaV69e/f7zly5dOhr+fPud2Soyi4XTp09nzZrVIrFNZIFzE1RYG/wyjvr9+3fkgGXXrFmTMp8eP34M2fHjx2fPng27gdwDokgMbXv37k1DxIuGSZIkEcmjID8Ejq9r1qz54+dvwYIFoP7u3bu6desCJKOMGzduw4YNMjFEnEqBcMaMGU2bNpX6M2fO0OH69esZxTOiQi/PKVOm0L+xJrhlsT7BbRWy9GFYs+k3ffp0TN3ixYs3btyIvsIUCcGSJUswZlu3bkVM8+fP37lz5wEDBsBQ9CrEy5YtCx8+PJSrV6++e/euNLl48aLqvF+/flevXk2fPv2LFy+mTZs2cuRI9C3muW3btgsXLhSyzJkzU0BuXr58KTWoU8ZliFKlSmEvAa9ly5boQ7Rr8+bNUaoAHCbMX6vIlSuXNEegixQpcuXKFelBPVEk7IyYMWOqGisFzPDo0aPZtQkSJEC9iwUZNWpUqFChunfvTg84BPAhW7Zst27dYkdS06FDB3aGuAtWhghZmkAQDQgIWLRoERaxZMmSly5dAiqGBAZY36ZNG0wLmlDAYxkJEybEeypUqFDx4sVlZnyKESOGlMOFCyeF7du3i9zzCpxYaDZH6NCh2RDUqLZC3LhxY3QAPhSvAIODBvaMNXHiRGrq16/PpmavRIgQYefOnXQrPhFCDLTMFqbD+qlTpwKhdChPGjJVQI0UKZKx3kOZVbNe6Fu3bn3t2jWUE+gCJDuGPY21hku4BayI+bx58yZ69Oj0hgxIwUPPNn7yIPKsgYGRVGiwl5QfPXpkoke/gcrRo0d5wix3Wnf48OFjxowpXLjwvHnz9uzZg8Ml/bizo+IJYwtRGKYf2x+0pDlWYPPmzUgwc0PHbtq0Cd2OrEBTvnx5EXSldVEkSI/YC9Mq5NVV6/bt25eescdCgM/Fq7gRY8eOpTxz5kyezEEIHKp1maL8cFmRgGbNmqH3WC18VBpYCJ49ewbj8EvxOalBEP9u6fIP8s22FcNGJzjMQAsV3OcpZQqxYsWqVKmSao02xiVWr1JA36qauHHjouSLFi1KDbqaLch8UNT45GvXrg0bNqyipICDzc9YE2QZTxtvC99bKNnQFNBbHORQqmzNVq1a9enTB2cqyK58RhCI1jWOjWiuWLECb7ZatWqoXOMnypgTjpvAg7oTnUYlPs3SpUuFEhEES8pGLYTtVMdc1Bpf1StnUyOiXbt2TZ48uXSlnthj7IJ6RS45EPMK69F+gwcP5ggLukmTJkW4qa9YsSLaUnwx1cpigX7oDfOv6Dt27Ii25xVZF23/4cMH9dUJhSAQhftoNiaKOHJgMB3sUGIAiSjAYoQYPxbtWqFChVq1asnaAvUOMHL8hACPAxuJ1gqUFzjbrjENjjGoOKEnQAGQsl0yZsx44cIFzqkIDV/xovHCKFSvXl2O1IEO4bkyQ4YMHEjEfkN548YNDq/sFcoMhCbAbGNKURJqRZ479MFXT4jKSZ+DKeoU8FgeC0CtqWkdPHgQhcmhE9TZy6J1s2TJojhoDAuoVtYLbCMxqMYmRn8H/cEGkq84n5g9TDUmAFkHZokwNGrUSDYiygNPChMuvrGxT3dlFAyrGzZsGA42a0RLxYkTB28Zd7p///4Ex6pWrQrMxF7wJ3D3YseOTVdoJs5pRrXkrn9b6sWkG58c/EGOIwrjYfnlE4DBEWpgGSYKRlOPUOKycjosWLAgB3+80ypVqrB5cSXkRz0HSiGGXjwj41juPCN0Gl5Gz549cbh4YoCZEmX2Ey4JgSrpBC5zuhA5RvsZe6aMp8aElWeEwsRjYnUmMvWKmgEJ9SoFcbuE9cyfgxn7jJ0KxkLA6qhH08AiOi9btizEbAVTPz57NUcY4AJnc3g3cOBAxQs1G3jXo0cPZoyuYyXMHi2Eq4Lxg8adg0DEQHqwiChmFeSYA/zFVMs0mBjmGYGjnhlynMCMSbcSMwoSUbWK4BZYKT4Xuye4Df8v9GZEmQSeDhLmYTZYMmQLAtwiIuqKknpDLP2fouI1agpTp+gpIGGuwTZokEj8ESOlKhMnwr5yYlY1zJZXRETVSAEkCGaxFUz1/v3qNlIvekY/fzkOeLpN++UWoycMBzSi/rYNzKcX4pOEW325SuwifpYvR/TvscyI4l/4mL9ECfybxT5enda6Pma47cNpRG1nsY8HCAaiHO84yQU5P/R2kDSawD4OmO2oh5FmzZpFUL5FixbchhLzIzhAeIG4F54Ud9TEcjnLc+tLagHxASh37dq1d+9edU9CYMz1IsXDcPqTdxywiighN25JuYw8dOjQqVOnALJcuXKErSNGjMjAROZ4crn/8OFDgq7E6ojoUkPiAZdZ8omIkkYUVtj9s4ooF15E4QkQct9CvBvpJF+EH/Mj4MktBykKXKJx70FokCRCLpjOnz+PjEosHlUsqNu9Ht2/VURJyECjole5MiNPBRRFOuEgyR+SWAR+5DaSeYTF5baEOwpFw9USIVauZTTH7eaAVUSJpyOmXP+SkId/ROpUgQIF1ORUqhhBdtISuI3hlhT4ybki/QwybsLJblH0umAfB6wiyi0xl2KoVq63SKJHHLkPBzNmRoolqZdka1JGFkGR5CAw5gaY+y90L/UYV2yqfcvQPSsOWEWUlFRQIUcX3csfmZC8SlYjgHFrz7WoZL7TKalfuL7q+p6MEBKUqG/Xrp0aUhds5YBVRMlKIQ+DXFyMKOoX+ePJPTB+kDqkYkTxm7h/JuEKAlxisgIkz0+k2daV6M6FA1YRRdliONGoJDxyRMmbNy/32IijpI1JX8CGQkYJk3tAmRMOCSVk8PKV84zce6vjqQbAJg5YRZRUVXDiuIKXmzNnToSV8wlHTKPWBV1Joud57tw5MhaoIdrA1PGnSMzh75DYEzatRHcrHLCEKOEFggkcQ5E8pA04JVkL5MCMhDwyK+mO8yiUvEqiM4pacZk/YSCvTMOpGGJfwZyVwt0W5tB1PG4x5d6UggR48X6BE0okFYdImmBTiQ6S6m7qgRQ6UunZCqZ6Xt2N6Eqpa6xwwJKM0pHAKQVVlgEUnLxiJl3hpJ4/BBZi/bSbA8G4e7F7Krr/EOGARjRE2OigTjSiDgIjRKZitqNkM8t/khAivVvphPOrFTJNY5EDZl/XYjNN5lgOaK3rWGi8nJhG1EvGObaZRtSx0Hg5MY2ol4xzbDONqGOh8XJiGlEvGefYZhpRx0Lj5cQ0ol4yzrHNNKKOhcbLiWlEvWScY5tpRB0LjZcT04h6yTjHNtOIOhYaLyemEfWScY5tphF1LDReTkwj6iXjHNvsT3vsLpVv69pDAAAAAElFTkSuQmCC" width="155" height="61" class="img_ev3q"></p><p>點了「編輯」按鈕後會出現一個彈出視窗，此時進入了資料的編輯模式，有一個輸入框可以修改這筆資料的文字。而下方有兩個按鈕，點擊後的行為說明如下：</p><ul><li>點擊「取消」按鈕會關閉彈出視窗，無論剛才輸入框修改為什麼文字，此時網頁上的字串仍然為原本的<code>text</code>；再次開始彈出視窗字串則輸入框也是原本的<code>text</code>。</li><li>點擊「完成」，則會將剛才修改的文字會紀錄起來並呈現在網頁上。</li></ul><p><img loading="lazy" alt="image-20200426205139781" src="/assets/images/image-20200426205139781-20c7057038f1ccbc8fdee3e707a64101.png" width="1216" height="340" class="img_ev3q"></p><p>html結構如下，彈出視窗包裝成Component名為<code>lightbox</code>：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">app</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    父組件資料: {{value}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">@click</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">openLightbox</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">編輯</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">lightbox</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">:active.sync</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">isLightboxActive</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">:value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">value</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">@submit</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">updateValue</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">lightbox</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Vue的主程式中宣告父層的行為：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Vue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">el</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'#app'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">components</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'lightbox'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Text'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">isLightboxActive</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">methods</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">openLightbox</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isLightboxActive</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">updateValue</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>宣告子組件（彈出視窗）的行為：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">component</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'lightbox'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">template</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;transition name="fade"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div class="lightbox" v-if="active"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;div class="content"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">          子組件資料 &lt;input type="label" v-model="value"&gt;&lt;/input&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        &lt;div&gt;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">          &lt;button @click="close"&gt;取消&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">          &lt;button @click="submit"&gt;完成&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;div class="bg" @click="close"&gt;&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;/transition&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'active'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'value'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">methods</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">close</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'update:active'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">submit</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'submit'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上為全部的程式碼了。</p><p>觀察這個範例的資料流，即是依照「Props down, Events up」來進行單向資料流的傳遞的：</p><ul><li>Props down：父層將資料v-bind單向綁定<code>lightbox</code>組件的prop <code>value</code>。</li><li>Events up：當點擊「確認」按鈕時，會透過emit再將<code>value</code>值傳遞給父層。</li></ul><p>即使我們不看Component內程式，只要觀察組件<code>lightbox</code>的屬性就大概可以知道其資料流了：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">lightbox</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">:active.sync</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">isLightboxActive</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">:value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">value</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">@submit</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">updateValue</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">lightbox</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這個範例在操作上沒有什麼問題，但是就程式碼方面其實是有一些瑕疵的…（但不影響本章節要說明的內容），所以接下來會繼續說明有哪些地方應該要修正的。</p><p><a href="https://codepen.io/cdpqdnvr/pen/yLYbJqw" target="_blank" rel="noopener noreferrer">Codepen範例完整程式在此</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二基本原則勿直接修改prop">二、基本原則–勿直接修改prop<a class="hash-link" href="#二基本原則勿直接修改prop" title="Direct link to heading">​</a></h2><p>前一個範例可以當作是一個錯誤的示範，在本章節要很慎重的來探討這件事情：<strong>「勿直接修改prop！」</strong></p><p>在說明這個規則之前先回頭來看一下前面的範例，這把前例的操作說明、父組件值、子組件值整理成下表：</p><table><thead><tr><th>操作說明</th><th>[父層]<!-- --> value</th><th>[子組件]<!-- --> value</th></tr></thead><tbody><tr><td>Step1.初始化</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step2.點擊「編輯」按鈕，彈出視窗</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step3.修改文字為「New Text」</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step4.點擊「取消」按鈕，關閉視窗</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step5.點擊「編輯」按鈕，彈出視窗</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step6.修改文字為「New Text」</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step7.點擊「確定」按鈕（emit傳值），關閉視窗</td><td>'NewText'</td><td>'NewText'</td></tr></tbody></table><p>透過上表，我們可以觀察到幾個重要的地方：</p><ol><li>Step3：修改子組件的<code>value</code>時並不會影響到父層的<code>value</code>。</li><li>Step4：這個地方乍看下有些詭異且不受控制，關閉彈出視窗後，子組件的<code>value</code>由原本的'New Text'回復到原來的'Text'。原因是因為子組件的<code>value</code>實際上還是會受到父子組使用<code>v-bind</code>單向綁定的影響，而子組件的<code>value</code>又使用了<code>v-model</code>雙向綁定在input輸入框上面；關鍵就在於子組件關閉視窗是使用<code>v-if</code>將包含了input輸入框在內的整個區塊給移除掉，所以控制權又移交給了父組件的手上。</li><li>Step6：修改子組件的<code>value</code>時並不會影響到父層的<code>value</code>。</li><li>Step7：component中使用<code>emit</code>將資料傳遞給父層，父層的資料才同步過來。</li></ol><p>當中<code>step3</code>和<code>step6</code>修改prop不會影響到父層的關鍵在於，此資料是使用<code>v-bind</code> 綁定資料的，而<strong>v-bind是單向綁定所以只有當父層變更資料時才會傳遞給子層，子層變更資料時是不會回傳回去的</strong>。</p><p>這個範例我放在Codepen上，透過console看不到Vue傳遞出來的error log（我是使用Chrome瀏覽器）。如果是在自己的開發環境下測試，可以看到類似下圖的error log：</p><p><img loading="lazy" src="/assets/images/70-1e43a04352b0a7af1deca4ee7bbc9e1c.png" width="1380" height="151" class="img_ev3q"></p><p>那… 講那麼多，既然不會影響到外層，那「直接修改prop」的原因是什麼呢…</p><p>我認為原因有：</p><ol><li>不影響外層的規則有個「例外」，就是<strong>當資料型別是「傳參考(call by reference/pass by reference)」時還是會影響到的</strong>（這邊在本文第五章、以及系列文章第三篇「雙向綁定-由父組件來紀錄資料」中都會再詳細說明。</li><li>雖然說修改prop還是有效的，但實際上prop還是有可能在某些時候受到父組件使用v-bind單向綁定的影響（如本例的<code>step4</code>），很明顯的有可能會在某些很難預期的情況下出現bug（而且很難除錯）。</li><li>程式可讀性上的考量，某些情形下使用相同的名稱會造成混淆，使用不同的命名以區別不同的操作流程中紀錄在不同的變數裡。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三子組件在createdmounted複製prop">三、子組件在created/mounted複製prop<a class="hash-link" href="#三子組件在createdmounted複製prop" title="Direct link to heading">​</a></h2><p>在前面章節提到一個重要的規則「勿直接修改prop」，要滿足這個規則，子組件中需要再宣告一個新的變數來複製prop的值。</p><p>這裡我們在Component <code>lightbox</code>的<code>data</code>中加入新的變數<code>childValue</code>。然後，在<code>created</code>中將<code>value</code>複製給<code>childValue</code>。程式碼如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">data</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">childValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">created</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接著，把原本Component <code>lightbox</code>中的輸入框用v-model綁定的變數也改成<code>childValue</code>：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">label</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">v-model</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">childValue</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">input</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這樣就大致完成了。</p><p>接下來我們再仔細來看一下這個範例的一些細節… 我們用和前例同樣的「操作說明、父組件值、子組件值」對應表看一下這有沒有什麼差異：</p><table><thead><tr><th>操作說明</th><th>[父層]<!-- --> value</th><th>[子組件]<!-- --> value</th><th>[子組件]<!-- --> childValue</th></tr></thead><tbody><tr><td>Step1.初始化</td><td>'Text'</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step2.點擊「編輯」按鈕，彈出視窗</td><td>'Text'</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step3.修改文字為「New Text」</td><td>'Text'</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step4.點擊「取消」按鈕，關閉視窗</td><td>'Text'</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step5.點擊「編輯」按鈕，彈出視窗</td><td>'Text'</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step6.修改文字為「New New Text」</td><td>'Text'</td><td>'Text'</td><td>'New New Text'</td></tr><tr><td>Step7.點擊「確定」按鈕（emit傳值），關閉視窗</td><td>'New New Text'</td><td>'New New Text'</td><td>'New New Text'</td></tr></tbody></table><p>這時候會發現一個很明顯的差異：</p><p>從<code>step1</code>到<code>step6</code>無論是父組件的<code>value</code>和子組件的<code>value</code>都不在受到子組件修改資料的影響，只有到最後<code>step7</code>最終點下「確定」按紐時才會將父層的<code>value</code>更新為使用者確認修改完成的資料。</p><p>But！</p><p>又出現了一個But！</p><p><code>step4</code>按點「取消」按鈕時，子組件的<code>childValue</code>卻還是停留在第一次改過的值'New Text'。也是說當<code>step5</code>再次點開彈出視窗時，輸入框中的值會是'New Text'而不是原來的'Text'，為什麼會和前一個章節的結果不同呢？</p><p>原因很簡單，雖然彈出視窗關閉了，但這個子組件從最後開始到結束都在那裡，只是畫面上看不到而已，所以裡面的值還保留再正常不過了。</p><p>那如果想要修改為我們原來設計的流程，每次點開彈出視窗輸入框的值都是父層傳入的<code>value</code>要怎麼做呢？在不修改資料流的傳遞方式下，我們可以簡單修改一個東西…</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">lightbox</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">v-if</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">isLightboxActive</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">:active.sync</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">isLightboxActive</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">:value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">value</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">@submit</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">updateValue</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>答案就是在Component標籤上加上一個<code>v-if</code>就可以了！</p><p>雖然我們沒有更改任何Component內的程式碼，但是Component在整個頁面上的生命週期就被改變了–當彈出視窗關閉時，父組件的值<code>isLightboxActive</code>變成<code>false</code>，這時<code>v-if</code>為<code>false</code>，就將這個Component整個移除掉。下一次再點開彈出視窗（如本例的<code>step5</code> ）他就會整個重頭來過了！</p><p>同樣的表這時候就會長這樣了：</p><table><thead><tr><th>操作說明</th><th>[父層]<!-- --> value</th><th>[子組件]<!-- --> value</th><th>[子組件]<!-- --> childValue</th></tr></thead><tbody><tr><td>Step1.初始化</td><td>'Text'</td><td>無</td><td>無</td></tr><tr><td>Step2.點擊「編輯」按鈕，彈出視窗</td><td>'Text'</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step3.修改文字為「New Text」</td><td>'Text'</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step4.點擊「取消」按鈕，關閉視窗</td><td>'Text'</td><td>無</td><td>無</td></tr><tr><td>Step5.點擊「編輯」按鈕，彈出視窗</td><td>'Text'</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step6.修改文字為「New Text」</td><td>'Text'</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step7.點擊「確定」按鈕（emit傳值），關閉視窗</td><td>'New Text'</td><td>無</td><td>無</td></tr></tbody></table><p>當中<code>step1</code>、<code>step4</code>、<code>step7</code>子組件由於<code>v-if</code>為false的關閉所以根本就不存在，所以就被標示為「無」，我也們不需要擔心資料殘留的問題了。</p><p><a href="https://codepen.io/cdpqdnvr/pen/NWGjpeW" target="_blank" rel="noopener noreferrer">Codepen範例完整程式在此</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四子組件在watch中複製prop">四、子組件在watch中複製prop<a class="hash-link" href="#四子組件在watch中複製prop" title="Direct link to heading">​</a></h2><p>本章節中同樣的會在子組件中將prop的值複製一份存在子組件當中，不過和前例不同的地方，要改成在Vue的Option <code>watch</code>中來複製。</p><p>程式碼和前例只有一個地方不同，將原來子組件中的<code>created</code>移除掉換成如下程式碼：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">watch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">handler</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">immediate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 創建組件時也會進來</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在<code>watch</code>當中我們監聽的對象是<code>active</code>，當<code>active</code>為<code>true</code>時彈出視窗就會開啟，為<code>false</code>時彈出視窗就會關閉。也就是說，每一次當我們把視窗開啟後就會重新將父組件傳入進來的<code>value</code>複製給子組件的<code>childValue</code>。</p><table><thead><tr><th>操作說明</th><th>[父層]<!-- --> value</th><th>[子組件]<!-- --> value</th><th>[子組件]<!-- --> childValue</th></tr></thead><tbody><tr><td>Step1.初始化</td><td>'Text'</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step2.點擊「編輯」按鈕，彈出視窗</td><td>'Text'</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step3.修改文字為「New Text」</td><td>'Text'</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step4.點擊「取消」按鈕，關閉視窗</td><td>'Text'</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step5.點擊「編輯」按鈕，彈出視窗</td><td>'Text'</td><td>'Text'</td><td>'Text'</td></tr><tr><td>Step6.修改文字為「New Text」</td><td>'Text'</td><td>'Text'</td><td>'New Text'</td></tr><tr><td>Step7.點擊「確定」按鈕（emit傳值），關閉視窗</td><td>'New Text'</td><td>'New Text'</td><td>'New Text'</td></tr></tbody></table><p>由<code>created</code>和<code>watch</code>這兩個地方複製prop的這兩個範例來看，雖然都可以達同樣的目的，但有個小小的差別。</p><p>使用<code>watch</code>來監聽<code>active</code>變成將複製prop的主控權交給了子組件，也就是說即使父組件不加上<code>v-if</code>（如前一個章節範例），也可以確保每次打開彈出視窗都會執行複製prop這個動作。</p><p>此外小小補充個小細節。</p><p>範例中我們有在<code>watch</code>的option當中加上<code>immediate: true</code>，這代表了第一次將Component創建起來的時候也會進入函式，如果沒有加入的話要將程式碼修改如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">watch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">handler</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">created</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這時就要改成<code>watch</code>和<code>created</code>都必須複製prop。</p><p>有時候我們希望在<code>watch</code>和<code>created</code>當中要做不同的事情，就會將他們分開來寫，這也是一個很常用的技巧。</p><p><a href="https://codepen.io/cdpqdnvr/pen/JjYNWpr" target="_blank" rel="noopener noreferrer">Codepen範例完整程式在此</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五注意傳值及傳參考">五、注意傳值及傳參考<a class="hash-link" href="#五注意傳值及傳參考" title="Direct link to heading">​</a></h2><p>Javascript的「傳值」和「傳參考」(call by value/call by reference，或者pass by value/pass by reference) ，我先前有寫了一篇文章有稍稍微的詳細討論過可參考：</p><p><a href="https://upstairs0102.github.io/2020/02/28/js-call-by-reference/" target="_blank" rel="noopener noreferrer">簡單看Javascript的傳值以及傳參考</a></p><p>關於傳參考長話短說可以參考如下程式碼範例：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">number</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newObj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newObj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newObj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出101</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在這個例子中修改資料的是<code>newObj.number</code>，可是在最後印出<code>obj.number</code>的時候發現他也跟著變了，這個就是傳說中的傳參考…</p><p>在Javascript中，<code>string</code>、<code>number</code>、<code>boolean</code>、<code>null</code>、<code>undefined</code>都是「傳值」，而「物件」型別的都是「傳參考」（包含陣列也是物件的一種所以也是傳參考…）。若在物件複製的時候沒有留意使用的複製方式（是單純的傳參考還是深拷貝），有時候一不小心會因為資料渲染的問題而造成bug，這種bug非常難抓還需要一些經驗…；尤其是我在寫Vue的時候非常常會遇到。</p><p>以剛才的程式碼中，function替換成Vue的Component（請用想象的），就是在Vue的開發中最常遇到的問題了。</p><p>也就是說如果prop的值是物件（包含陣列），即使我們在子組件中把他複製一份並存在子組件的變數當中，如果我們複製的方式是使用「傳參考」，父層的值是會有可能被渲染的。</p><p>這裡以本文中一直使用的彈出視窗包裝成的Component <code>lightbox</code>做為範例。</p><p>當prop的格式為如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'阿貓'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'T001'</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Component <code>lightbox</code>中儲存的變數如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">childValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>並且在Component<code>lightbox</code>中的<code>watch</code>複製prop如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">watch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">handler</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">immediate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>直接來看如果是這樣將<code>value</code>複製給<code>childValue</code>，操作上會發生什麼事呢？</p><p><img loading="lazy" alt="image-20200501113622148" src="/assets/images/image-20200501113622148-8b5acf662e881df613ab1525527eb55b.png" width="1400" height="293" class="img_ev3q"></p><p>我們可以看到在彈出視窗中修改文字的「同時」，背景中的文字也就馬上跟著改變了。</p><p>要解決這個問題，就是要改成用「深拷貝」的方式，我們可以用以下幾種方式來修改程式碼。</p><p>方法一：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">watch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">handler</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">immediate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>方法二：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">watch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">handler</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">immediate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不同的資料格式有不同的深拷貝寫法，就我自己的習慣常用方法二 <code>JSON.parse(JSON.stringify(value))</code>，幾乎是適用所有格式的資料（除了一些特殊的物件不適用–比如說function或Date等）。</p><p><a href="https://codepen.io/cdpqdnvr/pen/jObmmPr" target="_blank" rel="noopener noreferrer">Codepen範例完整程式在此</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="六小結">六、小結<a class="hash-link" href="#六小結" title="Direct link to heading">​</a></h2><p>本文中所使用的關於Vue的知識其實都是相當基礎的，大部份的程式都是初學Vue不用太久都知道的基本的用法；或許就是太簡單，我自己本身也沒看過網路上有相關討論的文章（也可能是我沒看到而已），但是其實作上其實有非常多的細節，不同的情境上其實都各有巧妙之處。就我自己自學的歷程來說，也是寫了一堆爛code後，才整理慢慢出一些我自己的經驗法則；這也是我會想寫這個系列文很大的一個動機。</p><p>以本文的「單向傳遞」這個主題來說，將父層傳入子組件內的資料，在內部進行管理和父層區隔開來就是單相向資料流的一個關鍵，這個也延伸出子組件不能直接修改prop這個規則，並且這個規則是有理由的，本文中也對於此主題用範例做了一些討論和說明。</p><p>第二個重點是子組件內複製父層傳入值的時機點，不同的設計也是會有不同的理由以及影響，本文中用created/mounted以及watch兩種範例來做說明。</p><p>本文較著重於範例的解說，不曉得我的文字夠不夠清晰，希望對大家有幫助。</p>]]></content:encoded>
            <category>javascript</category>
            <category>vue</category>
        </item>
        <item>
            <title><![CDATA[Vue父子組件資料流設計 (2) 雙向綁定–通用組件]]></title>
            <link>https://upstairs0102.github.io/blog/2020/05/09/vue-component-dataflow-2</link>
            <guid>2020/05/09/vue-component-dataflow-2</guid>
            <pubDate>Sat, 09 May 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[一、單向/雙向資料流之差異及適用場景]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一單向雙向資料流之差異及適用場景">一、單向/雙向資料流之差異及適用場景<a class="hash-link" href="#一單向雙向資料流之差異及適用場景" title="Direct link to heading">​</a></h2><p>前一篇文章「單向傳遞」中我有提到過，我自己「體感」自製的Component大約只有百分之20是使用單向資料流傳遞的。不過在Vue中的「雙向綁定」是一大特色（雖然當初也是 <del>抄襲</del> 參考Angular的），當中的變化以及學問可多了。</p><p>就我自己個人的經驗，剛開始學Vue時開發自製Component大多都是使用單向綁定，對於自製的雙向綁定的用法有些困惑，隨著經驗的累積才開始慢慢掌握技巧以及合適的用法。依照我自己個人的經驗，我會把這百分之20中所適用的情境分為兩種：</p><ol><li>包裝resuse（可複用）的基本元素</li><li>因程式管理需求需抽離出來的大區塊</li></ol><p>為方便說明我就簡單將這兩種組件分別估且命名為「通用組件」–對應第一種（將在本文中討論），以及「大組件」–對應第二種（將在下一篇系列文中討論）。</p><p>分別說明如下：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="case1-通用組件">Case1. 通用組件<a class="hash-link" href="#case1-通用組件" title="Direct link to heading">​</a></h3><p>會看本系列文章的人應該都是有一些Vue開發經驗的人，大家應該都知道html原生元素可以直接使用<code>v-model</code>來做雙向綁定，包括：</p><ul><li><p>Input</p></li><li><p>Textarea</p></li><li><p>Radiobutton</p></li><li><p>Checkbox</p></li><li><p>Select/Option</p></li></ul><p>這類元素都有一個共通性，就是都是屬於「通用性質」的元素，原則上他內部怎麼運作的對用的人也不需要了解，沒有依賴其他的程式可以適用在每一個地方的。</p><p>和這類元素同樣性質的Component我估且把他稱之為「通用組件」，可以是我們自製的表單元素、或者是一樣小型的組件。</p><p>這類型的「通用組件」如果還是使用「單向資料流」，就顯得有點脫褲子放屁、太過麻煩了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="case2-大組件">Case2. 大組件<a class="hash-link" href="#case2-大組件" title="Direct link to heading">​</a></h3><p>另一種情況是，我們製作Component最主要的原因不是為了reuse（可複用）的理由，單純是程式太長了。</p><p>假設有一個非常巨大的表單，並且有五個分頁，有500個欄位好了，在Vue實例的<code>data</code> 可能是長這樣：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">data</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">tableBody</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">value1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">value2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">value3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// ...以此類推共兩百個</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>wireframe來看大概是長這樣：</p><p><img loading="lazy" src="/assets/images/component_data_stream_1-414f2e90c60dc278fd91ad999ff6f65d.png" width="1474" height="974" class="img_ev3q"></p><p>可想而知這支程式鐵定是非常肥大，三五千行都是有可能的，為了可維護性大多工程師都會想把程式能抽出來就抽出來。</p><p>在這個我胡亂掰的例子當中，這五個頁籤基本上裡面的內容都是各自獨立不互相影響的，所以以我來說可能就會再把這五個頁籤再拆成五個Component，如下圖：</p><p><img loading="lazy" src="/assets/images/component_data_stream_2-28cde41761a2f9d14d81d362eccd885e.png" width="1474" height="974" class="img_ev3q"></p><p>雖然說五個頁籤各自獨立，但是當使用者點下「儲存按鈕」時還是需要將全部200個欄位的資料一起送出給後端，因此這兩百筆變數還是需要紀錄在父層當中才會比較好處理。</p><p>換句話說，<code>methods</code>、<code>computed</code>、<code>watch</code>等等的程式碼可以抽出來放到這各自五個Component，但是<code>data</code>的變數主控權必須放在父層，並使用雙向綁定來同步底下的五個子組件資料。</p><p>我舉的這個例子就是適用雙向綁定的第二種情境。</p><p>當然，比這更複雜的情境還是有的，比如說父子階層不止兩層、或者是不但組件大又同時有reuse的需求，這時候就有可能再尋求其他的方式，這些會在下一篇文章再做進一步的討論。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二在子組件中同步prop及父組件的綁定value">二、在子組件中同步prop及父組件的綁定value<a class="hash-link" href="#二在子組件中同步prop及父組件的綁定value" title="Direct link to heading">​</a></h2><p>如同本文第一個章節所說的，原生的Html表單元素預設就可以使用<code>v-model</code>，但除了原生的Html表單元素之外，開發者也是可以在自己開發的Component上自訂義<code>v-model</code>。</p><p>其原理相當簡單，<code>v-model</code>預設會對應「一組」名稱為<code>value</code>的「prop」以及<code>input</code>「事件」（或者說<code>emit</code>）。</p><p>舉例來說，原生的Html表單元素<code>input</code>可以這樣寫：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">:value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">inputValue</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">@input</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">onInput</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以改成<code>v-model</code>的寫法：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">v-model</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">inputValue</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>差別在於前者是「單向綁定」，而後者是「雙向綁定」。通常會採用前者是因為希望自訂定監聽事件，並且需要掌控在監聽事件當中再要做一些加工處理（可參考本系列文前一篇的單向傳遞資料流）。</p><p>以下將會用一個範例實作來討論相關應用的細節。</p><p>這裡實作了一個帶有文字提示的文字輸入框組件，Component命名為<code>autocomplete-input</code>，為方便解說所以其實並沒有將功能實作的非常完整。</p><p>成果如下圖：</p><p><img loading="lazy" alt="image-20200509145612340" src="/assets/images/image-20200509145612340-22b6eb9cb741dc2b4487e98d0cfa1b80.png" width="305" height="343" class="img_ev3q"></p><p>html如下：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">app</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  請輸入英文字母：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">autocomplete-input</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">v-model</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">inputText</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">:data</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">recoData</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">autocomplete-input</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Vue的主程式中宣告父層的行為：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> vm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Vue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">el</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'#app'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'autocomplete-input'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">recoData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'candy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'car'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'card'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'can'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'bakery'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'boring'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'band'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'country'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'drink'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'eye'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'fork'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'game'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'hospital'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'orange'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'restroom'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'sleep'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'talk'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'tree'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'yesterday'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'weather'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'zoo'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">inputText</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上的程式我們可以看到組件有一個<code>v-model</code>及一個<code>v-bind</code>的綁定資料。<code>v-model</code>雙向綁定的<code>inputText</code>是輸入框的輸入文字，而<code>v-bind</code>單向綁定的<code>recoData</code>是提示文字的所有英文單字組合，當輸入框輸入文字的時候組件就會使用<code>inputText</code>在<code>recoData</code>陣列中進行篩選符合的英文單子。</p><p>對於要使用這個Component的人來說，只需要把這幾行程式看懂即可使用，不過由於本文說明需要我們還是要把Component內部的程式碼攤出來看看（沒有耐心的人以下可以先跳過，有需要的話再回頭過來對照著看即可）。</p><p><code>autocomplete-input</code>組件程式：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">component</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'autocomplete-input'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">template</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;div class="autocomplete-input"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      v-model="syncValue"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      class="list"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      v-show="isShowRecoList"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;div</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        class="item"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-for="item in recoList"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        @click="selectRecoText(item)"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        {{item}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'value'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">computed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 子組件中同步value的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">syncValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">get</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'input'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 是否顯示提示選項</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">isShowRecoList</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">syncValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">recoList</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 提示選項</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">recoList</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">indexOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">syncValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">methods</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 選擇提示選項更新輸入文字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">selectRecoText</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">syncValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上為全部的程式碼了。</p><p>觀察這個範例的資料流，子組件<code>computed</code>中的<code>syncValue</code>是用來「同步」<code>props</code>中的<code>value</code>。</p><p>這裡我所說的「同步」詳細一點的解釋：子組件<code>syncValue</code>的值和父組件的<code>value</code>是雙向綁定的關係的，當父組件的<code>value</code>變動時，會透過<code>prop</code>傳入子組件，而子組件的<code>syncValue</code>變動時就會將值使用<code>emit</code>傳遞事件給父組件。</p><p>實作的方式就是用<code>computed</code>的<code>getter</code>、<code>setter</code>：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">computed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 子組件中同步value的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">syncValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">get</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'input'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ..略..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>操作說明、父組件值、子組件值整理成下表：</p><table><thead><tr><th>操作說明</th><th>[父層]<!-- --> value</th><th>[子組件]<!-- --> syncValue</th></tr></thead><tbody><tr><td>Step1.初始化</td><td>''</td><td>''</td></tr><tr><td>Step2.輸入文字'a'</td><td>'a'</td><td>'a'</td></tr><tr><td>Step3.點選提示框'car'</td><td>'car'</td><td>'car'</td></tr></tbody></table><p>顯而易見的，父子組件的值是完全同步的，也就是我們期待雙向綁定的結果。</p><p><a href="https://codepen.io/cdpqdnvr/pen/wvKPgEG" target="_blank" rel="noopener noreferrer">Codepen範例完整程式在此</a></p><p><strong>---- 相關補充分隔線 ----</strong></p><ol><li>自訂義v-model</li></ol><p>有個跟本文主題關係不大但是也是蠻重要的一件事，就是如果不想使用名稱為<code>value</code>的prop搭配<code>input</code>事件的話，Vue有提供一個叫做<code>model</code>的option可以使用，更多訊息請參考官網文件：</p><p><a href="https://cn.vuejs.org/v2/guide/components-custom-events.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84-v-model" target="_blank" rel="noopener noreferrer">Vue官網文件-自定義組件的v-model</a></p><ol><li><code>.sync</code></li></ol><p>截至我寫這篇文章（2020/5/9），Vue3.0還是處於beta版本，預計年中之後才會推出正式版。就目前所知Vue3.0將會把<code>.sync</code>給移除掉，會用<code>v-model</code>來做取代。由於我也還沒研究到這部份（不過我猜實作的邏輯應該還是一樣的只是語法有調整而已），所以可能到時候再回頭過來修改本文。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三雙向綁定加單向資料流">三、雙向綁定加單向資料流<a class="hash-link" href="#三雙向綁定加單向資料流" title="Direct link to heading">​</a></h2><p>這個標題下的看似有些矛盾，不過這個情境在實作上是非常常見的。雖然說父層使用<code>v-model</code>雙向綁定，但是組件中實際上是單向資料流；也就是說和本系列文前一篇文章中介紹的單向資料流類似，組件內自己本身也管理了內部的狀態，只有在特定的事件將中才會將值傳遞給父層。</p><p>直接使用範例來做說明。</p><p>前一個章節的範例來做一點小小的修改；有一種和這種文字輸入提示框非常相近的一種UI，他同樣有文字篩選的功能，但他篩選的目的不是做為文字輸入的提示，而是這種UI本身就是下拉選單，文字篩選的目的只是用來「查詢選單中既有的選項」。換句話說，這個組件所綁定的值只有在「點選選項」之後才會把選項中的值帶入，如果沒有「點選選項」這個動作的話，輸入文字的值是會被捨棄掉的。</p><p>操作畫面如下，初始化面可看到這個UI類似於一般的文字輸入框，但也有下拉選單的箭頭icon：</p><p><img loading="lazy" alt="image-20200509161722966" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUsAAABLCAIAAAB2ojJ9AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAABS6ADAAQAAAABAAAASwAAAABrWdFaAAAQPklEQVR4Ae3dc7BlxxYG8MxkYhsvtm29WJWkYpsVVFyxM7Ft23oxXmzbtm2835tV1bXnnDtI5WbvOzdr/3Gqd+/W/s75eqG71+nxxx9/DJZXIpAIdFMEenbT98rXSgQSgf8jkAzP30Ei0J0RSIZ352833y0RSIbnbyAR6M4I9Gp/uR122GGkkUbaa6+9PPr999+jwCabbDLVVFN5FLc9e/Z89dVXL7root12223wwQd/6qmn7rzzzni06KKL3nbbbZGecsopl1xyyUj37t176KGH3nHHHe+444577703Mqufa6211qSTTlrNyXQikAj8RQRaZfjPP/8899xzH3744T/++OOvv/6KvXGdeeaZO+20U6QXW2wxvfbo0ePss89eZZVVvv/++wceeOCCCy7o1avXiSeeeP/992+77bZDDTXUY489dskll5Txffzxx59++qnb//a5Pvjgg3POOUeVvffee7jhhjvhhBPeeuutUjgTiUAi0CkI9CXD33777QknnDDaHWaYYbAXDzFTDtlLIJPk0lGGvEXsZZZZ5sorr5Sp5F133eUzqt9yyy0YO8MMM7j95ptv3n333c8++8xc8NJLL8lRd5pppjEFmE3czjfffKeeempUzM9EIBHoRAR6VNfDf/vtty+//LK0juTYe9RRR8l55ZVX3I433njSp5xyymyzzfbEE0988cUXZD7C4zbBTBr/8MMPFPhZZpnlySefpJOPMsooY445JvG++eab47m6bqnr5513nvR33333+OOPzz///NIuHc0666yRLp8ffvjhEksswTpYd911S2YmEoFEYCAR6EuGU8KPOOKI448/PipffvnlI444It66PfTQQzF5tdVWk37//feR87TTTkPyBx98cLvttqPS33jjjUxxDD/22GOJ7plmmmmEEUaYeOKJmegMbNfWW2897LDDHnzwwZSCYDvBjuHLL7+8NkcdddR2esvnCEDyKO82r0QgEfhTCPTFcDV5zrbaaqto4oUXXmBpR5rsxd5yO/vsszO5edRWXHFFCjwektI33XQTDq+//vrTTTedGeHCCy9kq0f18qkk8/6jjz6SE2Z5pH/66adSppoYd9xxo0A1M9OJQCIwkAj0paWrs+eeex5zzDFRmZlNzT7ooINa2pIz/PDDE61TTDEFSb7yyitzqu+6665kspI0+a+++orUlVhuueW40KI6GX7fffdR9anlbHKZdIHrr78+bHu3Cy+88Oqrrx6F8zMRSAQ6BYFWhrPD+cOi6bHHHvuZZ56hb3N6Rw7ekvCffPLJ6KOPfvLJJ5Pb8hdccMFrrrkGaY877rhvv/0W1R966KHdd9+dhKfkjzbaaGx4qrtGLMIdffTRTPc333yTsrD//vtTzun2XG4s7emnn77Y5J3ybtlIIpAItGrpGFhWs7m+hhxySBhdffXVgRRyFsg222yzTTfddJ999iGxDzjgACo9s1x5st0U4Npmm20UPuuss8hqtjfjnM98pZVWevTRR2MS+fzzzynhSo4zzjjccnPOOWdpvCSYBrqgJrALSmYmEoFEYCARaGU4eYuHrOs11liDq5wQ5jDbfvvtozlkpldHmo3tYnvvsssuBPW8885Lkj///PO07ssuuwxpeb+57ljm/+5z0dKjoimAp50uwMA2iYTZb3agoseEUh36G2+8waRnuifDq7BkOhEYSARaGa7aJJNMMscccyCt9IsvvkgzX2+99aK5qgyXY3faI488QpkfY4wxDjnkECq9Ze2lllrKpLDllltSwmUyvKNufGqNTk7JdxutRdqtCcK0Ui0sbdn8ueee45Nvyc/bRCARGBgEOmC4jWg2q7jUv/TSS/fYY4/Qt93SqFEu2r377rsXWWSRNddc075UzORXs7pGYnvKMrdIdvrpp9vfZhNrlGeoe2q1nECOnPjEc5nSLfmlTOmx5GQiEUgEBhKBVk+bhWtr3bHVjGS2//Sdd97hIaNac4YR6Vaw2cbMZnJeYeTnV9tiiy3kE91KRschn5W87rrruNxx/uWXX7b1dYMNNigjo9JPO+201s9o+yUzE4lAItCJCLQy/LXXXkNUq9/6wD0adRjAtrvF7lSu9cknn9xTFvL4449vY3mMholOwiO2kiqWIdrrao+6TW/Ir26VzF9//TVHuhW1UjgTiUAi0LkItDK8c1vP1hKBRKBZBFrPljU7muw9EUgEOheBZHjn4pmtJQJdC4G+fOms7q41uhxNItAlEejwlFSXHOlgfTHcEAehoXdNQHNU3R6BQUsQppbe7X+Q+YL/aASS4f/orz9fvtsjkAzv9l9xvuA/GoG/ynBbTatxoKSr213+FLT20pWNq7/88ouDqB1W14WSHT6qZjoGW1qr5v/ZtPA1rg5rVfNt+Kni0GH5zEwE6keg1dMWI3De02nQ/ozGTjX73gRmcUpcwEb7W8VL9YsXPUKmraxl+2o0gq4Rd3XmmWcWxa3asm1wjpHKueKKKzTL1WeOePrppx04cWhUvjPk1TNn8m2Ad/58iCGGqLbTkj7jjDPsxltggQVa8t06HisUdHv+xhtvHFv0IkBFFLjnnnu8UdldLzPO5Gjh4osvtmlfjs18ol85QussXXuzmZMINIhAxwwnjjqUSE6GOUwmGIvNp06Sib6IDAItOua96qqrYrvN6g6cCgXhbJn4MOXF7GNfaKGF7FF1OLyF4egd5HeY1HlVoZ0cRHGIlaCOfDxHciyK1rRvNrnqqqvmmmuu0r4pxh5YNCs5Ev/pc5Uc++rHGmsst3bXO6zuvJpXMONEAedYy45awSpCEzEYCbtubc6PYsqIS2f6EwBHjyeddJJjs6+//rpiJp0oE+mWOS4e5WcXQUDEfhGHBjgYX67D1AMs1pULdMzwf/W57DAvQ/fLRjyBHLAiBBqmEfW0U6GRkdlBUYUdUHFJHHbYYQK2OXMSLZCNDqWee+651TbjkcOncXbNYbUJJphAcAiTi2gQ9r07rxJlEEx4ZnxDKu3oTkIOaiESoep8G5EutpQoVDT8qFU+9S7Aa7l1Hsb7mTXMIwJIO8ceR1yLBHYe3oSifQ0qaXVEYcHnnJMxuWjHQTpzmUvaGz388MNC1ow88sjRhZAVkcjPLotA8Lb/JO8G9IZ/xwz3gCASj6l8Q1i08847l1sJ3EZCPHc5N0aGO4gSR8qWXnpp3Kuq1sqL3CRH4ffeew9tqk1JCxqBmSK9KWYqQXWZzrqIRSGhZSo0CW/icFg99HN9+WMWoWaCWsaDhM6rRajmaN9bSGy44YaOoKIxvUAjNBFWOskszOsNN9yA5yFv9S5BlWAv4K2nat16661CR/tBOEJHR8Bw+cZT4t7QCxj8YsjqyMgPPPBAnRZ1IIaRn10Qgf6TvHvQG+z9ZHh8JeKrSPifA+K3/UtCFfKWaBXFQTQIIt1PfJ111iEMhXNoEWUYIgybg2sUpIjKXG2QnBQXXUUMxBBCEoG1GQyPkkQ3amknvhv2wkQTTVQkJ3JG4SCbgVGkxXgWYIZ57y+ZNKKuGDX8BYZXesfnSAtfQRdQePHFF3c8nrUvX2HjcTZW2iNsNwZTzLLLLhu1tGxOYblQLsIsj/z87PoI9Ivk3YbevoIBMLz/XxJCEl+h3FJ9achkLBnY7gMjEp999lkHRYlx0o8qHrEiqu3jP3Wa+m2a4CFDLQyvFpA2CwgsQVtm2AsgVYLPtBRzKywUNVuIqLC9owDlf8YZZyT59913X/++QnoHUXVq5Pvtt18Uo7Bw9RkPpaC0rDwFIf5ZzVsLRBWPYu4w3dA+IsfkEpiUupnosgi0k7w70RvsA2A4iaoQBbjDbyj0cFzFRgWY4pFoL+yPE5wqD3OXl4ufTPSIKMa2D08VAYsYWEfOK09pJzwlyMY4r6689DzzzIPktIapp556sskmK32xqIWUKbfx/0p8gSUHvXnXaBwGTItmKZDeuC1Mjb7aZyXzS7VBHnWaRbSG4WaZSBukhM+wUKRNZyapeJqfXR+BKsm7Gb2BPwCGH3nkkfENiazY8lWxSHmweZVR1BIXgjGJ/eFRSzG3/O0ivfCuxyMKLeUfq9FVjulDI+jKmMc0zOTfirU6WrEEMheGK8/I55DnCWtRiVG06r1nctMUqjkxH2F4LHeZR3jFuevNSq54GiOMTw5Fk1HJMRJqSNwaMx8BkhszT6FM04fXif9UxfZYdSt1M9HFEQiSG2RJdPEBD/zwBsBw0RT71ZZVLgowkYvnGEJLtz5c5Fip5RGRK4gy8zUyWc4bbbSRv0/hspYm210eUW7RBj2EgkF1swZnWGknEnrxVyp6IYEFfuZ+s1AXj8xB1WnILEBQ0+pbWjA18MxzfZd876hTl0wrasF/T2+++ebbb7+9FCO3mf3l1sh5HMo/QJ1//vlFC9BUMrwANagkuh+3A/l+Mpye2bt375avh2ut5MT6mWISZJoEevCuMXTlcEErSZBaG+edaomFzJr1F8X+DgXJqe4oYQMJOY/YFAGWvKhP1157raY4vYJy9sxYlLKiTtO28kzTpkX7owUTAWFbldUxwva5JvKpYS0L8vK535RfYYUVrIqZaPTF5SbOZFQpn+Q8BMKD4NU4AmgEngpEGd0BgQ6C3hAotTKRCDSIQD8ZbkxVxZVA40zy0y/2J6XUZXnc5EdRJ6uV8UP3KxdxMdaNPWUqx/p5y0vyY1md4r6ihJOEdGbc42BTHV25r1jINp9xgImjjjD21Whq7bXXLmvsGGi/CjHL/revDtWjCxV5xXFPgy2dusXPoKg0lqqL0sQvIyKmEot5/qqpvWLJoTiEuKZiGK18g/fpXaz5gajD9y3VM5EI1IlAX3HaLFkVnrQMgp+JhuwHbUG7+gidmM0YiC30WJMCmcw/p9gANVXUClnHUC+6cbVxae2bLJQ0g+io5Wnc6hrlqvORGUfvBHKH5auZ7XWrT/uV5kszgzBSyisoSRNBb07+6kj61ULmD7oI9IcmXfCl+ifDq8Mlr1zVnEgXwlfpNzDUUr2osv2itzIdtt8yjNAXqplVz1w1vz3dXre9THsOn38swpVXUKZ9+muvmDmJQM0I5KJOzYBnd4lArQgkw2uFOztLBGpGIBleM+DZXSJQKwKtdjgvQq39Z2eJQCLwdyLQly/97+wo204EEoEGEEgtvQHQs8tEoDYEkuG1QZ0dJQINIJAMbwD07DIRqA2BZHhtUGdHiUADCCTDGwA9u0wEakMgGV4b1NlRItAAAsnwBkDPLhOB2hBIhtcGdXaUCDSAQDK8AdCzy0SgNgSS4bVBnR0lAg0gkAxvAPTsMhGoDYFkeG1QZ0eJQAMIJMMbAD27TARqQyAZXhvU2VEi0AACyfAGQM8uE4HaEEiG1wZ1dpQINIBAMrwB0LPLRKA2BJLhtUGdHSUCDSCQDG8A9OwyEagNgWR4bVBnR4lAAwgkwxsAPbtMBGpDIBleG9TZUSLQAALJ8AZAzy4TgdoQSIbXBnV2lAg0gEAyvAHQs8tEoDYEkuG1QZ0dJQINIJAMbwD07DIRqA2BZHhtUGdHiUADCCTDGwA9u0wEakPgf5RIrKXjgBKkAAAAAElFTkSuQmCC" width="331" height="75" class="img_ev3q"></p><p>使用者可以點選箭頭將選單展開、也可以點擊輸入框輸入文字以篩選選單。</p><p><img loading="lazy" alt="image-20200509161759261" src="/assets/images/image-20200509161759261-b607f76b8d98f6911db63fa1e5cb7185.png" width="298" height="333" class="img_ev3q"></p><p>點選選項之後，選項的值就會被帶入，如果沒有點選選項則操作是無法完成、並且文字也不會帶入上方的文字提示（您選擇的是「xx」）。</p><p><img loading="lazy" alt="image-20200509162014784" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAS0AAAA5CAIAAADsseqAAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAABLaADAAQAAAABAAAAOQAAAAA8moLzAAAMUElEQVR4Ae2dZYwcOxaFd8LMDAozMzMozAxS+IUUjkIKMyjMnFVYYeYNM78wM/OGcb+8q7Vquns6E5iehusfJZfL5bJP1fG5vm67/b59+/YvDYqAIhCsCIQI1qfrwxUBReA7AspD/Q4UgeBHIFTwVyFYa/Dhw4e3b9+aKkSJEiVkyJDmVCOKgGsQcMzD5cuXjxo1as+ePbdv3y5cuPDevXuTJEliU6ErV64sWrSoZ8+efLinTp3auXOnZChZsuS2bdskniZNmjJlykh80KBB4cKF69Kly44dOyhQEq3H+vXrp0iRQlIGDhz4/Pnz0aNHy+ns2bNXrVq1Zs0aa36JnzlzxmFpXC1YsGDGjBntb7GmTJ06tUOHDiZl69at1N+cakQRcA0CDuxS9IFPs1q1aqFCherevfudO3eGDBnylyWsXbuWyvn5+c2dO7dmzZrkP3DgwIIFC8g/efLk/fv3c3vYsGGPHTu2ZMkS04xHjx49efKE0//8E+7fvz9v3jxu6du3b8SIESdNmnTz5k2TecOGDWnTpjWn69ats56adCK7du2ihL/twuDBg7dv327N6TCOm6pUqVL//X8oWrSow2yaqAgEKQIO9JAv+OXLl23atJk/f/7SpUuHDx8OW75+/RoixHfS9uvXL1++fETQLuhXoUKFFStWcAqvoARHqe6WLVvgVebMmTnlI4fMT58+hbEXL16Ue9OnTw9RpSiEa/r06XIjMosoHTx4EEpMmzaNY9KkSVeuXNmoUaOZM2dKnlixYlWpUkXiHOPFi1eiRAlzKpGARNImG6e0LlKkSPbpmqIIuAwBWx7OmjUL9cuePfuJEycaNmyILpUtWxb7c8yYMYcPH4ZanTt3Ll++PPUjA6bjgAEDMFlhYP78+dGlbt26CV2JY4VGjx6dnNiTrVq1go3E0VIMVPJfunTpy5cvxYsXL1SoUNeuXePGjRs1alQyIKcUUr169cuXLyOSBDJHjhwZhi9btowMmMocrTx88OCBvclKItk0KAIegYA/HvLpN2vWDG68ePEiderU6GHo0KE3btwIYWjMw4cPYenx48djx47N6YwZM6AiwtWxY8f379+TjSHiu3fvxo8fjwxmzZoV8iRLloyhIwM/Qrt27SJEiDBs2DAMVOEkIklpwqgYMWLkyJFDICMilCtWrNirV6+gOr1A06ZN5Sry279/f4nLMVGiRJjH1hTiGKo2KYE/RZPHjRt37ty5nDlzlitXrkiRInIvfQQW8qFDh2LGjFm3bt2qVauSDibY1SCwePFi+i96MclMIYDToEGDwD9Xc/osAv54mCpVKkzNu3fv8jFBNjwWpPCdCTrwas6cORiB2bJlI4WhIP4YhpG4XrBaUbxNmzbBNAxIvCMjRoxYuHAhY0gbZMn5+fNnKE26DBcljt/SJqecXrhwAZpBY3OVEkycCFZr4sSJ6RSsicRJpBewSQzMKZZzrly56IxoyNGjRzGMwSRv3rxHjhwpUKBA8+bNScfopeEYCOTEAqcPCh8+PJTDYDaPwIGEUaA8NIBoxAkC/nhIPj44nKVyA9TC24nUIIykwDGsxMqVK6NgCRIkwPDjW4QAmJQYrj169EDfyIbiMbxE8fh8K1WqxC1SGkcGfnzBGKIYtJw+e/aMo8Q5oid16tQhBSEaOXIkESSlSZMmfM1ZsmSha8BYJRFxZkRH5OzZsyJ6chcpNoHhKGWiaSlTprS55OQU+aUPQnUxsLHMP378yJCYLgbW4Rxm8My9pGMLMGqFh5zSWMa69FlOitVLioATBL5/0A4D31/8+PF79+5tvQqvWrZsee3aNXjIRALfHxxAMVavXo1WTJgw4fXr1xASy61Xr16oJdNx3I65i7GKd5QR4NixYyn5xo0bfNNMTmD1Yc3yETPsTJgwoXmWDALhMymIDG7bGjVqUA6MQk5lig+6Sgdh7jp//vzjx4+ZaDEpRLB4f4qHu3fvpuuRUS6304+IWY7jCiMZ9aN/IYKAnzx5Uh5E56UktGKu8Z9FwAEP8WTiqMSPgjWIEdipUyeGdswEUjQKQDxdunTEmcho0aIFWgFbUAk4gESECRMGnYQMhPbt25MNU/bevXuMCRk04hdF0zD2UCouoYfwmZwQHqdOnjx5SCRQAXhLxIzxGjduzGRH7dq19+3b9+nTJ57CVdhCePPmTe7cuRFkykdFmfO099l8LzSAgMiLf8hcpznWHgFCCicZGVasWJFOB55DbMxUcwuSa+IaUQR+AQHb+UOIx1QEPT2GGb4KvtH169fDCjHAiGMoij4w9uMDxWDDjYGs4eApXbp0nDhxGEEhDowtyUmcD50MTCTiw5D6QVTKb9u2LSNDvC8MJhlwwmGEzkkD0CWIih8IIaJMkxMGIoxmdhF1ZS5EQq1atUy2gCJ0JZRgvUpR1onHKVOmYAWQASsd8ac7wEtE3FoH6+0aVwR+AQFbHmKVYXZiBEpZeAJxXTJxh6GIh5CRIaMy1FKu8ssYZAHPDbLGD1Ow2fr06YNowEC8HZideC8I1mrJUApTkyCzdhLniHErOW/duvXvfwJCau7FS4RniIkQBNBM96GrMpI0BmqGDBkQZwkoubk98JHWrVvjd6F/QXhxkCL4wmdEG+8xvcDVq1dxTW3evDnwZWpORcA5ArZ2KX4XNCpatGjI3fXr19GoTJkyoWB8f/g8+KEMIgnNMBEhJLPn9erVw5cDRfFqwlhRCYw3pitgL9+x+ZkY8/hcRUJtdI/hohh+Jh1LVeYtzK8CTBvIw7BTxnvEESgUm2dh8WJIY1LiYsHVafL/QgQfDB0Bs6bci7zTQPEDDR06FE8p9jPpeEEZBpvxob1b+Beeq7f4NAL8sMsa+NpwDJIi/T0qJAGM+CjRH4xS3J5kwFLF6UKEWTKxOckJGyWQmUAKhiKyxmwkJfAzUeuzYDKJWMLWRJQNDkgKTMaFI3GcNJRMgdxy+vRpErEneQROWuJcxZHLJYJUI3ny5OQnA1OUUsJPHel3KBOq29yFGHLJJtF6itXKhCqBXztQB+sljSsCASHgxwX5fO2PTCSihJKOSYb7RCYMJAW1ZI7OpKBF6BjiBlGtU3w4ePitKb+JQbiY3LdKB15HWCqjL/un26RQJoyicPwxYutCElghDiSTmTlJasKsOjXhFgKDT1NJky3oIvRN/ApCyseKFmdV0D1OS/YOBJzx0DtaqK1QBNwfAVs/jfvXWGuoCHgfAspD73un2iLPQ8CfvxSniOe1QGusCLgcAbMm4U892R8PKfSPP+BPVVTLUQTcBIGgkCu1S93k5Wo1fBoB5aFPv35tvJsgoDx0kxeh1fBpBJSHPv36tfFugoDy0E1ehFbDpxGw9Zf6NBjaeJ9BgH0hWMv6w+ayup0lBD/M9vsZVA9/H0MtwfMQgF1wzHm9XUZCqhEgD1lfz4JgNrZgTS0rMMjKFjIs9mU3GnYuNZtHsfSJ/WNIYesK563Sq4qAWyHgnIquJCGwOLZLWd8ECVk6yHoIltITYe08G0Cx/IJFT8xjsgSRDHCSnWYILFqXzTLcCmitjCLgHAGxOe0NVBeTkEo65iEL/FjENHHiRJY7sVcaO6yx6I6NvbmBVeqsvmddHyvu4SEp8JMdMZw3WK8qAu6JgD0VXU9CkHFsl7IElg0mICE52BwN6WOFPovr2SKJPZpY3sq+T2bhIpx0T4i1VopAYBCwGqjBQkIq6VgP2SqfXWpgmizbZckvGsimaWyHwU77bA8jShiYRmoeRcD9ERBVpJ4m4uI6O9ZDbFF2RmOPDJbM86dOCCAjRpaZ47ZBJNnDBj10cUX1cYpAkCIAA4OLhLTLMQ/Zw4I9y2TnXzYs5V+f2OKBHR/4Qxg2SmJjNdlvJkhx0cIVAd9BwN++GDhCbdY9sdcLnDRwsCUMwii7dJtEjSgCPoWAPU1+v/mO9dCUayUhiWy4pCQ04GhEEfhTCPyAh3/qMVqOIqAIOEFAeegEHL2kCLgIAeWhi4DWxygCThBQHjoBRy8pAi5CwHYePyj2wHFRU/QxioDHIuBv3sJjW6EVVwQ8GwG1Sz37/WntvQMB5aF3vEdthWcjoDz07PentfcOBJSH3vEetRWejYDy0LPfn9beOxBQHnrHe9RWeDYCykPPfn9ae+9AQHnoHe9RW+HZCCgPPfv9ae29AwHloXe8R22FZyOgPPTs96e19w4ElIfe8R61FZ6NwP8AgziDafxj7PAAAAAASUVORK5CYII=" width="301" height="57" class="img_ev3q"></p><p>我們將這個組件命名為<code>selector</code>，程式和前一個例子大同小異，不過這邊為方便說明還是將全部程式碼都貼上，如沒耐心可以先跳過這部份後面再對照著看即可。</p><p>html：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">app</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">v-if</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">inputText</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    您選擇的是「{{inputText}}」</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">v-else</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    請選擇：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">selector</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">v-model</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">inputText</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">:data</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">recoData</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">selector</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>父層的程式是一模一樣的：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> vm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Vue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">el</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'#app'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'selector'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">recoData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'candy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'car'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'card'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'can'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'bakery'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'boring'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'band'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'country'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'drink'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'eye'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'fork'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'game'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'hospital'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'orange'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'restroom'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'sleep'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'talk'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'tree'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'yesterday'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'weather'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'zoo'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">inputText</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>組件<code>selector</code>的程式就比較長一點了，同樣的沒耐心的話可以先跳過後面再回頭來對照著看：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">component</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'selector'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">template</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;div class="autocomplete-input"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      placeholder="可輸入英文字母查詢"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      v-model="childValue"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      @click="active"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      class="list"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      v-show="isShowRecoList"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;div</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        class="item"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-for="item in recoList"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        @click="selectRecoText(item)"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        {{item}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      class="triangle"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      @click="active"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'value'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">data</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">childValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 子組件中的輸入文字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">isActive</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 是否啟用提示文字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">computed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 子組件中同步value的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">syncValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">get</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'input'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 是否顯示提示選項</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">isShowRecoList</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isActive</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">recoList</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 提示選項</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">recoList</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">indexOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">methods</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 選擇選項</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">selectRecoText</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 選定後才將值更新回父層</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">syncValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 關閉提示選項</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isActive</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 啟用提示選單</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">active</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isActive</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isActive</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上為全部的程式碼了。</p><p>這邊是重點了，觀察這個範例的資料流，我們要關注的是組件內中的兩個值：</p><ol><li><code>computed</code>中的<code>syncValue</code></li><li><code>data</code>中的<code>childValue</code>。</li></ol><p>首先是<code>syncValue</code>，這個值和前一個章節中的寫法是一模一樣的，他的功用就是用來同步父組件所綁定的<code>value</code>：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">computed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 子組件中同步value的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">syncValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">get</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'input'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ..略..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是這裡有個關鍵的差異，在前一個範例當中<code>syncValue</code>是直接綁定在<code>input</code>輸入框上，所以當輸入框輸入文字的同時就會把輸入框的值回傳給父層。</p><p>但這個範例綁定<code>input</code>的值是接下來要介紹的<code>childValue</code>：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">text</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">placeholder</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">可輸入英文字母查詢</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">v-model</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">childValue</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">@click</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">active</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>會做這樣設計的原因，就是因為這個UI的設計是在使用者「點選選單」的時候才會把值回傳給父層，在「點選選單」之前輸入框裡面的值都不算數，他只會存在組件當中（也就是這個範例中的<code>childValue</code>），而父組件是不會知道使用者倒底在輸入框中輸入了什麼文字。</p><p>以程式上面來說明，首先，<code>childValue</code>預設必定為空值，所以直接將他放在<code>data</code>之中即可：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">data</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">childValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 子組件中的輸入文字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ... 略 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接著，根據這個UI的設計，當點選選單中的選項時，要把輸入框的文字回傳給父層。在這個組件中我們已經實作了同步父層的<code>syncValue</code>，所以就直接將<code>childValue</code>的值複製給<code>syncValue</code>就完成了：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">methods</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 選擇選項</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">selectRecoText</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 選定後才將值更新回父層</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">syncValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childValue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 關閉提示選項</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isActive</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ... 略 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果上述的說明還看的不太清楚的話，這裡同樣用本系列文當中不斷出現的表格說明，相信這邊看了就一目了然了：</p><table><thead><tr><th>操作說明</th><th>[父層]<!-- --> value</th><th>[子組件]<!-- --> syncValue</th><th>[子組件]<!-- --> childValue</th></tr></thead><tbody><tr><td>Step1.初始化</td><td>''</td><td>''</td><td>''</td></tr><tr><td>Step2.輸入文字'a'</td><td>''</td><td>''</td><td>'a'</td></tr><tr><td>Step3.點選選項'car'</td><td>'car'</td><td>'car'</td><td>'car'</td></tr></tbody></table><p>本範例的資料流設計和前一篇文章「Vue父子組件資料流設計 (1) 單向傳遞」的範例非常相像，本質上都是「單向資料流」。差異只在於為了實作雙向綁定，在子組件中多了一個使用computed getter/setter實作的<code>syncValue</code>，用來同步父組件的值。</p><p><a href="https://codepen.io/cdpqdnvr/pen/OJyOmGq" target="_blank" rel="noopener noreferrer">Codepen範例完整程式在此</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四小結">四、小結<a class="hash-link" href="#四小結" title="Direct link to heading">​</a></h2><p>依照我自己的學習歷程，開發Component時是先學習單向綁定，接著又寫code了一段時間，因工作需求上除了使用現成套件之外，有更近一步的需求需要自己開發一些基礎的通用組件，開始試著學習使用<code>.sync</code>（v2.x語法）以及<code>v-model</code>，但是一開始是土法鍊鋼，所以寫出來一些很奇怪又很多bug的程式，然後才慢慢掌握了一些比較良好的程式寫法（比如說本文用使用的computed getter/setter就是一個很好的方式）。</p><p>即使是熟悉了程式和相關技巧，但是也是累積了一些經驗才又把「單向資料流」以及「雙向資料流」這兩者的概念在腦中有清楚的分別。</p><p>我自認為前一篇文章和本文準備的範例程式應該都還不錯（自我感覺良好），只是因為程式也沒辦法濃縮的很短，寫得有點落落長，希望不會讓大家太難閱讀。</p>]]></content:encoded>
            <category>javascript</category>
            <category>vue</category>
        </item>
        <item>
            <title><![CDATA[Vue父子組件資料流設計 (3) 雙向綁定–大組件]]></title>
            <link>https://upstairs0102.github.io/blog/2020/05/09/vue-component-dataflow-3</link>
            <guid>2020/05/09/vue-component-dataflow-3</guid>
            <pubDate>Sat, 09 May 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[一、範例說明]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一範例說明">一、範例說明<a class="hash-link" href="#一範例說明" title="Direct link to heading">​</a></h2><p>本文是系列文當中討論「雙向綁定」的第二篇文章，在前一篇文章「Vue父子組件資料流設計 (2) 雙向綁定–通用組件」當中有介紹了兩種（我自己的經驗法則分類）會使用雙向綁定的組件類型：</p><ol><li>通用組件</li><li>大組件</li></ol><p>本篇文章將針對「大組件」的部份做討論。</p><p>前一篇文章有用一個「假想的大型表單」來做說明，本篇將延續此假想案例，實作一個簡單的範例來討論。</p><p>開始之前想簡單復習一下，當時的案例說明是這樣的：</p><blockquote><p>一種情況是，我們製作Component最主要的原因不是為了reuse（可複用）的理由，單純是程式太長了。</p><p>假設有一個非常巨大的表單，並且有五個分頁，有500個欄位好了…（略）…</p><p>可想而知這支程式鐵定是非常肥大，三五千行都是有可能的，為了可維護性大多工程師都會想把程式能抽出來就抽出來。</p><p>在這個我胡亂掰的例子當中，這五個頁籤基本上裡面的內容都是各自獨立不互相影響的，所以以我來說可能就會再把這五個頁籤再拆成五個Component</p></blockquote><p>假想圖如下圖：</p><p><img loading="lazy" src="/assets/images/component_data_stream_2-9025306-28cde41761a2f9d14d81d362eccd885e.png" width="1474" height="974" class="img_ev3q"></p><p>不過以範例來說，要做500個欄位太佔篇幅了，為方便解說，我實作的範例只有「兩個頁籤」「各5個欄位」。</p><p>畫面如下：</p><p><img loading="lazy" alt="image-20200509192624575" src="/assets/images/image-20200509192624575-abb95ca06807491550b98698ed774d52.png" width="276" height="416" class="img_ev3q"></p><p>父層主程式html結構如下：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">app</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 頁籤按鈕 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">@click</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">changeTab(</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">tab1</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">)</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      頁籤1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">@click</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">changeTab(</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">tab2</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">)</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      頁籤2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 表單內容 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">:is</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">currentTab</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">:tab-data</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">currentTabData</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 檢視JSON資料 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">hr</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">hr</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">表單JSON：</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">pre</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">{{form}}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">pre</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>本範例將製作兩個組件分別為兩個頁籤的內容，名稱為<code>tab1</code>及<code>tab2</code>。當點擊畫面中「頁籤1」按鈕，則切換為<code>tab1</code>，點擊「頁籤2」按鈕切換為<code>tab2</code>。</p><p>如同前面的案例說明，這整張表單的資料主要還是放在父層，並透過雙向綁定將<code>tab-data</code>傳入組件（<code>tab1</code>及<code>tab2</code>）內。</p><p>父層的主程式如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> vm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Vue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">el</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'#app'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 目前頁籤使用的component名稱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">currentTab</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'tab1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 表單資料</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">form</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 頁籤1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">tab1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column4</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column5</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 頁籤2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">tab2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column4</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">column5</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">computed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 目前的頁籤資資料</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">currentTabData</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">form</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentTab</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// tab1 or tab2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">methods</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 切換頁籤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">changeTab</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentTab</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上程式碼在後續說明都不會變了。</p><p>會有差異的就在於組件中要實作的方式，就如同本系列文章的精神都是依照我自己的經驗法則所整理的，以下將分為兩種實作方式來討論：</p><ol><li>傳參考給子組件</li><li>子組件使用computed的get/set同步prop</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二傳參考給子組件">二、傳參考給子組件<a class="hash-link" href="#二傳參考給子組件" title="Direct link to heading">​</a></h2><p>這個章節的標題我本來想下的是「有用但是不建議的做法」，不過後來文章結構的安排因素後來就放棄了。至於為什麼不建議，我後面會再做說明。</p><p>基本上這個章節要討論的就是利用Javascript傳參考(call by reference/pass by reference)的特性來傳值。</p><p>同樣的範例我在本系列文第一篇「Vue父子組件資料流設計 (1) 單向傳遞」當中也有使用過：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">number</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newObj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newObj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newObj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出101</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在這個範例中，概念上你可以把<code>add</code> function假想成Vue Component，當你透過綁定將值傳入組件之後，由於你傳入的值的型別是「傳參考」的話（也就是型別為物件或陣列），當組件中的prop的值被改變了，父層的值是有可能會跟著改變的。</p><p>在本系列文第一篇「Vue父子組件資料流設計 (1) 單向傳遞」，當中是建議子組件內可用深拷貝的方式複製一份存在組件內來管理。不過由於本文範例就是要實作雙向綁定，所以這邊反而是不會有問題的。</p><p>應用在這個範例當中，父層將<code>currentTabData</code>透過資料綁定傳送給組件，<code>currentTabData</code>也就是存在父層表單資料的<code>this.form.tab1</code>或<code>this.form.tab2</code>（依照頁籤的切換決定傳入哪一個）</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">computed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 目前的頁籤資資料</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">currentTabData</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">form</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentTab</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// tab1 or tab2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>組件的<code>prop</code> <code>tabData</code>取到值就直接綁定到表單欄位上了，程式碼如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">component</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'tab1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">template</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位1</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="tabData.column1"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位2</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="tabData.column2"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位3</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="tabData.column3"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位4</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="tabData.column4"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位5</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="tabData.column5"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'tabData'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// tab2 的程式碼完全相同所以就略過了</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>非常簡潔明了。</p><p>實際上這個做法我認為應該稱不上錯誤，必竟這只是Javascript本身的特性而已。但至於我仍然不推薦的原因有以下三點：</p><ol><li>在某些情況下還是有可能無法「回傳」給父組件（較正確說法是如果組件中使用「傳值」的方式來修改prop）。用一個先前也用過的一個範例來說明這種Javascript特性。</li></ol><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">number</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newObj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newObj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">number</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>程式維護性和可讀性上有些問題，畢竟綁定資料使用<code>v-bind</code> ，對維護程式的人可能不會意識到父子組件資料是連動的。</li><li>有更好的做法的情況下我不覺得有什麼原因非得要使用他。</li></ol><p>關於第三點「更好的做法」再下一個章節會進行討論。</p><p><a href="https://codepen.io/cdpqdnvr/pen/wvKjvEQ" target="_blank" rel="noopener noreferrer">Codepen範例完整程式在此</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三子組件使用computed的getset同步prop">三、子組件使用computed的get/set同步prop<a class="hash-link" href="#三子組件使用computed的getset同步prop" title="Direct link to heading">​</a></h2><p>關於computed的getter/setter寫法和概念上和前一篇文章「Vue父子組件資料流設計 (2) 雙向綁定–通用組件」是完全相同的，所以就不會花太多篇幅來說明，就直接續前面的範例來做修改。</p><p>首先將綁定資料的方式改為雙向綁定的<code>v-model</code>：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">:is</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">currentTab</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">v-model</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">currentTabData</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配合使用<code>v-model</code>，子組件也要改為搭配使用名稱為<code>value</code>的「prop」以及<code>input</code>「事件」（或者說<code>emit</code>）：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">component</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'tab1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">template</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位1</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="syncTabData.column1"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位2</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="syncTabData.column2"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位3</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="syncTabData.column3"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位4</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="syncTabData.column4"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      頁籤1欄位5</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">      &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        type="text"</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">        v-model="syncTabData.column5"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'value'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">computed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">syncTabData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">get</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'input'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// tab2 的程式碼完全相同所以就略過了</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>全部程式碼如上。</p><p>當中最大的差異就是前一個章節當中表單內直接使用<code>prop</code>來綁定資料，而這個範例在<code>computed</code>建了一個<code>syncTabData</code>來「同步」父組件的值：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">computed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">syncTabData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">get</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'input'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>換句話說，表單所有的欄位資料（包含頁籤1及頁籤2）全部都是放在父組件的，子組件中的「取用」和「寫入」都是直接對父組件，這樣一來在程式的維護性和可讀性都大大改善了。</p><p><a href="https://codepen.io/cdpqdnvr/pen/PoPeqdp" target="_blank" rel="noopener noreferrer">Codepen範例完整程式在此</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四更複雜的情境">四、更複雜的情境<a class="hash-link" href="#四更複雜的情境" title="Direct link to heading">​</a></h2><p>本文的範例其實是簡化了真實世界的情境，真實世界可能是這樣的：</p><p><img loading="lazy" alt="image-20200509224422176" src="/assets/images/image-20200509224422176-aace0b9e7fcb0c752e30d861a3e5b443.png" width="1582" height="1038" class="img_ev3q"></p><p>以這個範例來說，無論曾曾曾…孫組件傳到了第幾代，最下面那一層最終還是得雙向綁定到最上層的表單資料。</p><p>這種較大型的組件常常也伴隨一些特性是以上範例中沒有出現的：</p><ol><li><p>不一定只會有父與子兩層而已，有可能會是一個多層的、像樹一樣的巢狀結構，資料傳遞上隨著結構的複雜度提高，開發上也會變得異常複雜。</p><p><img loading="lazy" alt="VueJS 元件(Component) 之間資料溝通傳遞的方式| Kuro&amp;#39;s Blog" src="/assets/images/vue-instance-af8ff043147523b298835450bb0c7a7d.png" width="565" height="208" class="img_ev3q"></p></li><li><p>大型組件也可能有reuse（可複用）的需求，為了reuse的需求而導致子組件中必須將某些原本在內部管理即可的狀態，變成需由最外層的父組件來傳遞進去（比如說，假設某個組件是要打api的，原本的設計只要在組件內打api即可，但為了要讓另一個頁面也能使用該組件但是需打另外一支api，而改成將呼叫api的事件往父組件傳，由父組件打api），這樣的設計也會導致程式提升不必要的複雜度。</p></li></ol><p>為了避免題目變得太發散，後面的討論就當作補充，就不會寫得太深入了（我也寫不完了…）。</p><p>同樣又是經驗法則，就我自己有限的開發經驗來說我使用過這兩種解決方案：</p><ol><li>Vuex</li><li>Container Component (Smart/Dumb Component)</li></ol><p>這兩者其實是不同的東西，適用情況不同，當然也有可能是一起使用的。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vuex">Vuex<a class="hash-link" href="#vuex" title="Direct link to heading">​</a></h3><p>大家可以試著回想一開始學習Vue的時候，還沒有試著包裝太多Component之前，把整頁的程式碼寫在同一支Component的世界多麼美好（？）。</p><p>隨著Component切分的愈來愈細，程式碼雖然變短了，可是開發時間反而變長了，各種意想不到的問題也隨之出現（本系列文的各種經驗談也是我在這個過程當中摸索出來的）。</p><p>原本寫在同一支程式的變數，變成散落在各個組件之中，要不斷的props down/events up傳遞下去傳遞上來。</p><p>使用Vuex之後，你就可以將這種需要跨多層傳遞的變數統一交由Vuex來做管理。</p><p>不過關於Vuex本身議題過於龐大，以下示意圖就畫成一個方塊當成黑盒子即可。</p><p><img loading="lazy" alt="image-20200509223445726" src="/assets/images/image-20200509223445726-5830b526b74ed552a322e8988d5e536a.png" width="1018" height="454" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="container-component-smartdumb-component">Container Component (Smart/Dumb Component)<a class="hash-link" href="#container-component-smartdumb-component" title="Direct link to heading">​</a></h3><p>以本系列文的主題來說突然冒出來一個Container Component就稍微有點跳tone了，但是從某個角度來說他可以解決某些資料流設計上的問題。</p><p>Smart/Dumb Component是一個由Reat社群中在討論的一個設計模式，其簡單定義如下：</p><ul><li>Smart Component：依賴api或者其他狀態管理者（如Vuex），並會將資料傳遞給Dumb Component。</li><li>Dumb Component：單純的根據props來進行渲染。</li></ul><p>經過如此劃分之後，頁面中Component樹狀結構通常較上層的會是Smart Component，較下層的是Dumb Component。</p><p>在前述的討論中我們有提到一個問題點，也就是這裡所要解決的問題–<strong>「大型組件也可能有reuse（可複用）的需求」</strong>。</p><p>本系列經過這麼多範例的討論也要來到了尾聲了，我將組件類型區分為<strong>「通用組件」</strong>以及<strong>「大組件」</strong>，應該也不難觀察到如果用這個設計模式來區分，Smart Component只會是「大組件」不會是「通用組件」（「大組件」有可能會是Smart也有可能會是Dumb，但是「通用組件」只會是Dumb）。</p><p>重點來了。</p><p>一個同時是「Smart Component」他的<strong>「複用性」</strong>肯定就會較低。而如果同時是「Smart Component」又希望能「複用」的話，這個設計模式就提出來一個解決方式：</p><p><img loading="lazy" alt="image-20200509233716473" src="/assets/images/image-20200509233716473-b8a6041c6594da5452246a813b1e4533.png" width="958" height="546" class="img_ev3q"></p><p>將原本的Component拆分成「Smart Component」及「Dumb Component」的組合，Api或Vuex等的資料/狀態的依賴拆分到「Smart」的那一層，而「Smart」那層會是薄薄的一層就只處理資料的溝通，而內層的「Dumb」就只依照props的指令來進行渲染。</p><p>這樣的設計下外層薄薄的一層「Smart Component」就稱之為<strong>「Container Component」</strong>。這樣一來就能確保「Dumb」層的複用性，如果需要依賴不同的api或者不同的資料來源，就只需要將薄薄的一層「Container Component」給抽換掉即可。</p><p>這樣的設計下，也連帶的影響了資料流的設計，組件不需要為了屈就於「複用性」的需求，而將原本在內部就可以處理好的事情（相關的資料依賴）往外丟到父組件處理而增加父組件的複雜度，只要把（相關的資料依賴）放到薄薄的Container那層來管理即可。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="兩者的結合">兩者的結合<a class="hash-link" href="#兩者的結合" title="Direct link to heading">​</a></h3><p>最後的最後，沒有程式的範例，但是我試著用圖解來讓大家想像一下如果「Vuex」和「Container Component」應用在本文的範例中會是長什麼樣子。</p><p>如果本文的大型表單使用上了Vuex，會變成每一個組件都是直接跟Vuex溝通，不再需要傳遞到最外層來管理。</p><p><img loading="lazy" alt="image-20200510001327595" src="/assets/images/image-20200510001327595-829d0f977da983701a24734aace2197c.png" width="1306" height="614" class="img_ev3q"></p><p>那如果把Container Component也加進來大亂鬥呢？這時候奇妙的事情發生了，圖表原本的箭頭大幅度的減少剩下兩條了。</p><p>由於Container Component的概念加入區隔了「Smart Component」以及「Dumb Component」，依賴關係減少了，也增加了更多組件可複用性的可能！</p><p><img loading="lazy" alt="image-20200510001615508" src="/assets/images/image-20200510001615508-ad2312491209b45822eead36321692d5.png" width="1304" height="596" class="img_ev3q"></p><p>不知道到到了這邊會不會有人提問…</p><p>Container Component可以替換，可是Vuex是全域的啊？</p><p>這個嘛… 你知道Vuex也有模組化的功能嗎？（又一個坑）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五總結">五、總結<a class="hash-link" href="#五總結" title="Direct link to heading">​</a></h2><p>這個系列文章籌劃許久遲遲沒有動筆，動筆之後又前前後後用了很多天的青春，終於是寫完了。</p><p>看著鏡子中的自己，覺得面容又憔悴了不少（也太感性了吧）。</p><p>年中之後Vue3.0正式版就要發表了，雖然知道基本概念應該是不會變的，但也忍不住想說之後應該不會再像這次花這麼多時間來寫技術相關的文章了。好像也到了會思考要不要把更多的時間用在可以累積得更長遠的知識上面的年紀。</p><p>感性時間結束，寫了這系列前大半部只覺得累而已，可是到了最後覺得愈來愈有趣，差點就要發散到模組化設計的議題上面了，還好本系列主題就是定在「父子」組件的設計而已，其實最後一個小章節已經稍稍有點離題，還好我盡量濃縮在一個小章節裡把他給講完（我也不可能有力氣再寫下去了）。</p><p>寫的這麼落落長，技術的深度卻又這麼的「不深」，還真懷疑放到網路上是否真的有人會把他看完。大概只有公司裡的junior前端會被我強迫推銷而看完而已吧。</p><p>不過話說回來，講到Vue的學習（或者是前端開發）裡資料傳遞幾乎是我認為是所有的Vue知識裡Top 1最重要的一件事情（雖然說技術層面上不高），網路上卻好像也沒看過相關針對這個主題的深入討論（就算有我應該也沒耐心看吧哈哈）。導致於總覺得許多經驗不多的開發者（包括之前的我）都會用不太良好的方式來寫，所以這個就是我花這麼多時間的主要動機之一…</p><p>如果還真有我不認識的人把文章看完了，請讓我知道是否對你有任何幫助、或者有任何指教都非常歡迎！感謝！</p>]]></content:encoded>
            <category>javascript</category>
            <category>vue</category>
        </item>
        <item>
            <title><![CDATA[簡單看Javascript的傳值以及傳參考]]></title>
            <link>https://upstairs0102.github.io/blog/2020/02/28/js-call-by-reference</link>
            <guid>2020/02/28/js-call-by-reference</guid>
            <pubDate>Fri, 28 Feb 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[這是Javascript的一個經典的觀念題–「傳值」以及「傳參考」(call by value/call by reference，或者pass by value/pass by reference)，除此之外，也有人說Javascript是call by sharing（或者pass by sharing）。不過我自認我的程度還不到可以針對這些名詞做很深入的探討，但是可以用一個簡單的方式，將Javascript的這個語言特性做個整理。]]></description>
            <content:encoded><![CDATA[<p>這是Javascript的一個經典的觀念題–「傳值」以及「傳參考」(call by value/call by reference，或者pass by value/pass by reference)，除此之外，也有人說Javascript是call by sharing（或者pass by sharing）。不過我自認我的程度還不到可以針對這些名詞做很深入的探討，但是可以用一個簡單的方式，將Javascript的這個語言特性做個整理。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特性1拷貝純值">特性1：拷貝純值<a class="hash-link" href="#特性1拷貝純值" title="Direct link to heading">​</a></h2><p>Javascript的型別有分為「物件型別」以及「基本型別」(Primitive Type)，其中型本型別是屬於純值，包含是<code>string</code>、<code>number</code>、<code>boolean</code>、<code>null</code>、<code>undefined</code>，拷貝的時候是傳遞「值」(value)。</p><p>如下範例當呼叫了<code>add</code>函數時，將<code>x</code>傳遞給<code>newX</code>，很明顯當<code>newNumber</code>的值改變了並不會影響到<code>number</code>。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newX</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newNumber </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newNumber </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特性2共用物件">特性2：共用物件<a class="hash-link" href="#特性2共用物件" title="Direct link to heading">​</a></h2><p>將前一個範例稍做修改，變數<code>obj</code>是一個「物件型別」的變數，物件在傳值的時候傳遞「參考」(reference)。</p><p>如下範例，同樣也是將變數傳入<code>add</code>函式內，但是函式內的變數+1之後函式外的變數也跟著+1了。</p><p>這一個為人所知的特性，也是造成一個沒有良好javascript撰寫習慣下（或者對javascript還不那麼熟悉的工程師）很容易產生程式bug的原因。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">number</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newObj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newObj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newObj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出101</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特性3拷貝物件">特性3：拷貝物件<a class="hash-link" href="#特性3拷貝物件" title="Direct link to heading">​</a></h2><p>在前述的例子當中，將變數傳入函式等同於做了這件事情：<code>newObj = obj</code>。由於<code>obj</code>是物件型別，所以傳遞參考的情況下當newObj + 1之後obj也跟著加1了，我們也可以說obj被渲染了。這時候做個測試來觀察：<code>newObj === obj</code>結果會為<strong>true</strong>。</p><p>但是如果我們換個寫法：<code>newObj === { number: 100 }</code>結果卻為<strong>false</strong>。這個是為什麼呢？這個問題要解釋可能很難，但是不會很難理解。當我們將物件重新賦值的時候，就產生了一個新的參考，因此<code>obj</code>和<code>newObj</code>就不再是共用同樣的物件了。</p><p>這裡同樣將範例稍做修改：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">number</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newObj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newObj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">number</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這個範例中<code>newObj</code>如同上述所說是重新賦值，所以<code>obj</code>並不會被影響到。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="陣列也有同樣的傳參考特性">陣列也有同樣的傳參考特性<a class="hash-link" href="#陣列也有同樣的傳參考特性" title="Direct link to heading">​</a></h2><p>要注意的是，在Javascript當中陣列也是物件的一種型式，所以也同樣的call by reference/call by sharing特性。</p><blockquote><p>補充：typeof <!-- -->[1, 2, 3]<!-- --> 會印出"object"，javascript可沒有"array"這個型別，這也算是一個經典觀念題了。</p></blockquote><p>無論是使用Array物件提供的方法（如push、pop、splice等），或者直接透過索引修改欄位值，都同樣有傳參考的特性：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newArr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newArr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newArr</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">newArr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newArr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出[1, 2, 3, 4, 5]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果是直接賦值的話，就會產生新的參考，互不影響了：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newArr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newArr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出[1, 2, 3]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="需要非常小心call-by-reference造成的資料渲染bug">需要非常小心call by reference造成的資料渲染bug<a class="hash-link" href="#需要非常小心call-by-reference造成的資料渲染bug" title="Direct link to heading">​</a></h2><p>在我看別人的code的經驗，我覺得有不少人會喜歡刻意的利用call by reference的特性寫出一些花俏的程式碼，雖然這種寫法某些時候很好用或很有效率，但我個人是很討厭這樣的寫法，只要能想得出更好的方法就絕對避免。</p><p>一來是我會質疑這樣的寫法在程式閱讀性上有很大的問題；另外一來是只要一不注意，就會很容易發生會造成資料渲染的bug。只要是寫過javascript一段時間就一定會遇過這樣的bug，也就是在沒有意識的情況下資料不知道被誰給渲染了… 而且這樣的bug又非常難抓。</p><p>這裡舉一個簡單的例子：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> bigObj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">smallObj</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> obj </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 過了一兩百行…</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bigObj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出{ smallObj: { a: 2 }}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這裡將一個物件<code>{ small: obj }</code>賦值給變數<code>bigObj</code>，乍看下和前述的「特性3：拷貝物件」非常像，如果寫code時不是處於一個很專心的狀況下，有可能就認為這是一個傳值(value)的動作，不會有額外的side effect就直接帶過了。</p><p>但事實上這個物件<code>{ small: obj }</code>裡面的<code>obj</code>仍然有call by refence的關係，結果在一兩百行程式碼之外寫了一行<code>obj.a = 2</code>，這時候就是又要努力debug的時候了…</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="補充深拷貝的常用方法">補充：深拷貝的常用方法<a class="hash-link" href="#補充深拷貝的常用方法" title="Direct link to heading">​</a></h2><p>這時候就會延伸出來一個相關的問題，就像文章前面小節所說的，有時我們希望將某個物件傳值給另一個物件，可是又不希望是用「傳參考」的方式來傳值，而是用「傳值」的方式複製出一個一模一樣的物件，這就是所謂的「深拷貝」(Deep Clone)。</p><p>要來認真談論的話，這又是一個說來話長的主題了，而且有許多種方法都可以達到目的。以下我用最簡短的方式來介紹幾個實務上我覺得最常使用的幾種方式：</p><p><strong>1.產生新的物件並拷貝所有的「基本型別」欄位</strong></p><p>基本概念就是建立一個新的物件，然後再把裡面所有的「基本型別」欄位一個一個搬進去。同樣的概念有用多種做法，可以自己手動一個一個搬：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newObj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">b</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者是陣列方法：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newArr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以用ES6提供的新語法Object.assign：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newObj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">assing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但Object.assign只能複製一層的欄位，如果裡面某個欄位也是一個物件的話，仍然會有call by reference的問題。</p><p><strong>2.JSON stringify&amp;parse</strong></p><p>第二個方法是我認為最常使用且幾乎適用所有情況的方法（但不適用於function或者prototype–例如Date物件）。語法：<code>JSON.parse(JSON.stringify(物件))</code>。</p><p>例：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="結語">結語<a class="hash-link" href="#結語" title="Direct link to heading">​</a></h2><p>其實網路上相關的文章多的去了，相較起來我寫的這篇的深度並不深，背後的一些原理並沒有著墨的太多。不過我是有將一些相關的問題和解決方法，依照我自己的經驗做一些簡單的整理，希望對大家有幫助。</p><p>如果有想更深入的延伸閱多，以下有幾篇相關的好文推薦：</p><ul><li><a href="https://ithelp.ithome.com.tw/articles/10191057" target="_blank" rel="noopener noreferrer">重新認識 JavaScript: Day 05 JavaScript 是「傳值」或「傳址」？</a></li><li><a href="https://blog.techbridge.cc/2018/06/23/javascript-call-by-value-or-reference/" target="_blank" rel="noopener noreferrer">深入探討 JavaScript 中的參數傳遞：call by value 還是 reference？</a></li><li><a href="https://larry850806.github.io/2016/09/20/shallow-vs-deep-copy/" target="_blank" rel="noopener noreferrer">[Javascript] 關於 JS 中的淺拷貝和深拷貝</a></li></ul>]]></content:encoded>
            <category>javascript</category>
        </item>
        <item>
            <title><![CDATA[不需花錢將Gitbook(v2)架設在Gitlab Pages上]]></title>
            <link>https://upstairs0102.github.io/blog/2020/02/23/gitlab-pages-gitbook</link>
            <guid>2020/02/23/gitlab-pages-gitbook</guid>
            <pubDate>Sun, 23 Feb 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[gitbook是一個使用markdown文件就可以編譯成網頁的工具，非常適合拿來編寫電子書，也有需多工程師喜歡用來編輯技術文件，在一兩年前有一段時間好像非常流行，但是在gitbook的version 2.x版本之後有了重大的改版，gitbook帳號改為收費制（免費帳號功能有限）。]]></description>
            <content:encoded><![CDATA[<p>gitbook是一個使用markdown文件就可以編譯成網頁的工具，非常適合拿來編寫電子書，也有需多工程師喜歡用來編輯技術文件，在一兩年前有一段時間好像非常流行，但是在gitbook的version 2.x版本之後有了重大的改版，gitbook帳號改為收費制（免費帳號功能有限）。</p><p>雖然對一般人來說門檻變高了，但其實對工程師來說仍然是非常好用。因為gitbook雖然帳號收費，但仍然有開源的程式碼可用，對於有一些技術背景的工程師很容易就可以想辦法自己架設起來；基本上不需要寫任何的程式碼（除非要改source code），無一需要煩惱的事情就是<strong>該如何架設以</strong>及<strong>架設在什麼地方</strong>。</p><p>研究了一段時間發現Gitlab Pages是非常完美的架設靜態網站的服務，而且Gitlab官方就有提供<a href="https://gitlab.com/pages/gitbook" target="_blank" rel="noopener noreferrer">範例</a>，頁面上面也有簡易的教學，基本上就照著做也可以簡單的架設起來囉。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用gitlab-pages服務">使用Gitlab Pages服務<a class="hash-link" href="#使用gitlab-pages服務" title="Direct link to heading">​</a></h2><p>首先，當然就是要先有Gitlab帳號，Gitlab服務都是免費的，所以就是直接註冊使用就對了，這邊就不詳述。</p><p>建立一個Project之後至Setting把Pages服務開啟。在頁面中間可以取得網站的網址。</p><p><img loading="lazy" src="/assets/images/gitlab_pages_gitbook_1-518e0313e4d661b738013b3d31fa362b.png" width="509" height="285" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="在本機建立gitbook撰寫環境">在本機建立Gitbook撰寫環境<a class="hash-link" href="#在本機建立gitbook撰寫環境" title="Direct link to heading">​</a></h2><p>首先電腦中要有<a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">node.js</a>的環境，然後使用npm安裝Gitbook套件到電腦本機當中。</p><p><code>npm install gitbook-cli –g</code></p><p>在專案的資料夾中，下gitbook的指令初始化。</p><p><code>gitbook init</code></p><p>到這一步就幾乎完成了。</p><p>最後要做的一件事，就是建立Gitlab CI/CD的yml檔，這個yml檔可以讓我們把專案git push上去到gitlab server的時候透過yml檔的腳本、將gitbook打包成靜態網頁並部署到gitlab pages的空間。</p><p>簡而言之呢，就是要建立一個能夠幫我們部署網頁的檔案，而這個yml檔我們也不需煩惱該如何篩寫，gitlab官網上的<a href="https://gitlab.com/pages/gitbook/-/blob/master/.gitlab-ci.yml" target="_blank" rel="noopener noreferrer">範例</a>就有了，所以只要把範例中的程式碼整個複製起來，然後在根目錄建一個<code>.gitlab-ci.yml</code>則上去，完成（如果有不清楚的話請參考官網範例）。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="開始撰寫">開始撰寫<a class="hash-link" href="#開始撰寫" title="Direct link to heading">​</a></h2><p>gitbook使用一個SUMMARY.md檔來定義整個網站的目錄結構。</p><p>每一行就是一個頁面的設定，格式如<code>* [標題](markdown檔案路徑)</code>。而檔案路徑也就是對應你所撰寫的md檔。縮排4個空白即為子目錄。</p><p>以下範例：</p><p><img loading="lazy" src="/assets/images/gitlab_pages_gitbook_2-ff73989f290779d502e3bc884e608fc4.png" width="842" height="664" class="img_ev3q"></p><p>架設好的網站會長成這樣：</p><p><img loading="lazy" src="/assets/images/gitlab_pages_gitbook_3-19de20ca40ad2f6eb3b7e14debe7483f.png" width="1462" height="795" class="img_ev3q"></p><p>要在本機端測試網站打包出來的結果的話可以下指令：</p><p><code>gitbook serve</code></p><p>因為我們要使用Gitlab CI/CD，在前一個步驟裡已經建立了.gitlab-ci.yml檔，所以我們只需要使用git指令將專案push上去之後，等個幾分鐘，就可以看到架設好的gitbook網站了（在gitlab project選單setting/pages裡可取得網址）。</p><p>註：至於把檔案push上gitlab的git指令就不詳述了，不熟悉的朋友可參考在前述gitlab建立的project頁面，切至project首頁有相關的指令說明可參考喔！</p>]]></content:encoded>
            <category>gitbook</category>
            <category>gitlab pages</category>
        </item>
        <item>
            <title><![CDATA[前端PDF下載 | pdfmake自訂中文字型（使用NotoSansTC）]]></title>
            <link>https://upstairs0102.github.io/blog/2020/02/23/pdfmake-chinese-font</link>
            <guid>2020/02/23/pdfmake-chinese-font</guid>
            <pubDate>Sun, 23 Feb 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[工作上有需要在前端將內容生成PDF下載的功能，在同事的推薦下使用pdfmake這個套件。]]></description>
            <content:encoded><![CDATA[<p>工作上有需要在前端將內容生成PDF下載的功能，在同事的推薦下使用pdfmake這個套件。</p><p>不過這個套件有個問題，他的預設字型是英文字型，而且似乎也沒有提供api能夠直接替換成自己的字型檔。如果需要更換字型需要在source code做一些修改，然後重新打包出編譯過的字型檔；雖然網路上也有很多教學，但在我研究過程中還是踩到一些坑，所以就把我自己的實作步驟、以及使用方式整理了一下跟大家分享。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="凖備字型檔">凖備字型檔<a class="hash-link" href="#凖備字型檔" title="Direct link to heading">​</a></h2><p>在解說步驟之前呢，我先把我所遇到的坑說明一下。</p><p>因為擔心會有版權的問題，我是使用Google提供的開源字體「<a href="https://fonts.google.com/specimen/Noto+Sans+TC" target="_blank" rel="noopener noreferrer">思源黑體</a>」(NotoSansTc)。而我套用上去之後（在我文章後面所有步驟做完之後）PDF下載的結果如下：</p><p><img loading="lazy" src="/assets/images/pdfmake_3-5e909f5a4e403c1102fadace11132744.png" width="826" height="922" class="img_ev3q"></p><p>結果是慘不忍睹（因部份內容不方便展示所以有馬賽克，看起來也不太像是缺字。爬文之後懷疑是字體格式的問題。</p><p>Google提供的字體檔副檔名是.otf。於是我又上網找了副檔名是woff2（至於為何是用woff2而不是woff，是因為前者的size小一些）檔之後果然就正常了！</p><p>以下是我所找到的CDN檔案連結，請依所需下載，或者自行使用自己所需的字體檔案。</p><ul><li><p><strong>NotoSansTC-Thin</strong></p><ul><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Thin.woff" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Thin.woff</a></p></li><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Thin.woff2" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Thin.woff2</a></p></li></ul></li><li><p><strong>NotoSansTC-Light</strong></p><ul><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Light.woff" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Light.woff</a></p></li><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Light.woff2" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Light.woff2</a></p></li></ul></li><li><p><strong>NotoSansTC-Regular</strong></p><ul><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Regular.woff" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Regular.woff</a></p></li><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Regular.woff2" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Regular.woff2</a></p></li></ul></li><li><p><strong>NotoSansTC-Medium</strong></p><ul><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Medium.woff" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Medium.woff</a></p></li><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Medium.woff2" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Medium.woff2</a></p></li></ul></li><li><p><strong>NotoSansTC-Bold</strong></p><ul><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Bold.woff" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Bold.woff</a></p></li><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Bold.woff2" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Bold.woff2</a></p></li></ul></li><li><p><strong>NotoSansTC-Black</strong></p><ul><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Black.woff" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Black.woff</a></p></li><li><p><a href="http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Black.woff2" target="_blank" rel="noopener noreferrer">http://fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Black.woff2</a></p></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="打包字型檔">打包字型檔<a class="hash-link" href="#打包字型檔" title="Direct link to heading">​</a></h2><p>由於pdfmake不能直接載入字型檔，還需透過source code裡用gulp寫好的腳本來編譯成js檔。依照你是用npm安裝或者是直接到官網下載整包source code，做法會有些微差異。</p><p>至於要用哪種方式好呢？我是覺得其實都沒差，前者（方法1）的話是可以直接在開發專案裡就可以直接處理（到node_modules裡可找到source code），後者（方法2）的話是可以在獨立的環境中處理，建好字型檔後就可以把source code刪掉了。</p><p>所以下分開說明：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="方法1---npm安裝pdfmake">方法1 - npm安裝pdfmake：<a class="hash-link" href="#方法1---npm安裝pdfmake" title="Direct link to heading">​</a></h3><p>開發專案使用npm安裝pdfmake之後，到node_modules裡找到pdfmake資料夾，開啟gulpfile.js。</p><p><img loading="lazy" src="/assets/images/pdfmake_1-8521647b29229cac4e9f26780878d95c.png" width="233" height="214" class="img_ev3q"></p><p>然後找到如下圖的這一行。這個路徑是要放置字型檔的資料夾，但是npm安裝到node_modules裡面的檔案並沒有包含原始的字型檔、以及這個資料夾路徑，所以需要手動建立一個資料夾並放入要使用的字型（可放多個字型檔）到該資料夾裡，然後再把這個路徑改寫成自己建立的資料夾。</p><p><img loading="lazy" src="/assets/images/pdfmake_2-272257468f5b583643176065d016a7a2.png" width="535" height="250" class="img_ev3q"></p><p>接著在terminal中將路徑移動到pdfmake的根目錄（也就是和gulpfile.js所在的資料夾中）</p><p><code>cd node_modules/pdfmake</code></p><p>source code裡面包含package.json檔，所以直接下指令將所需套件安裝即可。</p><p><code>npm install</code></p><p>最後一步，用gulp打包字型檔。</p><p><code>gulp buildFonts</code></p><p>完成之後就會在「build」資料夾裡面打包出vfs_fonts.js，這個檔案就是pdfmake所要用的字型檔了。</p><p>最後一件要注意的事情，為方便維護、以及避免在node_modules更新的過程當中被覆蓋掉，我不建議僅將該檔案取代掉原始的程式，我會建議把vfs_fonts.js複製出來放到我們開發的專案資料夾當中，以我自己為例我是使用vue-cli開發的專案，我放在src/assets/fonts/資料夾當中。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="方法2---下載整包source-code">方法2 - 下載整包source code：<a class="hash-link" href="#方法2---下載整包source-code" title="Direct link to heading">​</a></h3><p>方法2和方法1幾乎是一樣了。我自己就是這樣做的，因為我不想在我目前開發中的專案去修改source code（雖然其實也不會有什麼影響），所以就到 <a href="https://github.com/bpampuch/pdfmake" target="_blank" rel="noopener noreferrer">Github</a>上將整包source code下載下來，然後在獨立的環境裡操作。</p><p>這包檔案比起方法1中用npm安裝，還會多了一個叫「examples」的資料夾。這個資料夾裡還有一個叫「fonts」的資料夾，裡面包含了pdfmake預設使用的字型檔，你應該會看到這些：</p><ul><li><p>Roboto-Italic.ttf</p></li><li><p>Roboto-Medium.ttf</p></li><li><p>Roboto-MediumItalic.ttf</p></li><li><p>Roboto-Regular.ttf</p></li></ul><p>由於打包時會把這個資料夾的字型檔全部一起打包。字型檔愈多、檔案就愈大，檔案愈大、前端網頁所要下載js chunk就愈大，如果用不到，全部刪掉即可！刪刪刪</p><p>然後把自己要用的字型檔放進去（可放多個字型檔）。</p><p>接下來步驟就和方法1當中所說的都一樣了：</p><p>將所需套件安裝。</p><p><code>npm install</code></p><p>最後一步，用gulp打包字型檔。</p><p><code>gulp buildFonts</code></p><p>完成之後就會在「build」資料夾裡面打包出vfs_fonts.js，這個檔案就是pdfmake所要用的字型檔了。</p><p>為方便維護、以及避免在node_modules更新的過程當中被覆蓋掉，我不建議僅將該檔案取代掉原始的程式，我會建議把vfs_fonts.js複製出來放到我們開發的專案資料夾當中，以我自己為例我是使用vue-cli開發的專案，我放在src/assets/fonts/資料夾當中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用方式">使用方式<a class="hash-link" href="#使用方式" title="Direct link to heading">​</a></h2><p>以下是我覺得比較需要注意的地方：</p><p><strong>1. 設定預設字體</strong></p><p>除非你修改source code（這就不太建議了，這樣用npm維護套件版本會有些問題），否則的話需要在參數上設定你所建立的預設字體。</p><p><strong>2. 獨立載入字體檔</strong></p><p>在前述的步驟中已經有提到了，我建議將所打包的字體檔vfs_fonts.js放到在開發專案的資料夾當中。一來是為方便維護、也避免在node_modules更新的過程當中被覆蓋掉。</p><p><strong>3. 字體檔(vfs_fonts.js)可使用動態載入</strong></p><p>如果是在js module當中直接import的話，webpack會把vfs_fonts.js和你的頁面程式打包成同一個js chunk，檔案size會非常驚人，會影響到載入頁面的效能。所以我會設計成在要開始下載pdf的時候才去下載vfs_fonts.js</p><p>根據上述三點，以下是程式範例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import pdfMake from 'pdfmake/build/pdfmake'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let data = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  content: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // pdf內容及格式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  styles: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 樣式設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  defaultStyle: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    font: 'NotoSansTC' // 預設的字體格式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 動態載入字體檔</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pdfMake.vfs = await import('@/assets/fonts/vfs_fonts.js')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pdfMake.fonts = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NotoSansTC: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    normal: 'NotoSansTC-Regular.woff2',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bold: 'NotoSansTC-Bold.woff2',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pdfMake.createPdf(data).download('檔案名稱')</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>javascript</category>
            <category>pdfmake</category>
        </item>
        <item>
            <title><![CDATA[(譯)Vue.js App 效能優化: part1 – 效能優化和lazy loading]]></title>
            <link>https://upstairs0102.github.io/blog/2019/12/24/vue-optimization1</link>
            <guid>2019/12/24/vue-optimization1</guid>
            <pubDate>Tue, 24 Dec 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[譯者說明]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="譯者說明">譯者說明<a class="hash-link" href="#譯者說明" title="Direct link to heading">​</a></h2><p>最近使用Vue.js投入公司產品開發花了不少心血，關於前端的效能是一件很重要的事情，這個系列文有做了一些有趣的探討，原文作者似乎也還沒寫完，我先從第一篇開始翻起，原文在此：</p><p><a href="https://itnext.io/vue-js-app-performance-optimization-part-1-introduction-to-performance-optimization-and-lazy-29e4ff101019" target="_blank" rel="noopener noreferrer">https://itnext.io/vue-js-app-performance-optimization-part-1-introduction-to-performance-optimization-and-lazy-29e4ff101019</a></p><hr><p>當行動優先導向成為標準、並且不確定性的網路環境也成為我們必須考慮的因素時，讓應用程式保持高速成為越來越困難的事情。在這個系列當中我會挖掘更深的Vue優化技術 – 我們在Vue Storefront當中所使用的技術，而你也可以用在你的Vue.js應用程式當中來讓他們瞬間讀取並且表現得平滑。我的目的是在這系列中對於Vue.js應用程式效能給出一個完整的指南。</p><ul><li>Part 1 – 介紹效能優化及lazy loading</li><li>Part 2 – Lazy loading路由及第三方庫的反向模式(anti-pattern)</li><li>Part 3 – Lazy loading Vuex模組</li><li>Part 4 – Lazy loading單一Component</li><li>Part 5 – Lazy loading函式庫和尋找最小集合</li><li>Part 6 – 使用Service Worker cache</li><li>Part 7 – 預讀取</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="webpack打包如何運作">Webpack打包如何運作？<a class="hash-link" href="#webpack打包如何運作" title="Direct link to heading">​</a></h2><p>本系列中大部份的提示都是聚焦在使我們的js bundle更小。為了了解這是至關重要的，我們需要了解Webpack是如何把全部檔案打包來起的。</p><p>當Webpack打包所有資源時會產生依賴樹，這是一個連結所有我們使用import引入檔案的圖型。假設我們在Webpack config中使用main.js作為特定入口，他就會是整個依賴樹的根節點。那每一個import到該檔案底下的js module都會成為圖型當中的葉節點，並且每一個import進該葉節點的module也成為他的葉節點。</p><p>Wabpack使用這個依賴樹圖型偵測該納入打包輸出當中。打包出來會是一個包含所有依賴樹中的module的單一javascript檔案（或者多個，後面章節會寫）</p><p>我們可以把這個進程繪製成以下如圖：</p><p><img loading="lazy" src="/assets/images/20191224_1-25d04eb8b274474489b4a8676ec13007.png" width="1312" height="574" class="img_ev3q"></p><p>現在我們知道打包是如何運作的，很明顯的他會成長到專案內最大化的初始javascript打包檔案。檔案愈大代表使用者需花更多時間下載，也代表使用使用者更可能離開我們的網站。</p><p>簡而言之，大部份的情況下愈大的打包=愈少的用戶。</p><p>##Lazy loading</p><p>所以為了改進我們的應用程式，當我們需要增加功能時該如何減少打包檔案的大小？當案很簡單-lazy loading和程式碼切割。</p><p>從字面上來看lazy loading就是懶惰得只載入應用程式的一部份。另外一種說法就是-只載入我們真的需要的部份。程式碼切割只切割出這個載入的部份。</p><p><img loading="lazy" src="/assets/images/20191224_2-7b0b2d6fd399488afff13f36600d8415.png" width="1036" height="302" class="img_ev3q"></p><p>大部份的情況下當使用者進入網站時不需要javascript打包中的所有程式，就算我們有3個不同的路由位置而使用者無論如何都需要下載、解析、並執行打包程式-不論他們是否會需要用到。這是多麼浪費時間和力氣！</p><p>Lazy loading允許我們切割打包並提供所需要的部份，使用者不需要浪費時間下載及解析他們不需要的程式。要看網站實際上使用到的javascript程式我們可以到開發者工具-&gt;cmd+shift+p -&gt;輸入”coverage”-&gt;點擊”錄製”，接著我們應該可以看到下載了多少實際上使用到的程式。</p><p><img loading="lazy" src="/assets/images/20191224_3-a5c6faab8499555c692675c06c6f0e4c.png" width="2000" height="843" class="img_ev3q"></p><p>每一個被標成紅色的就是目前路由裡不需要並可以被延遲載入的程式，如果你有用到source map那你可以點選清單裡任何沒有被引用到的檔案。從以上觀察可知甚至vuejs.org也有很大的進步空間^_^。</p><p>透過lazy loading特性的component和程式庫，我們砍掉了60%d Vue Storefront的打包檔案容量。</p><p>OK，我們現在知道lazy loading是什麼而且有多實用了^_^，現在我們來看他可以如何用在我們的Vue.js應用程式。</p><p>##Dynamic imports</p><p>透過webpack的dynamic imports可以很輕易的延遲載入部份程式，我們來看他是如何運作並且和一般的import有什麼不同。</p><p>如果我們使用一般的方式import JS module會像如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// main.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import ModuleA from './module_a.js'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ModuleA.doStuff()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>他會被加入到main.js的依賴樹中的葉節點並被打包進去。</p><p>但如果我們只有在特定情況下才會用到ModuleA呢（比如說使用者互動的事件）？在最一開始的時候就打包進去不是一個好主題。我們需要一個方式告訴我們的應用程式何時該下載這個部份的程式。</p><p>這也就是動態載入所能解決的問題！現在來看看以下例子：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//main.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const getModuleA = () =&gt; import('./module_a.js')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// invoked as a response to some user interaction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getModuleA()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.then({ doStuff } =&gt; doStuff())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>來快速看一下會發生什麼事：</p><p>我們寫一個function回傳import()函式以取代直接引入module_a.js。現在webpack動態import進來的部份程式，除非函式被呼叫否則程式不會被import並下載。之後這段程式將只會在特定的操作中被下載下來。</p><p>透過動態載入我們基本上隔離了特定的葉節點（在此例中為module_a），他會在我們決定載入的時候才加入依賴樹並下載（這暗示了我們同時也切割了module_a.js當中依賴的module）</p><p>我們來看另一個更好的例子來說明這個機制。假設我們有4個檔案：main.js、module_a.js、module_b.js、module_c.js，來了解動態載入是如何運作的，我們只需要main和module_a的原始碼：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//main.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import ModuleB from './mobile_b.js'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const getModuleA = () =&gt; import('./module_a.js')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getModuleA()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.then({ doStuff } =&gt; doStuff()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//module_a.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import ModuleC from './module_c.js'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>把module_a作為一個動態載入用的module可以切割掉依賴樹中的module_a和他的子節點。當module_a動態載入時會連同裡面import的檔案一起載入。換句話說，我們可以建置了一個新的依賴圖的進入點。</p><p><img loading="lazy" src="/assets/images/20191224_4-d8238d8017730cb26b1eba9a82fd0064.png" width="1276" height="808" class="img_ev3q"></p><p>這就是這個依賴圖和打包會長的樣子。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lazy-loading-vue-components">Lazy loading Vue components<a class="hash-link" href="#lazy-loading-vue-components" title="Direct link to heading">​</a></h2><p>我們現在知道lazy loading是什麼並且為何需要了，現在是時候來看我們可以如何在Vue應用程式當中使用。</p><p>好消息是，透過以上語法可以超級簡單的載入整個SFC（單文件Component-也就是.vue檔）、包含css和html。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const lazyComponent = () =&gt; import('Component.vue')</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>…只要這樣就搞定了！現在component只有在你呼叫他時才會載入。以下是最常使用動態載入Vue component的方法：</p><ul><li>把import寫成可呼叫的函式</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const lazyComponent = () =&gt; import('Component.vue')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lazyComponent()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>component被呼叫後渲染</li></ul><p>請注意lazyComponent函式只有在呼叫他時才會渲染進template。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;lazy-component /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const lazyComponent = () =&gt; import('Component.vue')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">components: { lazyComponent }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>例如：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;lazy-component v-if="false"&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這樣寫的話他是不會加入到dom當中的（但當v-if參數變為true時就會載入，這也是個不錯的方法）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="結語">結語<a class="hash-link" href="#結語" title="Direct link to heading">​</a></h2><p>Lazy loading是一個使你的網站更有效減少容量的好方法，我們學到如何在Vue component當中使用lazy loading。下一個篇文章我會告訴你如何使用vue-router和動態路由減少你的Vue應用程式容量。</p>]]></content:encoded>
            <category>vue</category>
            <category>javascript</category>
        </item>
        <item>
            <title><![CDATA[(譯)Vue.js App效能優化: part2 – Lazy loading路由及第三方庫打包反向模式(anti-pattern)]]></title>
            <link>https://upstairs0102.github.io/blog/2019/12/24/vue-optimization2</link>
            <guid>2019/12/24/vue-optimization2</guid>
            <pubDate>Tue, 24 Dec 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[在前一篇文章當中我們學到了什麼是切割程式碼、它是如何運作的以及在Vue.js應用程式中如何和lazy loading一起使用。現在我們將稍微深入一點的來看程式碼，並學習在Vue.js應用程式中最實用的程式碼切割的模式。]]></description>
            <content:encoded><![CDATA[<p>在前一篇文章當中我們學到了什麼是切割程式碼、它是如何運作的以及在Vue.js應用程式中如何和lazy loading一起使用。現在我們將稍微深入一點的來看程式碼，並學習在Vue.js應用程式中最實用的程式碼切割的模式。</p><p>這個系列是基於從<a href="https://github.com/DivanteLtd/vue-storefront" target="_blank" rel="noopener noreferrer">Vue Storefront</a>的效能優化處理中所學到的。透過以下的技術我們可以砍掉我們最初的打包的70%，使他載入在一眨間就完成。</p><ul><li>Part 1 – 介紹效能優化及lazy loading</li><li>Part 2 – Lazy loading路由及第三方庫的反向模式(anti-pattern)</li><li>Part 3 – Lazy loading Vuex模組</li><li>Part 4 – Lazy loading單一Component</li><li>Part 5 – Lazy loading函式庫和尋找最小集合</li><li>Part 6 – 使用Service Worker cache</li><li>Part 7 – 預讀取</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="成長中的應用程式的問題">成長中的應用程式的問題<a class="hash-link" href="#成長中的應用程式的問題" title="Direct link to heading">​</a></h2><p>Vue-router是一個可以切割我們的網頁應用程式成為各別頁面。各自的頁面對應到特定的URL路徑。</p><p>有了這個想像之後我們有以下一個簡單的作品集程式架構：</p><p><img loading="lazy" src="/assets/images/20191224_5-fe8d4e007840b8e0469839f4a293665a.png" width="1200" height="687" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/20191224_6-7bb1db70f51729375629d561fe21eb29.png" width="912" height="630" class="img_ev3q"></p><p>你可能會注意到我們還不需要app.js打包中依賴的Home.vue和About.vue(以及其依賴的lodash)、並且無論使用者訪問哪個路由都會把他們下載下來。這很浪費下載流量而且浪費時間！</p><p>如果只是多下載一個程式這沒什麼大不了的，但你可以想如果這個程式成長得愈來愈大，每一個額外增長代表在初次訪問時需下載更大的打包。</p><p>就算只有1秒的時間是足以讓使用者分心並有可能離開我們的網站，這是不能夠被接受的！</p><p><img loading="lazy" alt="關於性能及人類感知的演講投影片 (Ilya Grigorik)" src="/assets/images/20191224_7-ba46381c3be9bf51fc0d67c2bef25de6.png" width="1446" height="926" class="img_ev3q"></p><p>圖：關於性能及人類感知的演講投影片 (Ilya Grigorik)
<a href="https://www.youtube.com/watch?v=7ubJzEi3HuA" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=7ubJzEi3HuA</a></p><p>##使用vue-router以路由為基準的程式碼切割</p><p>為解決決這個情況 ，我們只需要使用前一篇文章學到的import語法、根據每個路由來切割打包。</p><p>就像Vue.js裡其他的任何東西 – 超級簡單。要取代掉直接地import component到路由物件裡，我們只需要貼上動態import的function就可以了。Component只有在路由要對應過去時才會被下載下來。</p><p>所以取代像這樣子直接載入路由component：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import RouteComponent form './RouteComponent.vue'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const routes = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  { path: /foo', component: RouteComponent }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我們需要在這個路由上的入口處加入能產生新的打包的動態import。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const routes = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  { path: /foo', component: () =&gt; import('./RouteComponent.vue') }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>來看這個動態import的打包和路由長什麼樣子：</p><ul><li>app.js – 在每個路由中都需要的主要的app入口處打包(main.js)及函式庫/component。</li><li>home.js – 首頁的打包，只有在路由進入時才會下載下來。</li><li>about.js – 「關於」頁面（及他的依賴lodash），只有在路由進入時才會下載下來。</li></ul><p>*打包名稱並不是戴正由webpack產生出來的而是為了方便理解而已。Webpack實際產生出來的名稱會像是0js 1.js，要依據你的webpack config設定而定。</p><p>這個技巧對幾乎所有的應用程式都是足以應付、都能有非常好的效果。</p><p>基於路由的程式碼切割在許多場合都能夠解決所有你的效能問題，幾乎所有的應用程式都能使用而且只花不到幾分鐘的時間就能實作！</p><p>##Vue生態體系中的程式碼切割</p><p>你可能會使用Nuxt或vue-cli來建置你的應用程式。這種情況就需要知道這兩者關於程式碼切割的自訂行為。</p><ul><li><strong>在vue-cli 3</strong> 所有的lazy loading模塊都預設是預加載(prefetch)的。我們稍後會學習預加載的使用。如果你希望知道更多關於vue-cli的預加載可以參考這邊。</li><li><strong>在Nuxt</strong> 如果使用Nuxt的路由系統，則所有的頁面路由都是程式切割的開箱即用。</li></ul><p>現在來看看非常給力且常見的反向模式(anti-pattern)可以帶給你的路由為基準的程式碼切割更厲害一些。</p><p>##函式庫打包反向模式</p><p>函式庫打包(vendor bundle)非常常見使用node_modules把全部各自獨立的js檔案全部納入。</p><p>僅管這個方法把全部的依賴放進同一個地方很吸引人，但這依然有綁住所有路由在一起的問題。</p><p><img loading="lazy" src="/assets/images/20191224_8-972475c7dc7f88c38019f75e373e310c.png" width="1470" height="842" class="img_ev3q"></p><p>你看到問題了嗎？僅管我們只有在其中一個路由當中需要lodash（是當中的依賴），vendor.js綁定了全部的依賴所以無論如果他一定會被下載。</p><p>在同一個檔案綁定全部的依賴聽起來很誘人但也會導致你的應用程式會一次讀取全部的檔案。我們有更好的方法！</p><p>維持我們剛剛使用基於路由的程式碼切割足以確保只有需要時才下載，但這會導致一些程式碼的重覆。</p><p>我們假設Home.vue也需要lodash。</p><p><img loading="lazy" src="/assets/images/20191224_9-b90fac8c99673b336dcc7ae3b5f70c3c.png" width="1600" height="921" class="img_ev3q"></p><p>這個情況下從 /aboug (About.vue) 導向到 / (Home.vue) 會導致lodash下載了兩次。</p><p>這仍然比下載了一堆多餘的程式碼還要來的好，但如果我們已經有了這些依賴而不重覆利用是很沒意義的沒錯吧？</p><p>這也就是webpack <a href="https://webpack.js.org/plugins/split-chunks-plugin/" target="_blank" rel="noopener noreferrer">splitChunksPlugin</a>也以幫助我們的地方。只要在webpack config當中增加幾行，我們就可以把分散的打包中常用的依賴給聚起來，使他們可以被分享。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// webpack.config.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optimization: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  splitChunks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chunks: 'all'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在模塊的屬性中我們只要告訴webpack哪個模塊程式應該被優化。設定這個屬性為all表示他應該優化所有的模塊。</p><p>你可以閱讀更多相關的處理 <a href="https://webpack.js.org/guides/code-splitting/#prevent-duplication" target="_blank" rel="noopener noreferrer">webpack docs</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="結語">結語<a class="hash-link" href="#結語" title="Direct link to heading">​</a></h2><p>透過路由切割你的程式是其中之一最棒（也最簡單）的方法來維持初始下載打包小的容量。下一個部份我們會學習關於其他較細的部份（Vuex stores以及獨立的component），從主要的打包中砍掉並延遲載入。</p>]]></content:encoded>
            <category>vue</category>
            <category>javascript</category>
        </item>
        <item>
            <title><![CDATA[(譯)Vue.js App效能優化: part3 – Lazy loading Vuex modules]]></title>
            <link>https://upstairs0102.github.io/blog/2019/12/24/vue-optimization3</link>
            <guid>2019/12/24/vue-optimization3</guid>
            <pubDate>Tue, 24 Dec 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[在前一個部份我們學到可以大幅度改善你的應用程式效能的模式 – 透過路由來切割程式碼。僅管透過路由切割程式碼是非常有幫助的但仍然有很多程式是使用者剛進去網站時使用不到的。在本篇我們將專注在我們的狀態管理的程式碼切割 – Vuex modules。]]></description>
            <content:encoded><![CDATA[<p>在前一個部份我們學到可以大幅度改善你的應用程式效能的模式 – 透過路由來切割程式碼。僅管透過路由切割程式碼是非常有幫助的但仍然有很多程式是使用者剛進去網站時使用不到的。在本篇我們將專注在我們的狀態管理的程式碼切割 – Vuex modules。</p><p>這個系列是基於從Vue Storefront的效能優化處理中所學到的。透過以下的技術我們可以砍掉我們最初的打包的70%，使他載入在一眨間就完成。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="兩種vuex-modules的類型">兩種Vuex modules的類型<a class="hash-link" href="#兩種vuex-modules的類型" title="Direct link to heading">​</a></h2><p>在我們繼續往下看Vuex modules的lazy loading之前，這裡有一件很重要的事你需要注意的。你需要了解有哪些可以注冊Vuex modules的方法以及他們的優缺點。</p><p><strong>靜態Vuex modules</strong>在store初始化時就宣告了。以下是個明確的建置靜態模組的範例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// store.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { userAccountModule } from './modules/userAccount'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const store = new Vuex.Store({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  modules: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: userAccountModule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的程式碼會new一個新的Vuex Store以及靜態模組userAccountModule。靜態模組不能被取消註冊（並且不能被延遲註冊）以及他們的架構（這是不是指state）在初始化後不能被改變。</p><p>僅管這個限制對於大部份的module來說不會是個問題，並且把全部的modules宣告在同一個地方對於讓資料的關聯在同一個地方維持一致是很好用的，但這個方法還是有些缺點。</p><p>假設我們的應用程式裡有一個管理者儀表板以及它專用的Vuex module。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// store.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { userAccountModule } from './modules/userAccount'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { adminModule } from './modules/admin'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const store = new Vuex.Store({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  modules: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: userAccountModule, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    admin: adminModule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>你可以想像這樣子的module可以是非常大的。即使儀表板只有限於一部份的使用者使用（也可想成只在特定的/admin路由），由於統一註冊了靜態Vuex module它所有的程式碼還是會在主要的打包程式當中。</p><p><img loading="lazy" src="/assets/images/20191224_10-0ef46651f88b430775940e517dac5706.png" width="1418" height="882" class="img_ev3q"></p><p>這個情況當然不是我們所要的結果，我們需要一個方法只在/admin路由當中讀取它。你可能已經猜到靜態module不能滿足我們的需求，全部的靜態module必須在Vuex Store被建置時被註冊、因此無法延後註冊的時機。</p><p>這也就是動態module幫的上忙的地方！</p><p>動態module和靜態的相反，它可以在Vuex store創建之後才註冊。這個聰明的特性暗示我們不需要在應用程式初始化時做動態載入，可以打包成不同的模塊或在需要的時候才延遲載入。</p><p>首先，我們來看前面所說的動態註冊admin module會長什麼樣子。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// store.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { userAccountModule } from './modules/userAccount'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { adminModule } from './modules/admin'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const store = new Vuex.Store({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  modules: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: userAccountModule, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">store.registerModule('admin', adminModule)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>取代直接把adminModule物件直接放入store裡的property，我們在store建置出來後使用registerModule方法註冊它。</p><p>動態註冊並不需要更改module本身，所以所有的Vuex module都可以直接註冊或動態的註冊。</p><p>當然，以目前這個寫法來說動態註冊module沒有給我們任何優勢。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="正確地切割vuex-module程式碼">正確地切割Vuex module程式碼<a class="hash-link" href="#正確地切割vuex-module程式碼" title="Direct link to heading">​</a></h2><p>延續前面的討論，現在我們知道如何動態地註冊admin module、所以我們當然可以試著把它放入/admin路由的綁定。</p><p>我們暫且停一下，來簡單理解一下我們的應用程式的運作方式。</p><p><img loading="lazy" src="/assets/images/20191224_11-3d3c1112f3240dc7c4bd8a559034f990.png" width="928" height="575" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// router.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import VueRouter from 'vue-router'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const Home = () =&gt; import('./Home.vue')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const Admin = () =&gt; import('./Admin.vue')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const routes = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  { path: '/', component: Home },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  { path: '/admin', component: Admin }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const router = new VueRouter({ routes }) </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我們來瞧瞧這裡做了什麼！</p><p>我們在Admin.vue(路由/admin)的mounted裡import並註冊admin store。稍後程式裡我們會在使用者離開的時候把module給取消註冊，以避免同樣的module被重覆註冊。</p><p>現在因為admin module被import到Admin.vue裡取代原本的store.js，它現在和程式切割了的Admin.vue綁定在一起。</p><p><img loading="lazy" src="/assets/images/20191224_12-a54ade4f419347f78b032be8e5132b93.png" width="911" height="577" class="img_ev3q"></p><blockquote><p><strong>重要注意：</strong>如果你使用SSR模式請確保你把註冊module放在mounted裡，否則的話當beforeDestory鈎子沒設好可能會導致memory leak。</p></blockquote><p>現在我們知道如何使用動態Vuex module註冊，來分開我們特定路由的module到適當的打包中。我們來看看稍微複雜一點的使用方式。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lazy-loading-vuex-modules">Lazy loading Vuex modules<a class="hash-link" href="#lazy-loading-vuex-modules" title="Direct link to heading">​</a></h2><p>假設我們有的Home.vue有一個推薦區塊，我們希望能展示關於我們服務的正面意見。因為數量會很多所以我們不需要在使用者進入後就馬上呈現，比較好的展示方式是當使用者看的時候。我們可以增加一個”檢視推薦”按鈕當點擊時我們才把推薦內容給呈現出來。</p><p><img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABJ8AAABYCAIAAADUTcE5AAAJ4UlEQVR42u3d+W+b9R3Acf5Q2CiH+kulCqH9gqYpQytqEbBpK2WlB23DyBhJaVmpRg8CoYG0pXGhOXo5p5PUTtwctoP9xImn57DjHE0PoKjweunzA42vx5b44a3v832ep2oAAAA8+Z7yEwAAAKg7AAAA1B0AAADqDgAAAHUHAACg7gAAAFB3AAAAqDsAAADUHQAAgLoDAABA3QEAAKDuAAAAUHcAAADqDgAAAHUHAACAugMAAOBnr7vt7U8b8wuO/3sBAEDdGXUHAADqTt0ZdQcAAOrOGHUHAADqzhh1BwAA6s6oOwAAUHfqzqg7AABQd8aoOwAAUHfGqDsAAFB3Rt0BAIC6U3dG3QEAgLozRt0BAIC6M0bdAQCAujPqDgAA1J26M+oOAADUnTHqDgAA1J0x6g4AANSdUXcAAKDu1J1RdwAAoO6MUXcAAKDu7jOvHL5yrC3V2tZ7+M1zv29+qH2kf2z2Wuv5Z3996fJa1+51X/bx/NR/7drd8gDP3JPqHp9Ld11tUXcAAKDuHig2uiZHllbWfG5QLd0e/SB+Qu9CpVarfX3phceTEz1z5S1+kPJc96O97T+ufX2nMNnT/0bjL8eGxmu1WqVw6TH3UvwFM2NH7/vM1pFMrVbLZo6qOwAAUHf3nzPZQvxZK9XSTGF6Pgjif1aKl5pqJHh8dTdbr7vm4Kz/d3Hui0d7242ltC89/MvU3eyD1l3cnw/yTHUHAADq7sO7UTjlpj5t/HFn19GbhUqltKbuui88v7396R1n//iXx3gqY7xs+JPkzZu3wpbLDL/1BJ04qu4AAEDdPei81NO9FH7OwvHjv1v30OErrzfX3ejEQH6psax3/UDHM41nnhobCarJAQdLMz39f05eOJMLlua/6X0xWSSczIT/vJo8euZOJqiW+q+/+UgnMe7vn5tr/ErF4vXGtsCXek4ML8wtxQ+sBKXSZM/gu2/f6FuMj3C5VKqUFpdKA+kDO7vO5JeCXO5s/MLObDYIZq6ND+SryULh7OylN88d6J9bfbeB9JHGMew4959MqVg/hGA6f7GxlS76uNLoVG+mVEleWp35sveF5kf7b8ZffNd3s7mgmvywteWgWEx/8tVzm9bdkYGvs+VK45kzC+n/XXxe3QEAgLqLE+XMYvRBuVznnqZgu9dGuEaHNE5oPJOdjf9SKk3nK/GjQV//q9vbn75wNzzn8+7UybjHslE1lZNTK3eNVFZqteBy6sWHr7sP47eqLZem5ieTbKtORcGZLEWGZ5mW5uPmXC5dPnp7uFYvtOgrBCPDB+OybXyRpq8ZrOZWPaXq+Rp0Xngu+t1OLSQPhaezxvm3vHi9panKGr9YsqcxOcJ1zbY/txI/LczOJCOrU0c2PPPlVCp5w8p8vpw88zFsyfN/LwAAPBl1F20DKzSnyFxxMp3tPdXbsi6xZudS750L18feGOhrtMqOc6eiOAz6r79aX5HLRg11o6X+zJVyXxwn9XSZOdJ4YT14Hqru4o2ChburG/C+L0QncA4fjLfSLS/2NR764Pa3g6Mfh7vsbsdnZh5sOgH1wsa6m51L7YsOqS3ap1dbKQ0M/yu+9sytH1ZPE+2cCY+hUuprSSL5VLzidzP6HeIqC8rjnyU/4/GF8MFk7+K6FbnWVGtTV78Xhesmz4x36+Wm2pquhTPQWCZVdwAAoO7C+Wzs1uJSsO6jG6csxmdmfv75tsZZkWGBVKf2dTyTXJikmGp6t/eizln89Py2sGrCQApzrjNcxwvmy0GUQNv/cO1auI433/3wl5fcNRGthRXn0zfyt4fy6XRu8E456a76AlcwPTd4MX3q2MXXt9jDtlndrX7NnV2dS2uP8MLq1VD2TlTXLzy2Z8KsLeTPrn5W0x6/aAPh5nW34+yBy5O38+VSUI3WDO/RgR2T4fvXlkujud7OweMHurbZdwcAAOpuq1venRv6JvNDvLkrOQtxwzUzo7aJ6i7Oj/J882Un90fnRi7Grx0oRhX03fsT1ZWVpaHDvZfiuxp8GrXQcPrgw9fd3mx1ZdPfKjN2cHv7ru/nimv+Wp2Jd/o9YN01vua6R9e+w97mFbZ4/j0WfqPi7Bebflbzm6853/JK92L9SINqaa40vXSPutvZdSJbWfPFg/J4+89/E0L/9wIAwJNYd03rY031ct+6W3tTgXh/XVJ38YpWsRjuTJvNnUy6aLmUr1RqtcUz57c9at1tdYeG3T3Hvhz9dmg22ZIXnyZaX087+DPVXXzHhfh2fA9ed/F6YKXQt69+cmbn3fK9VvnCS92kPrk8MTC+EEdgslSo7gAAQN2F18xcrJa+u3lkswtp3r/u6s9MWi4Kkuj6JdXxeC/Zy1cuJdvt6u+wenu9yvWWR7rxd/zHSrGv+eUfDX1zvrdlT+qL3qGPV5/c8flStLtvX8czcX0V8qd/irpLjiFeqUt+k6i3htNvPVTdJbd8qJ/DuePskUxl8313Hw19+1XfG003eNi4aqruAADgt113SX0tBzOFybH86J36Vf4b5bBF3TX6pLZSGs1duzGbi1/bFDbJpTJXgqE4xhq9V5g+vf2R6q7pmEtj+XS4Rhf9O5s52jpyJ7pg5vxYfvB69nZ8Dc/4tuxv34gvmxlMz4/dKZdupQ/+mLp7+UpyDJXi2LWpgXy8lLb5VTG3qrvTd2YbRxWuyK0t4TUdWFgOP648nc4N3siPxsuS2cwH6g4AANRdkmpXZiYWq2s/dSWYzHVuWiYb627DVrdgdOLE2mtyhoWWnWhc7DG5F0J814StJ76nQrShbl2Unl2981v8qZVwf92eVPfC2psZNN0K75Xm48yMJXXXuG7KhrqLr6qyoe7q53buHbja/LsFlfGT9RNNN54FukndJY/uulmoNH+L/Ma1u+iZ7WMjS2u33U3nu1tcVQUAANTdunmt653WVGtbqrWtd/8jvHx3z6FPBo+f7Ot499yzj+2Yd/ccaksdbu09tO5DX+t6py3VerKvdeOFJXf3HDp08Z8HvvrTT3Udmvf7Ok4P/vdE7+s/5n3+fqX9ZF9H8xU+7zV/u3ioLdV64urhPVveSULdAQDAb7fujFF3AACg7oy6AwAAdafujLoDAAB1Z4y6AwAAdWeMugMAAHVn1B0AAKg7dWfUHQAAqDtj1B0AAKg7Y9QdAACoO6PuAABA3ak7o+4AAEDdGaPuAABA3Rmj7gAAQN0ZdQcAAKg7o+4AAEDdGaPuAABA3Rmj7gAAQN0ZdQcAAKg7o+4AAEDdqTuj7gAA4FdUdwAAAKg7AAAA1B0AAADqDgAAQN0BAACg7gAAAFB3AAAAqDsAAAB1BwAAgLoDAABA3QEAAKDuAAAA1B0AAADqDgAAAHUHAACAugMAAFB3AAAAPHn+Dz+kCGnnWjsEAAAAAElFTkSuQmCC" width="1183" height="88" class="img_ev3q"></p><p>為儲存推薦資料我們需要再一個Vuex module命名為testimonials。這個module負責呈現前一個加入的推薦並新增一個新的，我們不需要知道關於它實作的細節。</p><p>我們希望testimonials module只有在使用者點擊按鈕的時候下載，因為在這之前並不需要它。我們來看這個動態import及註冊module的功能該如何實現。Testimonials.vue是Home.vue裡的一個子component。</p><p><img loading="lazy" src="/assets/images/20191224_13-1e344ac6eee17858ebfe44c291e27a2c.png" width="1502" height="1314" class="img_ev3q"></p><p>![](我們來快速檢視一下程式碼。</p><p>當使用者點擊「檢視推薦」按鈕時呼叫getTestimonials()方法，getTestimonialsModule()負責取得testimonials.js。當promise被resolved（代表module被讀取）我們動態地註冊它並dispatch action來取得推薦內容。</p><p>感謝動態import，testimonial.js的內容被綁定到分開的檔案中，只有當getTestimonialsModule方法被呼叫時才會被下載。)</p><p><img loading="lazy" src="/assets/images/20191224_14-d732690f37c31f176750bca8ddb70cc7.png" width="1600" height="817" class="img_ev3q"></p><p>當我們需要離開管理者平台，我們在剛才的beforeDestory生命週期鉤子裡有取消註冊，所以如果我們要再次進入路由它不會被重覆。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="總結">總結<a class="hash-link" href="#總結" title="Direct link to heading">​</a></h2><p>僅管理靜態Vuex module註冊足以應付大部份的使用情況，還是有些特定情況我們還是需要動態註冊。</p><ul><li><strong>如果只有在特定路由需要module</strong>，那我們可以在特定的路由component裡動態的註冊，所以不會出現在主要的打包當中。</li><li><strong>如果只有在特定的互動需要module</strong>，那我們需要在特定的方法中合併動態註冊module和動態import、延遲載入。</li></ul><p>切割Vuex module程式碼是一個強而有力的工具。在應用程式裡處理得愈多資料相關的操作，表示能節省愈多的打包容量。</p><p>在下一篇我們將學習如何延遲載入獨立的component，以及更重要的是哪個component應該被延遲載入。</p>]]></content:encoded>
            <category>vue</category>
            <category>javascript</category>
        </item>
        <item>
            <title><![CDATA[從D3.js的select(this)探討的函式中的this指向]]></title>
            <link>https://upstairs0102.github.io/blog/2019/12/22/d3js-select-this</link>
            <guid>2019/12/22/d3js-select-this</guid>
            <pubDate>Sun, 22 Dec 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[其實這個標題下的有點不太精確，但我想從我自己本身遇到的問題的角度來切入，然後再進一步深入說明…]]></description>
            <content:encoded><![CDATA[<p>其實這個標題下的有點不太精確，但我想從我自己本身遇到的問題的角度來切入，然後再進一步深入說明…</p><p>事情是這樣的，在函式中使用<code>d3.select(this)</code>可以取得調用此函式的dom，比如說有以下幾種情境範例：</p><p>1.事件</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'g'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'click'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// d3.select(this)取得點擊元素&lt;g&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">classed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'active'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>2.陣列迴圈</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'g'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">each</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> dom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// d3.select(this)取得元素&lt;g&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">attr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'transform'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'translate('</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">', 20)'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>3.動畫</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">transition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> dom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"body"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"div"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tween</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> inter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">interpolateRound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">inter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">html</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// d3.select(this) == dom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>到目前為止都沒有問題，後來因專案需求改為es6語法，所有的函式也都改為了<strong>箭頭函式</strong>，此時開始發生問題了，以上述的第一個範例來說會是長這個樣子：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'g'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'g'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'click'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">d</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// d3.select(this)取得對象發生錯誤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">classed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'active'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在這三個例子當中，原本this都會指向到<code>&lt;g&gt;</code>元素當中，可是當函式改寫成箭頭函式的時候this變成指向到<code>window</code>。</p><p>雖然我原本就約略知道javascript的某些規則，"function"和箭頭函式兩種寫法中使用this會指向到不同的地方，但是對此並沒有深入的去了解、以及對於d3.select(this)這個寫法的意義也不是很清楚。這個寫法原本是照著書上教學照著寫的，只知道要這樣寫但不知原因為何，知其然不知所以然，所以遇到問題也不知如何解決。</p><p>當我第一次遇到這個問題我還以為是踩到D3的坑，花了點時間研究後終於知道這完完全全是javascript本身的問題，並不是D3的特性造成，下面會進一步說明原因以及解決這個問題的解法。</p><h1>探究d3.select(this)原理</h1><p>要理解<code>d3.select(this)</code>的原理，<strong>其實就等同於理解javascript的this</strong>。我一開始會誤以為這是D3提供的特殊用法，就是因為對於javascript的this了解的不夠深入所致；所以這一章節要講的其實就是javascript而已，跟D3沒有半點關係了。</p><p>這裡主要是針對function () { ... }寫法、以及使用箭頭函式中使用<code>this</code> 兩種來做比較合說明。理解之後就會知道D3內使用this會有這樣的差異了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="function----內的this">function () { ... }內的this<a class="hash-link" href="#function----內的this" title="Direct link to heading">​</a></h2><p>這裡的this很容易誤解，<strong>this指向誰其實跟function是在哪裡宣告並沒有關係，this會指向的對象是依據調用此函式的物件是誰</strong>。</p><p>比如說，某function在window（全域）上宣告，而呼叫此function的人也是在window，function內的this也是在window（好像繞口令）。</p><p>我上面所講的也就是一個最簡單的情況，以一段簡單的程式來看會是長這樣子：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">word</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'hello world'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">say</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">word</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 印出 hello world</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">say</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但如果函式不變，但調用此函式的人是某物件，則this就會指向該物件，範例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">word</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'hello world'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">say</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">word</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> people </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">word</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'how are you'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">say</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> say</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">say</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出 hello world</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">people</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">say</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出 how are you</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同理，調用此函式的人為DOM，則this就會指向該DOM，範例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addBorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">border</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'1px solid red'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 點擊el調用addBorder，this會指向el，因此el會加上紅線</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> el </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'#element-id'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'click'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> addBorder</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>講到這裡<code>d3.select(this)</code>能取得DOM的原理就呼之欲出了，並不是D3做了什麼黑魔法，而是javascript的this原本就是會指向到<strong>調整此函式的物件</strong>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="箭頭函式中的this">箭頭函式中的this<a class="hash-link" href="#箭頭函式中的this" title="Direct link to heading">​</a></h2><p>Javascript推出新的節頭函式，幾乎大部份和原來的function沒有什麼不同，偏偏就是this指向的規則和原來不同。</p><p><strong>在箭頭函式中this指向宣告函式的物件，而非調用函式的物件</strong>。也就是說他在函式被宣告時this的指向就固定下來了，不會隨著使用的方式不同而改變指向的對象。</p><p>稍微修改前面的範例，原來的say()函式因為是在全域window上宣告的，所以無論由哪個物件調用this都是指向到window。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">word</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'hello world'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">say</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">word</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> people </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">word</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'how are you'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">say</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> say</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">say</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出 hello world</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">people</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">say</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 印出 hello world</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> 再來，延續前面的DOM事件範例，程式完全不變，只把function改成箭頭函式，此時就會報錯了，因為this指向的對象不再是調用此函式的DOM本身，而是指到window去了。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">addBorder</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">border</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'1px solid red'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 報錯，因為this指向window，window底下沒有style物件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> el </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'#element-id'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'click'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> addBorder</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>箭頭函式的問題解法</h1><p>爬文後我整理出三種解法，其中第一種用法是我個人的推薦用法，不過他只適用v4以上版本，如果使用v3以下版本就只能使解法二或解法三了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="解法一建議用法">解法一（建議用法）<a class="hash-link" href="#解法一建議用法" title="Direct link to heading">​</a></h2><p>這個解法可以完完全全的取代<code>d3.select(this)</code>而且程式意義上也十分合理，不過只有一件小小的但書就是只適用D3 v4以上的版本，v3是不支援的。</p><p>上述三個範例的函式當中，注入參數中的「第三個參數」就是「調用此函式的DOM的集合（陣列）」，透過函式中「第二個參數」也就是該調用任務中的陣列索引，就可以找到調用此函的DOM…</p><p>講起來有點饒舌，簡單講，假設這個陣列命名為<code>all</code>、索引為<code>i</code>，<code>all[i]</code>就會等同於我們尋尋覓覓的function中的<code>this</code>啦，而<code>d3.select(all[i])</code>也就等同於<code>d3.select(this)</code>。</p><p>直接用本文最一開始的三個範例重新用此解法來改寫：</p><p>1.事件</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'g'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'click'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> i</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> all</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">all</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// d3.select(all[i])取得點擊元素&lt;g&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">classed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'active'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>2.陣列迴圈</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'g'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">each</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> i</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> all</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> dom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">all</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// d3.select(all[i])取得元素&lt;g&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">attr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'transform'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'translate('</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">', 20)'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>3.動畫</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">transition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"body"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"div"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tween</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">d</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> i</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> all</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> inter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">interpolateRound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token parameter">t</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">inter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">all</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">html</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// d3.select(all[i]) == dom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="解法二">解法二<a class="hash-link" href="#解法二" title="Direct link to heading">​</a></h2><p>認真講起來其實這個方法真的還不錯，雖然聽起來好像有講和沒講好像一樣，那就是用原本的函式寫法function () { ... }，不要使用箭頭函式，謝謝觀賞（啊不是啦）</p><p>這還真可能真的是種簡單的解法，只是在某些情況下又沒辦法真的符合需求。</p><p>就我自己本身的例子，我的使用情境是在js的class（或者說是物件）當中使用d3，我希望this本身有其意義（我希望指向到class本身），如果函式使用function () { ... }那我就無法透過this指向到class本身。</p><p>就這種情況來說還是有一方式可解決，也就是在函式外面宣告一個變數指向到函式外的thi，通常這個變數會取名叫<code>self</code>或<code>that</code>或是其他自訂有意義的名稱，這個算是javascript中常用的小技巧。</p><p>舉例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">constructor</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'active'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> self </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 自訂名為self的變數指向到class的this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ...略...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'g'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'click'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// this指向&lt;g&gt;元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">classed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">className</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// self指向到class的this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="解法三">解法三<a class="hash-link" href="#解法三" title="Direct link to heading">​</a></h2><p>最後這個解法很容易就出現漏洞，而且只適用上述三種情境當中的「事件函式」當中… 所以就當作參考就好了 XD（應該說，此用法的程式意義和d3.select(this)不太相同，適不適用需依你的使用情境來看）。</p><p>解法就是改用<code>d3.event.target</code>來代替原來的<code>this</code>。</p><p>但是我說的漏洞，是他取到的對象和原先的<code>this</code>有可能會不一樣（！！），聽起來好像很可怕，但如果了解javascript的事件傳遞機制就知道這個再正常不過。</p><p>我所指的就是javascript的event bubbling，事件傳遞時會由最內層的DOM一層一層往外傳遞。假設有一組DOM如下：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">svg</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">g</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">path</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">...略...</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">text</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">...略...</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">g</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">g</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">path</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">...略...</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">text</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">...略...</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">g</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">g</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">path</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">...略...</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">text</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">...略...</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">g</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">svg</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>假設前面範例的第一段程式碼的html是長這樣個子，在該例中click監聽事件綁在<code>&lt;g&gt;</code>上面（也就是說用d3.select(this)可以取到被點擊到的<code>&lt;g&gt;</code>元素），但是滑鼠點擊時有可能是點到畫面上的<code>&lt;path&gt;</code>或<code>&lt;text&gt;</code>元素，那<code>d3.event.target</code>就會是<code>&lt;path&gt;</code>或<code>&lt;text&gt;</code>，而不會是<code>&lt;g&gt;。</code></p><p>這裡有一個方法可以解決這個問題，就是在剛才取到的對象上加上<code>.parentNode</code>就可以找到他的父節點。</p><p>…依據的我經驗，這個方法又可能會越補越大洞…</p><p>這個情況是，如果你的DOM是多層的，就沒有辦法保證事件傳遞是從第二層開始，他有可能會從第三層或第四層，因此就沒辦法正常找到你最初想找的<code>&lt;g&gt;</code>。</p><h1>總結</h1><p>假設上述解決方式中，你和我一樣選擇使用「解法一」，用<code>d3.select(all[i])</code>來取代<code>d3.select(this)</code>，那對於這個「this」到底是什麼似乎就沒那麼重要了（？）。</p><p>對我個人而言，因為我的D3專案已經採用javascript模組化開發（使用es6 module以及webpack編譯），this在專案當中是有其意義，所以即使不是用在上述情境，在其他的程式裡也是會遇到類似問題。另外，多方面的吸收知識能夠更提供程式的掌控能力，而且在遇到問題時在尋找解決方案也會更有彈性。</p><p>以上是我的學習的一個整理，單純是從我遇到問題的角度試著以我的能力進一步探討。說實在javascript的this還真是博大精深，就語言本身可能只摸到基本概念而已，如果在文字或觀念上如果有不夠正確的地方再麻煩先進多多指教感謝~。</p>]]></content:encoded>
            <category>d3.js</category>
            <category>javascript</category>
        </item>
    </channel>
</rss>