<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Thunder Boy">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://shangdeyou.github.io/img/banner_48086798638_1cf5aa400c_o.jpg">
    <meta property="twitter:image" content="https://shangdeyou.github.io/img/banner_48086798638_1cf5aa400c_o.jpg" />
    

    
    <meta name="title" content="Vue2 的 Vuex使用 Typescript寫法" />
    <meta property="og:title" content="Vue2 的 Vuex使用 Typescript寫法" />
    <meta property="twitter:title" content="Vue2 的 Vuex使用 Typescript寫法" />
    

    
    <meta name="description" content="我是Thunder Boy | 這裡是一個部落格、程式語言的學習筆記、個人日常的照片集">
    <meta property="og:description" content="我是Thunder Boy | 這裡是一個部落格、程式語言的學習筆記、個人日常的照片集" />
    <meta property="twitter:description" content="我是Thunder Boy | 這裡是一個部落格、程式語言的學習筆記、個人日常的照片集" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="blog,programing language,tech,javascript,frontend,vue,d3js,photographic,camera">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Vue2 的 Vuex使用 Typescript寫法-Thunder Boy</title>

    <link rel="canonical" href="/2021/06/24/vuex-with-typescript-in-vue2/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">
    
    
    <link rel="stylesheet" href="/css/zanshang.css">
    
    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>

    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Thunder Boy</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/categories/programing">programing</a>
                    </li>
                    
                    
		    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
		    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15" style="cursor: pointer;" alt="Search"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/banner_47719886652_ff4f3afdbf_o.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/vue" title="vue">
                            vue
                        </a>
                        
                        <a class="tag" href="/tags/vuex" title="vuex">
                            vuex
                        </a>
                        
                        <a class="tag" href="/tags/typescript" title="typescript">
                            typescript
                        </a>
                        
                    </div>
                    <h1>Vue2 的 Vuex使用 Typescript寫法</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                            Thunder Boy
                         
                        on 
                        2021-06-24, Thursday
                        
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#前言">前言</a></li>
<li><a href="#vuex-使用-typescript寫法">Vuex 使用 Typescript寫法</a>
<ul>
<li><a href="#state">State</a></li>
<li><a href="#action">Action</a></li>
<li><a href="#mutation">Mutation</a></li>
<li><a href="#getters">Getters</a></li>
</ul></li>
<li><a href="#component中使用-vuex">Component中使用 Vuex</a>
<ul>
<li><a href="#1-mapstate-mapgetters-mapactions-mapmutations">1.mapState/mapGetters/mapActions/mapMutations</a></li>
<li><a href="#2-this-store">2.this.$store</a></li>
<li><a href="#3-import-store">3.import store</a></li>
</ul></li>
<li><a href="#參考來源">參考來源</a></li>
</ul></li>
</ul>
</nav>
                
                

<h2 id="前言">前言</h2>

<p>Vuex v4.0版本以上大幅改善了對 Typescript的支援、以及對 composition-api的整合，但是 <a href="https://github.com/vuejs/vuex/blob/4.0/package.json#L55">Vuex v4.x版只支援 Vue3以上版本</a>。</p>

<p>也就是說如果開發環境是 Vue v2.x版本的話，Vuex也就只能使用 v3.x版本。雖然說 Vuex v3.x版對於 Typescript的支援上也些限制和不順手，但只要做好註記 (annotation)的工作，基本上我覺得型別推導上還算蠻完整的，唯獨 Component中要引入 Vuex的時候就會有些限制，只有 <code>state</code>可以型別推導，其餘 <code>mutation</code>/<code>action</code>等都會是 <code>any</code>型別。不過對我個人來說有 <code>state</code>型別推導就已經是相當實用，其他的就還是我可以忍受的範圍了。</p>

<h2 id="vuex-使用-typescript寫法">Vuex 使用 Typescript寫法</h2>

<h3 id="state">State</h3>

<p>要將整個 <code>state</code>註記成一個 Type或 Interface。如果 Vuex有使用 module功能，則每個子模組的 <code>state</code>各自維護自己的 Interface/Type。</p>

<p>如下例子是名稱為 <code>cart</code>的模組的 <code>state</code>：</p>

<pre><code class="language-js">// @/store/modules/cart/state.ts
export type CartState = {
  added: {
    id: number
    quantity: number
  };
  checkoutStatus: 'successful' | 'failed' | null
}

const state: CartState = {
  added: [],
  checkoutStatus: null
}

export default state
</code></pre>

<p>在 Vuex的 <code>state</code>是一個 tree結構，根節點的 <code>state</code>稱之為 <code>rootState</code>，而modules的 <code>state</code>會是<code>rootState</code>底下的一個子節點，所以在模組化Vuex的<code>rootState</code>在註記型別的時候需要把 modules的 <code>state</code>型別放入。</p>

<p>如下範例：</p>

<pre><code class="language-js">// @/store/index.ts
import Vue from 'vue'
import Vuex from 'vuex'
// 子模組的 state
import cart, { CartState } from './modules/cart/state'
// 最外層的 state
import appState, { AppState } from './state'

Vue.use(Vuex)

// 根節點的 state-tree
export type RootState = AppState &amp; {
  cart: CartState;
}

export default new Vuex.Store({
  modules: {
    cart
  },
  state: appState as RootState,
  // 略
})
</code></pre>

<h3 id="action">Action</h3>

<p>vuex提供 <code>ActionContext&lt;State, RootState&gt;</code>提供給<code>context</code>做註記，泛型中有兩個參數分別是該模組的 <code>state</code>的型別以及 <code>rootState</code>的型別，如下：</p>

<pre><code class="language-js">import { ActionContext } from 'vuex'
import { State } from './state.ts'
import { RootState } from '../state.ts'

const actions = {
  checkout (context: ActionContext&lt;State, RootState&gt;, products: CartProduct[]) {
    context.commit(types.CHECKOUT_REQUEST)
    // ...
  }
}
</code></pre>

<p>解構的寫法</p>

<pre><code class="language-js">import { Commit } from 'vuex'
import { State } from './state.ts'

const actions = {
  checkout ({ commit: Commit, state: State }, products: CartProduct[]) {
    context.commit(types.CHECKOUT_REQUEST)
    // ...
  }
}
</code></pre>

<h3 id="mutation">Mutation</h3>

<p>註記 payload的型別以及在  state.ts中註記的 state型別</p>

<pre><code class="language-js">import { AddToCartPayload } from '../index.ts'
import { State } from './state.ts'

const mutations = {
  addToCart (state: State, payload: AddToCartPayload) {
    const product = state.all.find(p =&gt; p.id === payload.id)
    // ...
  }
}
</code></pre>

<h3 id="getters">Getters</h3>

<p>各別的 getters函式可使用 <code>Getter&lt;State, RootState&gt;</code>， getters模組物件需使用<code>GetterTree&lt;State, RootState&gt;</code></p>

<pre><code class="language-js">// ./src/
import { GetterTree, Getter } from 'vuex'
import { State } from './index'
import { RootState } from '@/store/index'

const cartProducts: Getter&lt;State, RootState&gt; = (state: State) =&gt; {
  return state.cart.added.map(shape =&gt; {
    // ...
  })
}

const getterTree: GetterTree&lt;State, RootState&gt; = {
  cartProducts
}

export default getterTree
</code></pre>

<p>簡潔寫法：直接使用 getterTree把所有 getter函式寫在一起，就不用各別註記 getter函式的型別，這樣會更方便一些</p>

<pre><code class="language-js">// ./src/
import { GetterTree } from 'vuex'
import { State } from './index'

const getterTree: GetterTree&lt;State, any&gt; = {
  cartProducts (state) =&gt; {
    // state的型別 typescript會自行推斷出來
    return state.cart.added.map(shape =&gt; {
      // ...
    })
  }
}

export default getterTree
</code></pre>

<h2 id="component中使用-vuex">Component中使用 Vuex</h2>

<p>首先，關於在 Vue2中 Component寫 Typescript雖然不是本文重點，不過既然提到了還是稍微說一下，這裡是極度強烈建議安裝 <a href="https://github.com/vuejs/composition-api">composition-api</a>，關於使用方式可參考我之前寫的「<a href="https://shangdeyou.github.io/2021/02/09/vue-option-based-component-with-typescript/">Vue2的 Option-Based Component中使用Typescript的簡易方式</a>」。你可以不需改變原本的 Option-Api寫法，就可以完完全全的解決原本在 Vue2中 Typescript中支援不良的問題；當然後既然都安裝 composition-api了，也可以直接使用新的 composition-api來開發。</p>

<p>以下針對幾種常用的引入 Vuex方式來做說明：</p>

<h3 id="1-mapstate-mapgetters-mapactions-mapmutations">1.mapState/mapGetters/mapActions/mapMutations</h3>

<p>這個寫法是 Option-Api的寫法。很顯然他推導出來都會是 <code>any</code>型別，所以這種寫法可以直接放棄了。</p>

<h3 id="2-this-store">2.this.$store</h3>

<p>這個寫法是 Option-Api的寫法。完成文章上述所有的型別註記之後，他雖然推導的出一些基本的 Vuex型別，但推導不出 <code>state</code>的型別，在編輯器中滑鼠移過 <code>this.$store</code>上會發現，他推導出的型別是 <code>Store&lt;any&gt;</code>。看來這個可能還需要額外的一些工作才能把型別宣告到全域的 <code>$store</code>物件上。不過我覺得有點麻煩，就放棄嘗試了。</p>

<h3 id="3-import-store">3.import store</h3>

<p>這個是我覺得最合理的使用方式，雖然他也只推導的出 <code>state</code>，但我覺得這已經是一個很大的幫助了，寫法如下：</p>

<pre><code class="language-js">import store from '@/store/index'

store.state // 可推斷出型別
store.dispatch('checkout', true) // function參數無法推斷型別
</code></pre>

<p>總結來說，使用 import store來引入 Vuex是最合理也簡單的方式，至於 <code>actions</code>和 <code>mutations</code>無法推導出型別這個問題，如果要解決的話應該可以嘗試寫 helper function來解決，不過這樣對我來說實在有點太過囉唆，所以我是選擇忽略這個小問題了。</p>

<h2 id="參考來源">參考來源</h2>

<p>Vue2.5+ Typescript 引入全面指南 - Vuex篇</p>

<p><a href="https://segmentfault.com/a/1190000011864013">https://segmentfault.com/a/1190000011864013</a></p>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2021/05/23/lib-of-redux-on-next/" data-toggle="tooltip" data-placement="top" title="Next.js上使用 Redux四兄弟">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2021/06/24/vue-recursive-component/" data-toggle="tooltip" data-placement="top" title="Vue Recursive Component">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>

<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "thunderboy" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/javascript" title="javascript">
                            javascript
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/vue" title="vue">
                            vue
                        </a>
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>FRIENDS</h5>
                    <ul class="list-inline">
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="Thunder Boy" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:upstairs0102@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/shangdeyou/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/shangdeyou/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    
                    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Thunder Boy 2021
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
